
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>6. Creating and Connecting to Databases &#8212; Surfing the Data Pipeline with Python</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'ch6';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="7. Database Queries" href="ch7.html" />
    <link rel="prev" title="5. Web Scraping Using BeautifulSoup" href="ch5.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/surf.jpg" class="logo__image only-light" alt="Surfing the Data Pipeline with Python - Home"/>
    <script>document.write(`<img src="_static/surf.jpg" class="logo__image only-dark" alt="Surfing the Data Pipeline with Python - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Surfing the Data Pipeline with Python
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Get Started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ch1.html">1. Getting Yourself Unstuck</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Get Data</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ch2.html">2. Loading Data from Electronic Data Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch3.html">3. Loading, Converting, and Writing JSON Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch4.html">4. Acquiring Data from APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch5.html">5. Web Scraping Using <code class="docutils literal notranslate"><span class="pre">BeautifulSoup</span></code></a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">6. Creating and Connecting to Databases</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Wrangle Data</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ch7.html">7. Database Queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch8.html">8. Data Wrangling with <code class="docutils literal notranslate"><span class="pre">pandas</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="ch9.html">9. Reshaping and Merging Data and Working with Strings, Dates, and Times</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Explore and Communicate Data</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ch10.html">10. Exploratory Data Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch11.html">11. Static Data Visualizations</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch12.html">12. Interactive Data Visualizations and Dashboards</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendices</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="docker.html">Virtual Environments and Containers</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/ch6.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Creating and Connecting to Databases</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-what-is-a-database">6.1. Introduction: What is a Database?</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#querying-a-database-vs-using-an-api">6.1.1. Querying a Database vs. Using an API</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#atomicity-consistency-isolation-durability-acid">6.1.2. Atomicity, Consistency, Isolation, Durability (ACID)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-brief-history-of-databases">6.1.3. A Brief History of Databases</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#types-of-databases">6.2. Types of Databases</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#navigational-databases">6.2.1. Navigational Databases</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#relational-databases">6.2.2. Relational Databases</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#relational-database-normalization">6.2.2.1. Relational Database Normalization</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#first-normal-form">6.2.2.1.1. First Normal Form</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#functional-dependence">6.2.2.1.2. Functional Dependence</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#second-normal-form">6.2.2.1.3. Second Normal Form</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#third-normal-form">6.2.2.1.4. Third Normal Form</a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#entity-relationship-diagrams">6.2.2.2. Entity-Relationship Diagrams</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#relational-database-management-systems-rdbms">6.2.2.3. Relational Database Management Systems (RDBMS)</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nosql-databases">6.2.3. NoSQL Databases</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#comparing-nosql-databases-to-relational-databases">6.2.3.1. Comparing NoSQL Databases to Relational Databases</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#key-value-stores">6.2.3.2. Key-Value Stores</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#document-stores">6.2.3.3. Document Stores</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#wide-column-stores">6.2.3.4. Wide-Column Stores</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#graph-databases">6.2.3.5. Graph Databases</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#working-with-databases-in-python">6.3. Working With Databases in Python</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#installing-database-systems-using-docker">6.3.1. Installing Database Systems Using Docker</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-wine-reviews">6.3.2. Example: Wine Reviews</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-sqlite">6.3.3. Using SQLite</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-mysql">6.3.4. Using MySQL</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#connecting-to-the-mysql-server-and-creating-a-new-database">6.3.4.1. Connecting to the MySQL Server and Creating a New Database</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#connecting-to-an-existing-database-on-mysql">6.3.4.2. Connecting to an Existing Database on MySQL</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-postgresql">6.3.5. Using PostgreSQL</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#connecting-to-the-postgresql-server-and-creating-a-new-database">6.3.5.1. Connecting to the PostgreSQL Server and Creating a New Database</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#connecting-to-an-existing-database-on-postgresql">6.3.5.2. Connecting to an Existing Database on PostgreSQL</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-mongodb">6.3.6. Using MongoDB</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="creating-and-connecting-to-databases">
<h1><a class="toc-backref" href="#id1" role="doc-backlink"><span class="section-number">6. </span>Creating and Connecting to Databases</a><a class="headerlink" href="#creating-and-connecting-to-databases" title="Link to this heading">#</a></h1>
<nav class="contents" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#creating-and-connecting-to-databases" id="id1">Creating and Connecting to Databases</a></p>
<ul>
<li><p><a class="reference internal" href="#introduction-what-is-a-database" id="id2">Introduction: What is a Database?</a></p>
<ul>
<li><p><a class="reference internal" href="#querying-a-database-vs-using-an-api" id="id3">Querying a Database vs. Using an API</a></p></li>
<li><p><a class="reference internal" href="#atomicity-consistency-isolation-durability-acid" id="id4">Atomicity, Consistency, Isolation, Durability (ACID)</a></p></li>
<li><p><a class="reference internal" href="#a-brief-history-of-databases" id="id5">A Brief History of Databases</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#types-of-databases" id="id6">Types of Databases</a></p>
<ul>
<li><p><a class="reference internal" href="#navigational-databases" id="id7">Navigational Databases</a></p></li>
<li><p><a class="reference internal" href="#relational-databases" id="id8">Relational Databases</a></p>
<ul>
<li><p><a class="reference internal" href="#relational-database-normalization" id="id9">Relational Database Normalization</a></p></li>
<li><p><a class="reference internal" href="#entity-relationship-diagrams" id="id10">Entity-Relationship Diagrams</a></p></li>
<li><p><a class="reference internal" href="#relational-database-management-systems-rdbms" id="id11">Relational Database Management Systems (RDBMS)</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#nosql-databases" id="id12">NoSQL Databases</a></p>
<ul>
<li><p><a class="reference internal" href="#comparing-nosql-databases-to-relational-databases" id="id13">Comparing NoSQL Databases to Relational Databases</a></p></li>
<li><p><a class="reference internal" href="#key-value-stores" id="id14">Key-Value Stores</a></p></li>
<li><p><a class="reference internal" href="#document-stores" id="id15">Document Stores</a></p></li>
<li><p><a class="reference internal" href="#wide-column-stores" id="id16">Wide-Column Stores</a></p></li>
<li><p><a class="reference internal" href="#graph-databases" id="id17">Graph Databases</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#working-with-databases-in-python" id="id18">Working With Databases in Python</a></p>
<ul>
<li><p><a class="reference internal" href="#installing-database-systems-using-docker" id="id19">Installing Database Systems Using Docker</a></p></li>
<li><p><a class="reference internal" href="#example-wine-reviews" id="id20">Example: Wine Reviews</a></p></li>
<li><p><a class="reference internal" href="#using-sqlite" id="id21">Using SQLite</a></p></li>
<li><p><a class="reference internal" href="#using-mysql" id="id22">Using MySQL</a></p>
<ul>
<li><p><a class="reference internal" href="#connecting-to-the-mysql-server-and-creating-a-new-database" id="id23">Connecting to the MySQL Server and Creating a New Database</a></p></li>
<li><p><a class="reference internal" href="#connecting-to-an-existing-database-on-mysql" id="id24">Connecting to an Existing Database on MySQL</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#using-postgresql" id="id25">Using PostgreSQL</a></p>
<ul>
<li><p><a class="reference internal" href="#connecting-to-the-postgresql-server-and-creating-a-new-database" id="id26">Connecting to the PostgreSQL Server and Creating a New Database</a></p></li>
<li><p><a class="reference internal" href="#connecting-to-an-existing-database-on-postgresql" id="id27">Connecting to an Existing Database on PostgreSQL</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#using-mongodb" id="id28">Using MongoDB</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
<section id="introduction-what-is-a-database">
<h2><a class="toc-backref" href="#id2" role="doc-backlink"><span class="section-number">6.1. </span>Introduction: What is a Database?</a><a class="headerlink" href="#introduction-what-is-a-database" title="Link to this heading">#</a></h2>
<img src="https://github.com/jkropko/DS-6001/raw/master/localimages/tidy.jpg" width="500" >
<p>A database is an organized collection of many data records, whether those records are tables, JSON, or another format. If a single data record is a book, then a database is a library: the library contains many books, which are organized according to some system such as alphabetical order or the Dewey Decimal System. Databases, if they are carefully organized and well-maintained, allow big organizations to keep track of huge amounts data and access specific data quickly. Databases also make security easier: by storing all the data together inside a database, it is also easier to use encryption, credentials, and other security measures to control who has access to what data inside the database. Databases can exist locally, on your own computer’s hard drive for example, or on remote servers that anyone with an internet connection and the right credentials can access.</p>
<section id="querying-a-database-vs-using-an-api">
<h3><a class="toc-backref" href="#id3" role="doc-backlink"><span class="section-number">6.1.1. </span>Querying a Database vs. Using an API</a><a class="headerlink" href="#querying-a-database-vs-using-an-api" title="Link to this heading">#</a></h3>
<p>As a data scientist, you will frequently have to issue requests to remote databases to get the data you need. These requests are called <strong>queries</strong>. We’ve already discussed sending queries to a database in Chapter 4 through APIs, but here we will focus on situations in which no API is available. Remember that an API is code that takes a request as input, translates that request to language the database can understand, and returns the requested data subject to the API’s restrictions and security measures. A REST API requires client-server separation, and that allows database managers to make changes to a database without requiring front end users to change their code for issuing a query because the API does that translation on behalf of the user. So if a remote database has an API, the database managers intend for users to make queries through that API, and not to query the database directly.</p>
<p>If there is no API, users will have to pay close attention to how the database is organized to query the database correctly. The specific way in which a database is organized is called the <strong>schema</strong>. If the database managers change the schema for any reason, users will need to change their queries to work with the new schema.</p>
<p>Both APIs and direct queries can include security measures, but APIs allow more nuanced security. For example, an API can be used to keep track of how much data is being requested and how many calls have been issued and block users that exceed pre-set limits. A database without an API can require a username and password to grant or deny access to the data, but cannot in general place restrictions on the extent of use the way APIs can.</p>
</section>
<section id="atomicity-consistency-isolation-durability-acid">
<h3><a class="toc-backref" href="#id4" role="doc-backlink"><span class="section-number">6.1.2. </span>Atomicity, Consistency, Isolation, Durability (ACID)</a><a class="headerlink" href="#atomicity-consistency-isolation-durability-acid" title="Link to this heading">#</a></h3>
<p>The purpose of a database is to store data and make sure that data can always be transferred to approved applications. A transfer of data is called a <strong>transaction</strong>, and a transaction is considered valid if it meets four criteria - atomicity, consistency, isolation, and durability - that were first described by <a class="reference external" href="https://dl.acm.org/doi/10.1145/289.291">Theo Haerder and Andreas Reuter in 1983</a>:</p>
<ul>
<li><p>Atomicity: one transaction might require many actions to be run in sequence. For example, making a credit card purchase involves five steps:</p>
<ol class="arabic simple">
<li><p>The customer swipes the card and approves the purchase</p></li>
<li><p>The vendor’s card reader communicates the payment information to the vendor’s bank</p></li>
<li><p>The vendor’s bank communicates with the credit card issuer</p></li>
<li><p>The issuer either declines or approves and pays the request and sends this information to the bank</p></li>
<li><p>The bank communicates the result to the vendor</p></li>
</ol>
<p>Atomicity says that all of these steps should be considered part of a single transaction. The transaction is successful if and only if all five steps are successful, and the transaction fails if any of these steps fail. In the case of a credit card purchase, that means that if the credit card issuer pays the bank, but the bank fails to transfer that payment to the vendor, then the entire transaction fails and the issuer’s payment to the bank is cancelled: that prevents situations where people disagree about who did or did not pay.</p>
</li>
<li><p>Consistency: the result of a transaction is not allowed to invalidate the data that already exists in the database. If there is an error that causes an invalid datapoint to be transmitted to the database, the entire transaction is cancelled. Consistency also means that no data should contradict other data. For example, if a customer’s account is debited by some amount, it might take some time for the transaction to be communicated to both the bank and the credit card company. A transaction is not considered complete until the record of the customer’s account balance is updated in every system. It might take longer to complete a transaction this way, but this step ensures that there’s no possibility of problems due to different systems having different balances for the same account.</p></li>
<li><p>Isolation: if there are many transactions issued to the same database in a short period of time, one transaction must be fully completed before the next transaction is processed. That ensures that the information available in the database for each transaction is the most up-to-date.</p></li>
<li><p>Durability: once a transaction has been made, the record of that transaction cannot be erased, even if the system experiences a hardware failure such as a power outage.</p></li>
</ul>
<p>The ACID criteria are standards that well-maintained databases need to achieve, regardless of how the data are organized, stored, and used.</p>
</section>
<section id="a-brief-history-of-databases">
<h3><a class="toc-backref" href="#id5" role="doc-backlink"><span class="section-number">6.1.3. </span>A Brief History of Databases</a><a class="headerlink" href="#a-brief-history-of-databases" title="Link to this heading">#</a></h3>
<p>According to <a class="reference external" href="https://doi.org/10.19030/ijmis.v17i1.7587">Kristi L. Berg, Tom Seymour, and Richa Goel (2013, p. 29)</a>:</p>
<blockquote>
<div><p>The origins of the database go back to libraries, governmental, business and medical records before the computers were invented… . Once people realized they needed to have the means to store data and maintain the data files for later retrieval, they were trying to find ways to store, index, and retrieve data. With the emergence of computers, the world of the database changed rapidly, making it an easy, cost effective, and less space-consuming task to collect and maintain the database.</p>
</div></blockquote>
<p>While physical database systems date back to ancient times, electronic databases were invented in the 1960s to work with the first computers capable of using disk storage. The first databases emphasized storage over the content of the data. The focus was to find sufficient physicial storage for a large number of records with the same fields and different values for those fields. As the early concerns revolved around physical storage, the icon for a database resembles physical disk storage. You’ve probably seen some representation of this icon to represent a database:</p>
<center><img src="https://upload.wikimedia.org/wikipedia/commons/8/86/Database-icon.svg" width="200">
<p style="text-align: center;"><b>Source:</b>
<a href="https://upload.wikimedia.org/wikipedia/commons/8/86/Database-icon.svg">Wikimedia Commons</a>
</p></center>
<p>To be specific, this standard database icon is a picture of a <a class="reference external" href="https://stackoverflow.com/questions/2822650/why-is-a-database-always-represented-with-a-cylinder">drum memory</a> data storage device, which was <a class="reference external" href="https://en.wikipedia.org/wiki/Drum_memory">invented in 1932</a> and predates disk drives. Here’s a picture of a drum memory that would have been used in the 1950s:</p>
<center><img src="https://upload.wikimedia.org/wikipedia/commons/d/d2/Pamiec_bebnowa_1.jpg" width="200">
<p style="text-align: center;"><b>Source:</b>
<a href="https://en.wikipedia.org/wiki/Drum_memory">Wikipedia</a>
</p></center>
<p>From the 1960s onward, new database types were developed to match the needs of businesses as data and databases gained increased use in industry and government. In the 1970s the invention of the relational database structure allowed users to query a database for records with specific content. Relational databases also enabled more stringent data validation standards - certain fields could only be populated by values with specific data types - and allowed database managers to add new features without having to go back and revise every record in the database. In the 1980s and 1990s, the relational framework was extended to work with object-oriented programming languages and with web-based applications such as APIs. More recent innovations in database structures respond to the greater need for databases to store massive amounts of data, the need to use distributed storage and cloud computing, and the proliferation of data in which records exist in an interconnected network or come from real-time streaming. The following table summarizes these innovations:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Timeframe</p></th>
<th class="head text-left"><p>Database Need</p></th>
<th class="head text-left"><p>New Type of Database</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>1960s</p></td>
<td class="text-left"><p>Store data and page through records</p></td>
<td class="text-left"><p>Navigational</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>1970s-1980s</p></td>
<td class="text-left"><p>Search/filter based on the content of records; add new features without having to revise all records in the database</p></td>
<td class="text-left"><p>Relational</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>1980s</p></td>
<td class="text-left"><p>Work with object oriented programming languages</p></td>
<td class="text-left"><p>Object Oriented</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>1990s</p></td>
<td class="text-left"><p>Use internet connectivity to create client-server systems and APIs</p></td>
<td class="text-left"><p>Web-Enabled Relational</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>2000s</p></td>
<td class="text-left"><p>Huge data storage memory requirements; need for flexible schema</p></td>
<td class="text-left"><p>NoSQL Databases</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>2010s</p></td>
<td class="text-left"><p>Host databases on distributed systems using cloud computing</p></td>
<td class="text-left"><p>Databases with cloud functionality</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>2010s-2020s</p></td>
<td class="text-left"><p>Store data in which records link to each other in a network</p></td>
<td class="text-left"><p>Graph databases</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>2010s-2020s</p></td>
<td class="text-left"><p>Store data in which records come from a streaming time series</p></td>
<td class="text-left"><p>Time series databases</p></td>
</tr>
</tbody>
</table>
</div>
<p>A <strong>database management system</strong> (DBMS) is software that allows users to create, revise, or delete records in a database, generate security protocols, or issue queries to obtain a selection of the data. Every innovation in database structure and functionality brought about the creation of new DMBSs. People sometimes muddle the terminology and refer to a database, its schema, and a DBMS interchangably: it’s not uncommon to hear people speak about a “MySQL database” when it would be more accurate to describe “a database with a relational schema managed using the MySQL DBMS”. In addition, there has been a huge proliferation in DBMSs, and people can spend a lot of time debating competiting DBMSs that are only marginally different from each other. That can be frustrating to new coders who are trying to find the “right” or “best” DBMS, and many people have had the experience of finally mastering one DBMS only to be told that its been replaced by a new one. It is important to understand your options when it comes to choosing a database type and a DBMS,  but it is also important to understand which distinctions are major and which are minor.</p>
</section>
</section>
<section id="types-of-databases">
<h2><a class="toc-backref" href="#id6" role="doc-backlink"><span class="section-number">6.2. </span>Types of Databases</a><a class="headerlink" href="#types-of-databases" title="Link to this heading">#</a></h2>
<p>As described in the previous section, electronic databases have evolved a great deal since the 1960s to increase the functionality of working with data, to handle new kinds of data, and manage bigger and bigger amounts of data. If you intend to create a database, the first decision you need to make is what type of database you are going to create. If you are going to work with an existing database, knowing what type of database you are working with will guide you to the correct methods for issuing queries to this database.</p>
<p>To illustrate the differences between types of database, consider the following (fake) data, based on data on books checked out from the Jefferson-Madison Regional Library (<a class="reference external" href="https://www.jmrl.org/">https://www.jmrl.org/</a>), a network of public libraries that serves Charlottesville, Virginia and the surrounding region. In this data table, rows represent individual books checked out by particular patrons, every library patron has a unique library card number, every book has a title and at least one author, the checkout dates are recorded but the return dates are <code class="docutils literal notranslate"><span class="pre">NULL</span></code> if the book is still checked out, and the librarian who conducted the transaction is included along with library branch where they work:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>CardNum</p></th>
<th class="head"><p>Patron</p></th>
<th class="head"><p>Title</p></th>
<th class="head"><p>ISBN-10</p></th>
<th class="head"><p>Authorship</p></th>
<th class="head"><p>Checkout</p></th>
<th class="head"><p>Return</p></th>
<th class="head"><p>Librarian</p></th>
<th class="head"><p>Branch</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>18473</p></td>
<td><p>Ernesto Hanna</p></td>
<td><p>A Brief History of Time</p></td>
<td><p>0553380168</p></td>
<td><p>Stephen Hawking</p></td>
<td><p>8/25/24</p></td>
<td><p>9/3/24</p></td>
<td><p>José María Chantal</p></td>
<td><p>Charlottesville</p></td>
</tr>
<tr class="row-odd"><td><p>29001</p></td>
<td><p>Lakshmi Euripides</p></td>
<td><p>Love in the Time of Cholera</p></td>
<td><p>0307389731</p></td>
<td><p>Gabriel Garcia Marquez</p></td>
<td><p>11/23/24</p></td>
<td><p>12/14/24</p></td>
<td><p>José María Chantal</p></td>
<td><p>Charlottesville</p></td>
</tr>
<tr class="row-even"><td><p>29001</p></td>
<td><p>Lakshmi Euripides</p></td>
<td><p>Good Omens</p></td>
<td><p>0060853980</p></td>
<td><p>[Neil Gaiman, Terry Pratchett]</p></td>
<td><p>1/7/25</p></td>
<td><p>2/3/25</p></td>
<td><p>Antony Yusif</p></td>
<td><p>Charlottesville</p></td>
</tr>
<tr class="row-odd"><td><p>29001</p></td>
<td><p>Lakshmi Euripides</p></td>
<td><p>The Master and Margarita</p></td>
<td><p>0143108271</p></td>
<td><p>Mikhail Bulgakov</p></td>
<td><p>4/2/25</p></td>
<td><p>NULL</p></td>
<td><p>Antony Yusif</p></td>
<td><p>Charlottesville</p></td>
</tr>
<tr class="row-even"><td><p>73498</p></td>
<td><p>Pia Galchobhar</p></td>
<td><p>Freakonomics: A Rogue Economist Explores the Hidden Side of Everything</p></td>
<td><p>006073132X</p></td>
<td><p>[Steven Levitt, Stephen J. Dubner]</p></td>
<td><p>3/2/25</p></td>
<td><p>3/25/25</p></td>
<td><p>Dominicus Mansoor</p></td>
<td><p>Crozet</p></td>
</tr>
<tr class="row-odd"><td><p>73498</p></td>
<td><p>Pia Galchobhar</p></td>
<td><p>Moneyball: The Art of Winning an Unfair Game</p></td>
<td><p>0393324818</p></td>
<td><p>Michael Lewis</p></td>
<td><p>3/24/25</p></td>
<td><p>NULL</p></td>
<td><p>Antony Yusif</p></td>
<td><p>Charlottesville</p></td>
</tr>
</tbody>
</table>
</div>
<p>This table contains all of the data. However, this representation of the data is not the way any of the commonly used database schemas organize the data.</p>
<section id="navigational-databases">
<h3><a class="toc-backref" href="#id7" role="doc-backlink"><span class="section-number">6.2.1. </span>Navigational Databases</a><a class="headerlink" href="#navigational-databases" title="Link to this heading">#</a></h3>
<p>Early databases treated records as equivalent units, stored in sequential order, like pages in a book. Patient records at a hospital, for example, could all be stored in a database, and an individual patient’s data could be extracted by flipping through the records until the patient’s data appears. Navigational databases also allow records to link to other records based on common features, such as patients who see the same doctor.</p>
<p>If the library data is stored in a navigational database, one record might appear on a librarian’s computer screen like this:</p>
<img src="https://github.com/jkropko/DS-6001/raw/master/localimages/navigational.png" width="600">
<p>Notice that only one record appears on the screen, but there are links to the previous and next records in the database, along with the previous or next records for this patron or that occurred at this branch.</p>
<p>The major drawback of navigational database systems is that there is no way to perform a search other than moving through the links, which is time consumming and computationally inefficient. Navigational databases cannot filter data based on the content of a record, so there’s no way to see all the times a book by Gabriel Garcia Marquez was checked out, for example. While the early history of databases was dominated by navigational types, and while this type of database still gets used in some applications, most databases no longer use this structure.</p>
</section>
<section id="relational-databases">
<h3><a class="toc-backref" href="#id8" role="doc-backlink"><span class="section-number">6.2.2. </span>Relational Databases</a><a class="headerlink" href="#relational-databases" title="Link to this heading">#</a></h3>
<p>The relational database structure was first proposed by <a class="reference external" href="https://www.seas.upenn.edu/~zives/03f/cis550/codd.pdf">E. F. Codd in 1970</a>. He describes the motivation for a relational database model as follows (p. 377):</p>
<blockquote>
<div><p>The relational view (or model) of data … appears to be superior in several respects to the [navigational] model presently in vogue for non-inferential systems. It provides a means of describing data with its natural structure only - that is, without superimposing any additional structure for machine representation purposes. Accordingly, it provides a basis for a high level data language which will yield maximal independence between programs on the one hand and machine representation and organization of data on the other.</p>
</div></blockquote>
<p>In other words, relational databases do not have to rely on a pre-set ordering or indexing of the records. There should be no intrinsic meaning to the order of the rows or the order of the columns. That way, to find specific data, a user only needs to search for that data and does not need to lookup the location of the data in an index. The ability to find records based only on the data present within the record is the key purpose of the structured query language (SQL) which is still the predominant way to work with relational databases. SQL is the “high level data language” that Codd had in mind when he formulated the relational database structure.</p>
<p>Codd also describes a further advantage of the relational schema: “it forms a sound basis for treating derivability, redundancy, and consistency of relations” (p. 377):</p>
<ul class="simple">
<li><p>Derivability refers to an ability to use a set of operations to pinpoint a desired selection of the data; that is, we can use queries that operate on the quantities in the data to extract exactly the data we need. If we wanted data on all books checked out from the Crozet branch in February that had more than one author, we can specify a query to return that dataset.</p></li>
<li><p>Redundancy refers to the fact that some of the information in a data table is implied by other features, and therefore takes up more space than it needs to. For example, in the library data shown above, it’s redundant to list “Charlottesville” over and over for every row in which the librarian is Antony Yusif because each librarian works at only one branch. If we know the librarian, we can lookup the branch where that librarian works in a separate table, and separating the data into two tables will reduce the overall amount of memory needed to store the data.</p></li>
<li><p>Consistency refers to the possibility of contradictions within the data. If someone updates the data one record at a time, then it is possible for the person entering the data to make a mistake. For example, I could create another row in the library data that lists Antony Yusif with the Crozet branch, which is a mistake because Antony Yusif works at the Charlottesville branch. Either someone needs to catch and fix this mistake, or else the data now contain contradictory information. The relational database, however, lists librarians with their branches in another table, so there’s no opportunity for me to mistakenly input the wrong branch: instead the correct branch is automatically drawn from this second table.</p></li>
</ul>
<section id="relational-database-normalization">
<h4><a class="toc-backref" href="#id9" role="doc-backlink"><span class="section-number">6.2.2.1. </span>Relational Database Normalization</a><a class="headerlink" href="#relational-database-normalization" title="Link to this heading">#</a></h4>
<p>In order for a relational database to provide derivability, redundancy, and consistency, it must be in <strong>normal form</strong>. Database normalization is a series of rules that a collection of data tables within a relational database must follow in order to solve the problems that Codd identified. There are many, progressive versions of normal forms: each version adds more stringent rules, but solves more problems. Here we will discuss three different organization standards called first, second, and third normal form.</p>
<section id="first-normal-form">
<h5><span class="section-number">6.2.2.1.1. </span>First Normal Form<a class="headerlink" href="#first-normal-form" title="Link to this heading">#</a></h5>
<p>To be in first normal form (1NF), data must meet three criteria:</p>
<ol class="arabic simple">
<li><p>Every table must have a <strong>primary key</strong>.</p></li>
</ol>
<p>A primary key is one column or a combination of several columns that contain unique identifying values for each row. (A combination of columns that comprise the primary key is sometimes called a <a class="reference external" href="https://en.wikipedia.org/wiki/Superkey">superkey</a>.) This column or combination of columns is called a <strong>foreign key</strong> when used in other tables.</p>
<ol start="2">
    <li> The values inside every cell in every table must be <b>atomic</b>.</li>
</ol>
<p>That means these values cannot be lists, tuples, dictionaries, tables, or dataframes. Put another way: every individual piece of data must get its own cell. But what constitutes an “individual piece of data”? The answer depends on the context of the data and the purpose of the database. Take for example the <code class="docutils literal notranslate"><span class="pre">Patron</span></code> column in the library data, which contains the patrons’ first and last names. Is this column non-atomic? It depends on whether we have a purpose in considering the patrons’ first and last names separately. Suppose we run an automated email client that extracts the first names from the database and sends emails to each patron beginning “Dear <em>firstname</em>,”, then we should break the <code class="docutils literal notranslate"><span class="pre">Patron</span></code> field into first and last names. But if we have no reason to consider the first and last names separately, then breaking this column up is just an unnecessary complication.</p>
<p>Atomization is necessary in order for the data to be searchable. If we want to find all books by Stephen Hawking, for example, it helps a great deal for each author name to be contained in separate cells.</p>
<ol start="3">
    <li> There are no <b>repeating groups</b>. </li>
</ol>
<p>This point is one of the most <a class="reference external" href="https://www.red-gate.com/simple-talk/sql/learn-sql-server/facts-and-fallacies-about-first-normal-form/">confusing and contentious</a> in the discourse on relational databases because different sources define the notion of “repeating groups” in different ways. Generally speaking, repeating groups are “<a class="reference external" href="https://stackoverflow.com/questions/23194292/normalization-what-does-repeating-groups-mean">a repeating set of columns … containing similar kinds of values in a table</a>.” But that’s really vague and it can be hard to know from one case to the next whether columns are similar enough to be considered repeating. A better way to think about this rule is as follows: repeated groups are almost always problems that arise immediately after splitting up non-atomic data. After atomization, answer the following two questions:</p>
<p>i. Do we have to arbitrarily put numbers or ordering language into the new columns’ names?</p>
<p>ii. Does atomizing data and creating new columns generate new missing values? (Please note that the second question does not include missing values that already existed in the data prior to atomization.)</p>
<p>If the answer to either question is yes, then the data have repeating groups. So to create a 1NF database, it is necessary to atomize data in a way that does not create a repeating groups problem. To see an example of how to proceed, consider again the example of data on transactions from the library:</p>
<p>For this library example, let’s make a few simplifying assumptions:</p>
<ul class="simple">
<li><p>No one takes out a book more than once on any one day</p></li>
<li><p>No two authors share the same name (This is unrealistic because there are other authors named <a class="reference external" href="https://www.presspubs.com/white_bear/news/author-dan-brown-no-not-that-one/article_cce68c2c-d3b4-11eb-9411-cf2c69228d6f.html">Dan Brown</a>, for example. If we wanted to dispel this assumption, we would have to use a unique ID of some kind for authors.)</p></li>
<li><p>Every librarian works at only one library branch, and no two librarians share the same name.</p></li>
</ul>
<p>The library data passes criterion 1 for 1NF because <code class="docutils literal notranslate"><span class="pre">CardNum</span></code>, <code class="docutils literal notranslate"><span class="pre">ISBN-10</span></code> (a unique identifying code for books), and <code class="docutils literal notranslate"><span class="pre">Checkout</span></code> together comprise the primary key: these columns uniquely identify the rows because one person checks out a specific book only once on a particular day. But the data fail on criterion 2 because <code class="docutils literal notranslate"><span class="pre">Authorship</span></code> is not atomic: some of the books have multiple authors, and in these cases the authors are stored in lists. If we break <code class="docutils literal notranslate"><span class="pre">Authorship</span></code> up into different columns, like this,</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Title</p></th>
<th class="head"><p>ISBN-10</p></th>
<th class="head"><p>First Author</p></th>
<th class="head"><p>Second Author</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>A Brief History of Time</p></td>
<td><p>0553380168</p></td>
<td><p>Stephen Hawking</p></td>
<td><p>NULL</p></td>
</tr>
<tr class="row-odd"><td><p>Love in the Time of Cholera</p></td>
<td><p>0307389731</p></td>
<td><p>Gabriel Garcia Marquez</p></td>
<td><p>NULL</p></td>
</tr>
<tr class="row-even"><td><p>Good Omens</p></td>
<td><p>0060853980</p></td>
<td><p>Neil Gaiman</p></td>
<td><p>Terry Pratchett</p></td>
</tr>
<tr class="row-odd"><td><p>The Master and Margarita</p></td>
<td><p>0143108271</p></td>
<td><p>Mikhail Bulgakov</p></td>
<td><p>NULL</p></td>
</tr>
<tr class="row-even"><td><p>Freakonomics: A Rogue Economist Explores the Hidden Side of Everything</p></td>
<td><p>006073132X</p></td>
<td><p>Steven Levitt</p></td>
<td><p>Stephen J. Dubner</p></td>
</tr>
<tr class="row-odd"><td><p>Moneyball: The Art of Winning an Unfair Game</p></td>
<td><p>0393324818</p></td>
<td><p>Michael Lewis</p></td>
<td><p>NULL</p></td>
</tr>
</tbody>
</table>
</div>
<p>we would also fail to satisfy criterion 3 because we created a repeating groups problem. We had to include ordering language in names for the columns to store the authors’ names: we could have equivalently listed Stephen J. Dubner as the first author of <em>Freakonomics</em> and Steven Levitt as the second author, so this placement is arbitrary. In addition, because most of the books do not have a second author, we created a lot of missing values in the <code class="docutils literal notranslate"><span class="pre">Second</span> <span class="pre">Author</span></code> column that did not exist in the data before. If the data had included even one book with 3, 4, or more authors, then we would have to create even more author columns with even more missing data. This organization also complicates any search we might want to do on authors: instead of searching for books in which Stephen J. Dubner is an author, we have to do a more complicated search for books in which Stephen J. Dubner is first author, or second author, or third author, and so on.</p>
<p>So, in general, splitting non-atomic data into separate columns is not the solution to creating a 1NF database. Instead, a better approach is to create a second table with each value of the non-atomic column on a new row, along with the columns the non-atomic columns depend on (please see the next section for a more formal definition of what it means for one column to “depend on” another); in this case, authorship depends on book, so we should bring the <code class="docutils literal notranslate"><span class="pre">ISBN-10</span></code> values into the table as well.</p>
<p>In the theoretical literature on relational databases, tables are called <strong>entities</strong> and the columns of each entity are called <strong>attributes</strong>. Entities have names, and we generally name the entities after the unit of observation that defines the rows in the table. We create a new entity to store the authorship data and we call it <em>AUTHORSHIP</em>:</p>
<div class="math notranslate nohighlight">
\[ AUTHORSHIP \]</div>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>ISBN-10</p></th>
<th class="head"><p>Author</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0553380168</p></td>
<td><p>Stephen Hawking</p></td>
</tr>
<tr class="row-odd"><td><p>0307389731</p></td>
<td><p>Gabriel Garcia Marquez</p></td>
</tr>
<tr class="row-even"><td><p>0060853980</p></td>
<td><p>Neil Gaiman</p></td>
</tr>
<tr class="row-odd"><td><p>0060853980</p></td>
<td><p>Terry Pratchett</p></td>
</tr>
<tr class="row-even"><td><p>0143108271</p></td>
<td><p>Mikhail Bulgakov</p></td>
</tr>
<tr class="row-odd"><td><p>006073132X</p></td>
<td><p>Steven Levitt</p></td>
</tr>
<tr class="row-even"><td><p>006073132X</p></td>
<td><p>Stephen J. Dubner</p></td>
</tr>
<tr class="row-odd"><td><p>0393324818</p></td>
<td><p>Michael Lewis</p></td>
</tr>
</tbody>
</table>
</div>
<p>In this entity, <code class="docutils literal notranslate"><span class="pre">ISBN-10</span></code> and <code class="docutils literal notranslate"><span class="pre">Author</span></code> together comprise the primary key. Unlike the table with columns for each author, there are no new missing values here. Also, searching for specific authors is much more straightforward now as it requires matching to just the one Author attribute.</p>
<p>To meet the rules of 1NF, we also remove the authors from the original table, which we can call the <em>TRANSACTIONS</em> entity:</p>
<div class="math notranslate nohighlight">
\[ TRANSACTIONS \]</div>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>CardNum</p></th>
<th class="head"><p>Patron</p></th>
<th class="head"><p>Title</p></th>
<th class="head"><p>ISBN-10</p></th>
<th class="head"><p>Checkout</p></th>
<th class="head"><p>Return</p></th>
<th class="head"><p>Librarian</p></th>
<th class="head"><p>Branch</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>18473</p></td>
<td><p>Ernesto Hanna</p></td>
<td><p>A Brief History of Time</p></td>
<td><p>0553380168</p></td>
<td><p>8/25/24</p></td>
<td><p>9/3/24</p></td>
<td><p>José María Chantal</p></td>
<td><p>Charlottesville</p></td>
</tr>
<tr class="row-odd"><td><p>29001</p></td>
<td><p>Lakshmi Euripides</p></td>
<td><p>Love in the Time of Cholera</p></td>
<td><p>0307389731</p></td>
<td><p>11/23/24</p></td>
<td><p>12/14/24</p></td>
<td><p>José María Chantal</p></td>
<td><p>Charlottesville</p></td>
</tr>
<tr class="row-even"><td><p>29001</p></td>
<td><p>Lakshmi Euripides</p></td>
<td><p>Good Omens</p></td>
<td><p>0060853980</p></td>
<td><p>1/7/25</p></td>
<td><p>2/3/25</p></td>
<td><p>Antony Yusif</p></td>
<td><p>Charlottesville</p></td>
</tr>
<tr class="row-odd"><td><p>29001</p></td>
<td><p>Lakshmi Euripides</p></td>
<td><p>The Master and Margarita</p></td>
<td><p>0143108271</p></td>
<td><p>4/2/25</p></td>
<td><p>NULL</p></td>
<td><p>Antony Yusif</p></td>
<td><p>Charlottesville</p></td>
</tr>
<tr class="row-even"><td><p>73498</p></td>
<td><p>Pia Galchobhar</p></td>
<td><p>Freakonomics: A Rogue Economist Explores the Hidden Side of Everything</p></td>
<td><p>006073132X</p></td>
<td><p>3/2/25</p></td>
<td><p>3/25/25</p></td>
<td><p>Dominicus Mansoor</p></td>
<td><p>Crozet</p></td>
</tr>
<tr class="row-odd"><td><p>73498</p></td>
<td><p>Pia Galchobhar</p></td>
<td><p>Moneyball: The Art of Winning an Unfair Game</p></td>
<td><p>0393324818</p></td>
<td><p>3/24/25</p></td>
<td><p>NULL</p></td>
<td><p>Antony Yusif</p></td>
<td><p>Charlottesville</p></td>
</tr>
</tbody>
</table>
</div>
<p>Together, the <em>AUTHORSHIP</em> and <em>TRANSACTIONS</em> entities are a 1NF database.</p>
</section>
<section id="functional-dependence">
<h5><span class="section-number">6.2.2.1.2. </span>Functional Dependence<a class="headerlink" href="#functional-dependence" title="Link to this heading">#</a></h5>
<p>Second and third normal forms are based on the idea of <strong>functionally dependent</strong> attributes in a entity. Understanding this concept is the key to understanding database normalization.</p>
<p>One attribute (Y) is functionally dependent on another (X) if the value of X implies a specific value for Y. Stated another way, each value of X appears alongside one and only one value of Y. That is pretty abstract, so here are some guidelines that help me understand the notion of functional dependence:</p>
<ul class="simple">
<li><p>This use of “function” is the exact same as the concept of a function from algebra and pre-calculus. A correspondence <span class="math notranslate nohighlight">\(f(x)=y\)</span> is a function if each value of <span class="math notranslate nohighlight">\(x\)</span> has only one associated value of <span class="math notranslate nohighlight">\(y\)</span>. The reverse is not necessary true, however: one value of <span class="math notranslate nohighlight">\(y\)</span> may have multiple values of <span class="math notranslate nohighlight">\(x\)</span> that map to it.</p></li>
<li><p>The X attribute will either be a primary key, or something that should be a primary key in another table.</p></li>
</ul>
<p>For example, <code class="docutils literal notranslate"><span class="pre">CardNum</span></code> and <code class="docutils literal notranslate"><span class="pre">Patron</span></code> are two attributes in the <em>TRANSACTIONS</em> entity. We say that <code class="docutils literal notranslate"><span class="pre">Patron</span></code> (Y) depends on <code class="docutils literal notranslate"><span class="pre">CardNum</span></code> (X) because one library card number has exactly one patron (with one name) associated with it. The reverse is not true: it is possible for two different patrons to have the same name (the same value of <code class="docutils literal notranslate"><span class="pre">Patron</span></code>) but for each to have different library card numbers.</p>
<p>In addition to <code class="docutils literal notranslate"><span class="pre">CardNum</span></code> and <code class="docutils literal notranslate"><span class="pre">Patron</span></code>, the library data also contains the following functionally dependent relationships:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Title</span></code> is functionally dependent on <code class="docutils literal notranslate"><span class="pre">ISBN-10</span></code> because one book has one title, but the reverse is not true because there are situations in which different books may have the <a class="reference external" href="https://bookriot.com/books-with-the-same-title/">same title</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Author</span></code> is functionally dependent on <code class="docutils literal notranslate"><span class="pre">ISBN-10</span></code> because one book has one author (or one set of authors), but the reverse is not true because that author (or set of authors) may have more than one book.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Return</span></code> is functionally dependent on the transaction, defined as the combination of <code class="docutils literal notranslate"><span class="pre">CardNum</span></code>, <code class="docutils literal notranslate"><span class="pre">ISBN-10</span></code>, and <code class="docutils literal notranslate"><span class="pre">Checkout</span></code> because one transaction of a checked-out library book has one return date for the book (though that date might be NULL or “not yet returned”). But the transaction does not depend on the return date because many books are returned each day.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Librarian</span></code> and <code class="docutils literal notranslate"><span class="pre">Branch</span></code> are both functionally dependent on the transaction (<code class="docutils literal notranslate"><span class="pre">CardNum</span></code>, <code class="docutils literal notranslate"><span class="pre">ISBN-10</span></code>, and <code class="docutils literal notranslate"><span class="pre">Checkout</span></code>) because one librarian processes the transaction at one branch, but the reverse is not true because one librarian processes many transactions and many transactions happen at one branch.</p></li>
<li><p>Finally, <code class="docutils literal notranslate"><span class="pre">Branch</span></code> is functionally dependent on <code class="docutils literal notranslate"><span class="pre">Librarian</span></code> because (in this example) each librarian works at only one branch, but one branch employs many librarians.</p></li>
</ul>
</section>
<section id="second-normal-form">
<h5><span class="section-number">6.2.2.1.3. </span>Second Normal Form<a class="headerlink" href="#second-normal-form" title="Link to this heading">#</a></h5>
<p>Second normal form (2NF) solves more of the problems of Codd identified. When data are organized in second normal form, it helps enforce data consistency by making it harder for new data to be entered that contradicts existing data.</p>
<p>For data to qualify as being 2NF, it must meet the following criteria:</p>
<ol class="arabic simple">
<li><p>The data must meet all the criteria to be 1NF,</p></li>
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Second_normal_form">Wikipedia</a> lists the second crition for 2NF as:</p></li>
</ol>
<blockquote>
<div><p>It does not have any non-prime attribute that is functionally dependent on any proper subset of any candidate key of the relation. A non-prime attribute of a relation is an attribute that is not a part of any candidate key of the relation.</p>
</div></blockquote>
<p>This one is tricky and takes some work to wrap your mind around, so let’s discuss what this second criterion means in practical terms. A <strong>candidate key</strong> is the same thing as a primary key - it is one column or a combination of columns whose values uniquely identify the rows of a data table. A <strong>non-prime attribute</strong> is a column that is not the primary key and is not part of a collection of columns that together construct a primary key. In the <em>TRANSACTIONS</em> entity in the library database <code class="docutils literal notranslate"><span class="pre">CardNum</span></code>, <code class="docutils literal notranslate"><span class="pre">ISBN-10</span></code>, and <code class="docutils literal notranslate"><span class="pre">Checkout</span></code> are prime attributes because they comprise the primary key, and <code class="docutils literal notranslate"><span class="pre">Patron</span></code>, <code class="docutils literal notranslate"><span class="pre">Title</span></code>, <code class="docutils literal notranslate"><span class="pre">Return</span></code>, <code class="docutils literal notranslate"><span class="pre">Librarian</span></code>, and <code class="docutils literal notranslate"><span class="pre">Branch</span></code> are non-prime attributes.</p>
<p>The condition for the data to be 2NF says that all the non-prime attributes need to depend on ALL of the attributes within the primary key, and not just SOME or ONE of them. As we saw in the previous section, of the non-prime attributes, <code class="docutils literal notranslate"><span class="pre">Return</span></code>, <code class="docutils literal notranslate"><span class="pre">Librarian</span></code>, and <code class="docutils literal notranslate"><span class="pre">Branch</span></code> depend on the entire key. But <code class="docutils literal notranslate"><span class="pre">Patron</span></code> depends only on <code class="docutils literal notranslate"><span class="pre">CardNum</span></code> and <code class="docutils literal notranslate"><span class="pre">Title</span></code> depends only on <code class="docutils literal notranslate"><span class="pre">ISBN-10</span></code>, so the data are not in 2NF.</p>
<p>There are two ways to reformat data so that it meets the rules of 2NF.</p>
<ol class="arabic simple">
<li><p>In general, data in 1NF will only fail to conform to 2NF if several columns together comprise the primary key. If the primary key is only one column, then it is not possible for any non-prime attribute to depend on only part of the primary key. The simplest way to revise our data so that it is 2NF is to create a new column (maybe called <code class="docutils literal notranslate"><span class="pre">TransactionID</span></code> in this case) that alone serves as the primary key. While this approach satisfies the rules for 2NF, it does not remove the the functional dependencies, it just moves them to relationships between non-prime attributes and that creates more problems for 3NF.</p></li>
<li><p>A better approach is to create new tables for each subset of the prime attributes that has dependent attributes, and to move those attributes to these new tables. For example, the library data has attributes that depend only on <code class="docutils literal notranslate"><span class="pre">CardNum</span></code> and attributes that only depend on <code class="docutils literal notranslate"><span class="pre">ISBN-10</span></code>. So we can create two new tables, one for patrons and one for books, that contain <code class="docutils literal notranslate"><span class="pre">CardNum</span></code> and <code class="docutils literal notranslate"><span class="pre">ISBN-10</span></code> as primary keys respectively along with all attributes that depend on these keys. The Patrons table is</p></li>
</ol>
<br>
<div class="math notranslate nohighlight">
\[PATRONS\]</div>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>CardNum</p></th>
<th class="head"><p>Patron</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>18473</p></td>
<td><p>Ernesto Hanna</p></td>
</tr>
<tr class="row-odd"><td><p>29001</p></td>
<td><p>Lakshmi Euripides</p></td>
</tr>
<tr class="row-even"><td><p>73498</p></td>
<td><p>Pia Galchobhar</p></td>
</tr>
</tbody>
</table>
</div>
<p>Note that for the Patrons table, only three rows are needed for the three patrons in the data, as opposed to the six rows in the Transactions table. We are now storing less data without losing any information. We also now have a natural location for additional information about the patrons, if we choose to collect it. We left <code class="docutils literal notranslate"><span class="pre">CardNum</span></code> in the original Transactions table because this column is being depended on by <code class="docutils literal notranslate"><span class="pre">Patron</span></code>, and it becomes a <strong>foreign key</strong> which is a column in a table which is a primary key in a different table in the database.</p>
<div class="math notranslate nohighlight">
\[BOOKS\]</div>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>ISBN-10</p></th>
<th class="head"><p>Title</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0553380168</p></td>
<td><p>A Brief History of Time</p></td>
</tr>
<tr class="row-odd"><td><p>0307389731</p></td>
<td><p>Love in the Time of Cholera</p></td>
</tr>
<tr class="row-even"><td><p>0060853980</p></td>
<td><p>Good Omens</p></td>
</tr>
<tr class="row-odd"><td><p>0143108271</p></td>
<td><p>The Master and Margarita</p></td>
</tr>
<tr class="row-even"><td><p>006073132X</p></td>
<td><p>Freakonomics: A Rogue Economist Explores the Hidden Side of Everything</p></td>
</tr>
<tr class="row-odd"><td><p>0393324818</p></td>
<td><p>Moneyball: The Art of Winning an Unfair Game</p></td>
</tr>
</tbody>
</table>
</div>
<p>Like with the Patrons table, the Books table gives us a place to store new information about books that is not relevant to specific transactions. We continue to store the authors in the separate Authorship table to account for the fact that different books have different numbers of authors.</p>
<p>We remove the columns that depended only on <code class="docutils literal notranslate"><span class="pre">CardNum</span></code> or <code class="docutils literal notranslate"><span class="pre">ISBN-10</span></code> from the Transactions table, which is now:</p>
<div class="math notranslate nohighlight">
\[TRANSACTIONS\]</div>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>CardNum</p></th>
<th class="head"><p>ISBN-10</p></th>
<th class="head"><p>Checkout</p></th>
<th class="head"><p>Return</p></th>
<th class="head"><p>Librarian</p></th>
<th class="head"><p>Branch</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>18473</p></td>
<td><p>0553380168</p></td>
<td><p>8/25/24</p></td>
<td><p>9/3/24</p></td>
<td><p>José María Chantal</p></td>
<td><p>Charlottesville</p></td>
</tr>
<tr class="row-odd"><td><p>29001</p></td>
<td><p>0307389731</p></td>
<td><p>11/23/24</p></td>
<td><p>12/14/24</p></td>
<td><p>José María Chantal</p></td>
<td><p>Charlottesville</p></td>
</tr>
<tr class="row-even"><td><p>29001</p></td>
<td><p>0060853980</p></td>
<td><p>1/7/25</p></td>
<td><p>2/3/25</p></td>
<td><p>Antony Yusif</p></td>
<td><p>Charlottesville</p></td>
</tr>
<tr class="row-odd"><td><p>29001</p></td>
<td><p>0143108271</p></td>
<td><p>4/2/25</p></td>
<td><p>NULL</p></td>
<td><p>Antony Yusif</p></td>
<td><p>Charlottesville</p></td>
</tr>
<tr class="row-even"><td><p>73498</p></td>
<td><p>006073132X</p></td>
<td><p>3/2/25</p></td>
<td><p>3/25/25</p></td>
<td><p>Dominicus Mansoor</p></td>
<td><p>Crozet</p></td>
</tr>
<tr class="row-odd"><td><p>73498</p></td>
<td><p>0393324818</p></td>
<td><p>3/24/25</p></td>
<td><p>NULL</p></td>
<td><p>Antony Yusif</p></td>
<td><p>Charlottesville</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="third-normal-form">
<h5><span class="section-number">6.2.2.1.4. </span>Third Normal Form<a class="headerlink" href="#third-normal-form" title="Link to this heading">#</a></h5>
<p>The purpose of third normal form (3NF) is to eliminate the possibility of accidentally invalidating the data by changing some non-prime attributes without also changing the non-prime attributes they are functionally dependent on.</p>
<p>The criteria for a database to qualify as being in 3NF are:</p>
<ol class="arabic simple">
<li><p>All of the criteria necessary for the database to be in 2NF.</p></li>
<li><p>“<a class="reference external" href="https://en.wikipedia.org/wiki/Third_normal_form">Every non-prime attribute … is non-transitively dependent on every [attribute]</a>”</p></li>
</ol>
<p>A simpler and more intuitive way to state the second condition is:</p>
<ol start=2>
    <li>No non-prime attribute has a functional dependency on another non-prime attribute.</li>
</ol>
<p>Functional dependence between non-prime attributes is called <strong>transitive dependence</strong> because there are two ways that a non-prime attribute (X) can be functionally dependent on the primary key (Z). X can be directly dependent on Z, or indirectly dependent through a functional dependence on another non-prime attribute (Y) that directly depends on Z. If an attribute depends on another in this indirect way, that is a transistive dependency. This condition can only violated if <em>non-prime attributes depend on one another</em>.</p>
<p>Our library database is not in 3NF because there is a functional dependency among the non-prime attributes in the TRANSACTIONS table. <code class="docutils literal notranslate"><span class="pre">Branch</span></code> depends on <code class="docutils literal notranslate"><span class="pre">Librarian</span></code> because each librarian works at only one branch, so changing the branch must imply that there is a different librarian who handled the transaction.</p>
<p>To convert a database that is in 2NF to 3NF, first find all the non-prime attributes (X) that depend on another non-prime attribute (Y) in the same table. Then remove the X attributes and create a new entity table for each Y that contains the X that depends on that Y. In this case, X is Librarian and Y is Branch, so we create a new entity for Librarians that contains Branch as a feature:</p>
<div class="math notranslate nohighlight">
\[LIBRARIANS\]</div>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Librarian</p></th>
<th class="head text-left"><p>Branch</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>José María Chantal</p></td>
<td class="text-left"><p>Charlottesville</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Antony Yusif</p></td>
<td class="text-left"><p>Charlottesville</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Dominicus Mansoor</p></td>
<td class="text-left"><p>Crozet</p></td>
</tr>
</tbody>
</table>
</div>
<p>We also remove Branch from the Transactions table:</p>
<div class="math notranslate nohighlight">
\[TRANSACTIONS\]</div>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>CardNum</p></th>
<th class="head"><p>ISBN-10</p></th>
<th class="head"><p>Checkout</p></th>
<th class="head"><p>Return</p></th>
<th class="head"><p>Librarian</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>18473</p></td>
<td><p>0553380168</p></td>
<td><p>8/25/24</p></td>
<td><p>9/3/24</p></td>
<td><p>José María Chantal</p></td>
</tr>
<tr class="row-odd"><td><p>29001</p></td>
<td><p>0307389731</p></td>
<td><p>11/23/24</p></td>
<td><p>12/14/24</p></td>
<td><p>José María Chantal</p></td>
</tr>
<tr class="row-even"><td><p>29001</p></td>
<td><p>0060853980</p></td>
<td><p>1/7/25</p></td>
<td><p>2/3/25</p></td>
<td><p>Antony Yusif</p></td>
</tr>
<tr class="row-odd"><td><p>29001</p></td>
<td><p>0143108271</p></td>
<td><p>4/2/25</p></td>
<td><p>NULL</p></td>
<td><p>Antony Yusif</p></td>
</tr>
<tr class="row-even"><td><p>73498</p></td>
<td><p>006073132X</p></td>
<td><p>3/2/25</p></td>
<td><p>3/25/25</p></td>
<td><p>Dominicus Mansoor</p></td>
</tr>
<tr class="row-odd"><td><p>73498</p></td>
<td><p>0393324818</p></td>
<td><p>3/24/25</p></td>
<td><p>NULL</p></td>
<td><p>Antony Yusif</p></td>
</tr>
</tbody>
</table>
</div>
<p>The rest of the 3NF database is:
<br>
$<span class="math notranslate nohighlight">\(PATRONS\)</span>$</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>CardNum</p></th>
<th class="head"><p>Patron</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>18473</p></td>
<td><p>Ernesto Hanna</p></td>
</tr>
<tr class="row-odd"><td><p>29001</p></td>
<td><p>Lakshmi Euripides</p></td>
</tr>
<tr class="row-even"><td><p>73498</p></td>
<td><p>Pia Galchobhar</p></td>
</tr>
</tbody>
</table>
</div>
<br>
$$BOOKS$$
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>ISBN-10</p></th>
<th class="head"><p>Title</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0553380168</p></td>
<td><p>A Brief History of Time</p></td>
</tr>
<tr class="row-odd"><td><p>0307389731</p></td>
<td><p>Love in the Time of Cholera</p></td>
</tr>
<tr class="row-even"><td><p>0060853980</p></td>
<td><p>Good Omens</p></td>
</tr>
<tr class="row-odd"><td><p>0143108271</p></td>
<td><p>The Master and Margarita</p></td>
</tr>
<tr class="row-even"><td><p>006073132X</p></td>
<td><p>Freakonomics: A Rogue Economist Explores the Hidden Side of Everything</p></td>
</tr>
<tr class="row-odd"><td><p>0393324818</p></td>
<td><p>Moneyball: The Art of Winning an Unfair Game</p></td>
</tr>
<tr class="row-even"><td><p><br></p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
</div>
<div class="math notranslate nohighlight">
\[ AUTHORSHIP \]</div>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>ISBN-10</p></th>
<th class="head"><p>Author</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0553380168</p></td>
<td><p>Stephen Hawking</p></td>
</tr>
<tr class="row-odd"><td><p>0307389731</p></td>
<td><p>Gabriel Garcia Marquez</p></td>
</tr>
<tr class="row-even"><td><p>0060853980</p></td>
<td><p>Neil Gaiman</p></td>
</tr>
<tr class="row-odd"><td><p>0060853980</p></td>
<td><p>Terry Pratchett</p></td>
</tr>
<tr class="row-even"><td><p>0143108271</p></td>
<td><p>Mikhail Bulgakov</p></td>
</tr>
<tr class="row-odd"><td><p>006073132X</p></td>
<td><p>Steven Levitt</p></td>
</tr>
<tr class="row-even"><td><p>006073132X</p></td>
<td><p>Stephen J. Dubner</p></td>
</tr>
<tr class="row-odd"><td><p>0393324818</p></td>
<td><p>Michael Lewis</p></td>
</tr>
</tbody>
</table>
</div>
<p>It can be difficult to remember the specific criteria that need to be met in order for a database to be in 1NF, 2NF, and 3NF. It helps to remember that for 1NF every data table must include a primary key (even if several columns comprise it), for 2NF every non-prime attribute must depend on the entire primary key, and for 3NF the non-prime attributes must not depend on anything other than the primary key. If it helps you, these three rules are summarized in the following sentence:</p>
<blockquote>
<div><p>Give me the key (1NF), the whole key (2NF), and nothing but the key (3NF), so help me Codd.</p>
</div></blockquote>
<p>There are <a class="reference external" href="https://en.wikipedia.org/wiki/Database_normalization#Normal_forms">many versions of normalization above and beyond 3NF</a>. They are mainly designed to prevent rare anomalies in the data.</p>
</section>
</section>
<section id="entity-relationship-diagrams">
<h4><a class="toc-backref" href="#id10" role="doc-backlink"><span class="section-number">6.2.2.2. </span>Entity-Relationship Diagrams</a><a class="headerlink" href="#entity-relationship-diagrams" title="Link to this heading">#</a></h4>
<p>The way that a database is organized with different tables, each with specific columns of particular data types, in a way that satisfies the normalization rules described above is called the <strong>database schema</strong>.</p>
<p>The best way to communicate the schema of a database is through a visualization called an <strong>entity-relationship (ER) diagram</strong>.  ER diagrams show the different tables (entities) that exist in the database, how they relate to one another and are connected to each other through primary and foreign keys, and they illustrate where and how every feature in the data is stored.</p>
<p>There are three types of ER diagram: the <strong>conceptual model</strong>, the <strong>logical model</strong>, and the <strong>physical model</strong>. These models differ only in the amount of information each one includes in the ER diagram. The conceptual model contains the least amount of information, and generally just shows the entities and the connections between them. The logical model includes the information from the conceptual model, adds the attributes within each entity, and denotes the primary and foreign keys in each entity. The physical model includes all of the information contained in the logical model and adds information about how the data will exist on a computer system, such as the data type for each attribute.</p>
<p>The problem with ER diagrams, however, is that there are many competing standards for constructing one and there is a great deal of confused language and contradictory terminology surrounding them. The first standard, now usually called <strong>Chen’s notation</strong>, was first described by <a class="reference external" href="https://dl.acm.org/doi/10.1145/320434.320440">Peter Pin-Shan Chen in 1976</a>, and uses a flow-chart like system that includes rectangles, ovals, diamonds, and connecting lines to illustrate a database. Today the most commonly used standard, however, is to use <strong>information engineering (IE) notation</strong>, also called <strong>crow’s feet notation</strong>. IE notation was first described by <a class="reference external" href="https://www.researchgate.net/publication/291448084_BASIC_DATA_STRUCTURE_MODELS_EXPLAINED_WITH_A_COMMON_EXAMPLE">Gordon C. Everest in 1976</a>, and represents entities as rectangles that contain lists of the attributes inside the entity, with lines connecting the rectangles to show the relationships between entities. Other standard notations for ER diagrams include <a class="reference external" href="https://www.vertabelo.com/blog/uml-notation/">Unified Modeling Language (UML) notation</a>, <a class="reference external" href="https://www.vertabelo.com/blog/barkers-erd-notation/">Barker’s notation</a> for Oracle systems, <a class="reference external" href="https://www.vertabelo.com/blog/arrow-notation/">Arrow notation</a>, and <a class="reference external" href="https://www.vertabelo.com/blog/idef1x-notation/">Integration DEFinition for Information Modeling (IDEF1X) notation</a>. The IE standard is now the predominant standard in industry.</p>
<p>A key concept for ER diagrams is whether two entities can be joined in a way that is <strong>one-to-one</strong>, <strong>many-to-one</strong>, <strong>one-to-many</strong>, or <strong>many-to-many</strong>. These designations refer to the number of rows in one table that match to one row in the other table. To determine the kind of matching, consider two entities X and Y, and complete the following sentences by filling out the segments inside the curly braces:</p>
<blockquote>
<div><p>One row in {Y} matches {one or many} rows in {X}</p>
</div></blockquote>
<blockquote>
<div><p>One row in {X} matches {one or many} rows in {Y}</p>
</div></blockquote>
<p>The relationship between X and Y is then one-to-one, many-to-one, one-to-many, or many-to-many based on whether we choose one or many in each of the two sets of curly braces.</p>
<p>Consider for example the Transactions and Patrons tables in the library database example. One row in Patrons matches MANY rows in Transactions, because one patron may have multiple transactions. Going in the other direction, one row in Transactions matches ONE row in Patrons because each patron has a single row in the Patrons table. So this relationship is a many-to-one relationship.</p>
<p>IE diagrams show one box for every entity in the database along with the name of the entity, and also draws lines between entities that are connected via a shared attribute. There are different types of lines to connects entities depending on whether the entities have a one-to-one, many-to-one, one-to-many, or many-to-many relationship. The basic notation for connecting lines is</p>
<img src="https://github.com/jkropko/DS-6001/raw/master/localimages/linetype.png" width="300">
<p>This notation is sometimes called “crow’s feet”, describing the appearance of the parts of these lines that indicate “many.” A conceptual ER diagram in IE notation creates these boxes and connects them, like this:</p>
<img src="https://github.com/jkropko/DS-6001/raw/master/localimages/er4_2.png" width="600">
<p>The logical model in IE notation includes the attributes contained within each entity as a list underneath the title of each box. The first attribute should be the primary key. By default, <a class="reference external" href="https://app.diagrams.net/">draw.io</a> places a horizontal divide after the first item in the list to emphasize that this first item is the primary key. To the left, there’s room to write “PK” for further clarification about which attribute is the primary key. (Codes other than PK are allowed here for more complex identification relationships.) Optionally, the lines can be drawn from a primary key directly to the foreign key it is matched to. But in this case, these matches are implied by the fact that the matching attributes have the same name in both tables.</p>
<img src="https://github.com/jkropko/DS-6001/raw/master/localimages/er5.png" width="600">
<p>The physical model contains all of the information that exists in the logical model and adds information that is important for the physical storage of the entities. In general, that means that we list the data type next to each attribute, like this:</p>
<img src="https://github.com/jkropko/DS-6001/raw/master/localimages/er6.png" width="600">
<p>There are several software packages that create ER diagrams directly from code, often using the <a class="reference external" href="https://dbml.dbdiagram.io/home/">database markup language (DBML)</a>. One software package that can be used for free is <a class="reference external" href="https://dbdocs.io/">dbdocs.io</a>.</p>
</section>
<section id="relational-database-management-systems-rdbms">
<h4><a class="toc-backref" href="#id11" role="doc-backlink"><span class="section-number">6.2.2.3. </span>Relational Database Management Systems (RDBMS)</a><a class="headerlink" href="#relational-database-management-systems-rdbms" title="Link to this heading">#</a></h4>
<p>Once a database is up and running, it’s time to choose software to handle the four CRUD operations: creating, reading, updating, and deleting records in the database. Issuing a query to the database is the same thing as performing a CRUD operation in which a selection of records is read and arranged in a table that is output by the operation. The software to perform CRUD operations on a relational database is called a relational database management system (RDBMS).</p>
<p>If your purpose is to access data stored in an existing database maintained by someone else, an RDBMS has already been chosen to manage how the data can be accessed. All you need to do in that case is learn which RDBMS has been implemented and use an interface for that DBMS to access the data. In general, one database can only work with one DBMS, although some DBMSs like PostgreSQL have built-in <a class="reference external" href="https://wiki.postgresql.org/wiki/Foreign_data_wrappers#mysql_fdw">foreign wrappers</a> to access data from databases connected to other DBMSs.</p>
<p>If, however, you are building a new database, the choice of RDBMS is up to you, and this choice can be very confusing. Wikipedia lists <a class="reference external" href="https://en.wikipedia.org/wiki/Comparison_of_relational_database_management_systems">several dozen distinct DBMSs</a> for relational databases, and the these RDBMSs mostly overlap in their functionality. For example, all of them implement queries using a coding protocol called the <strong>structured query language</strong> (SQL), which is pronounced either by saying the letters “S-Q-L” or by saying “sequel”. SQL is such a universal standard for working with relational databases that the phrases “relational database” and “SQL database” are synonymous, and non-relational databases are commonly called “NoSQL”. SQL is a programming langauge that is separate from Python, R, or another environment, but modern RDMBSs make it easy to embed SQL code into standard Python, R, or another coding language’s syntax. Although the vast majority of RDBMSs use SQL, many RDBMSs use their own implementations of SQL which can vary in small but important ways from system to system. Learning the basics of SQL code is an important topic in and of itself, and it is the focus of chapter 7.</p>
<p>Despite the fact that RDBMSs are very similar, the question of <a class="reference external" href="https://stackoverflow.com/questions/27435/mysql-vs-postgresql-for-web-applications">which RDBMS to use</a> comes up <a class="reference external" href="https://stackoverflow.com/questions/2413547/mysql-vs-sql-server-vs-oracle">again</a>, and <a class="reference external" href="https://stackoverflow.com/questions/9299127/mysql-vs-db2-rdbms">again</a>, and <a class="reference external" href="https://stackoverflow.com/questions/4813890/sqlite-or-mysql-how-to-decide">again</a>. Given all this confusion, how should you make this decision? First and foremost, it’s important to understand that any advice on this question you will find online is a matter of opinion: there’s no objectively best RDBMS, so before taking any advice from a blog or Stack Overflow post, please consider the biases of the post’s author. Some DBMSs are proprietary, for example, and “advice” articles from these sources might be thinly veiled sales pitches. That said, there are important distinctions between RDBMSs.</p>
<p>The biggest distinction is whether the RDBMS is proprietary or open source. This choice is similar to proprietary vs. open source choices in other domains, such as statistical computing, in which privately-owned options like SAS, SPSS, and Stata exist along with open source alternatives like R and Python. Proprietary database management software, like <a class="reference external" href="https://www.microsoft.com/en-us/sql-server/">Microsoft SQL Server</a>, <a class="reference external" href="https://www.oracle.com/database/">Oracle</a>, and <a class="reference external" href="https://www.ibm.com/analytics/db2">IBM DB2</a> offer a lot of features, including cloud computing and storage. Paid licenses for these options also usually come with dedicated support resources, and that makes sense for large enterprise databases that do not want to depend on volunteers to build the framework of the DBMS and will not consult crowd-sourced forums for troubleshooting. But these options can be expensive. Alternatively, open source RDBMSs are free, and are covered under licenses like the <a class="reference external" href="https://en.wikipedia.org/wiki/GNU_General_Public_License">GNU General Public License</a>, which allows users the freedom to run, study, share, and modify the software. It can be argued that open source software cannot be trusted, as it is maintained by volunteers who lack the accountability of paid workers at a large firm like Oracle, Microsoft, or IBM. But there’s a compelling argument that open-source software is even more trustworthy than proprietary software because open-source projects generally have <a class="reference external" href="https://en.wikipedia.org/wiki/Linus%27s_law">a lot more people checking the source code for errors</a> and because software that does not allow users to view the source code can encourage <a class="reference external" href="https://www.gnu.org/philosophy/can-you-trust.html">bad, secretive behaviors</a> from the software. As of September 2024, open source RDBMSs and proprietary RDBMSs were about <a class="reference external" href="https://db-engines.com/en/ranking_osvsc">equally popular</a>.</p>
<p>Python and Jupyter Lab are both open source, and many of the most important tools in data science are open source. So I recommend also using open source options for database management. The three most widely-used open source RDBMSs are</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p></p></th>
<th class="head text-center"><p></p></th>
<th class="head text-left"><p></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><div style="font-size: 50px">MySQL</div></p></td>
<td class="text-center"><p><img src="https://upload.wikimedia.org/wikipedia/en/d/dd/MySQL_logo.svg" width="200"></p></td>
<td class="text-left"><p><div style="font-size: 20px"><a class="reference external" href="https://www.mysql.com/">https://www.mysql.com/</a></div></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><div style="font-size: 50px">SQLite</div></p></td>
<td class="text-center"><p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/38/SQLite370.svg/1200px-SQLite370.svg.png" width="200"></p></td>
<td class="text-left"><p><div style="font-size: 20px"><a class="reference external" href="https://www.sqlite.org/index.html">https://www.sqlite.org/index.html</a></div></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><div style="font-size: 50px">PostgreSQL</div></p></td>
<td class="text-center"><p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/29/Postgresql_elephant.svg/1200px-Postgresql_elephant.svg.png" width="150"></p></td>
<td class="text-left"><p><div style="font-size: 20px"><a class="reference external" href="https://www.postgresql.org/">https://www.postgresql.org/</a></div></p></td>
</tr>
</tbody>
</table>
</div>
<p>The following discussion draws heavily on the excellent blog post by <a class="reference external" href="https://www.digitalocean.com/community/tutorials/sqlite-vs-mysql-vs-postgresql-a-comparison-of-relational-database-management-systems">“ostezer” and Mark Drake</a> that carefully compares the SQlite, MySQL, and PostgreSQL RDBMSs. For more detailed explanations of the differences between the three systems, read their post.</p>
<p>MySQL (pronounced “my sequel”), SQLite (pronounced “sequel light”), and PostgreSQL (pronounced “post-gress”) all have strengths and weaknesses relative to each other, and none of them are unambiguously better than the others. The best approach is to understand what is distinctive about each RDBMS and to choose the system that best suits your particular needs. There are several areas in which these three RDBMSs differ:</p>
<ol class="arabic simple">
<li><p><strong>Local or networked connectivity</strong>: Does the RDBMS work over networked connections, such as cloud storage, or does it only work on databases stored on a local harddrive? If it works over a network, does it depend on a single server? If so, what steps does it take to achieve ACID compliance even when that server goes down for some reason?</p></li>
<li><p><strong>Size and speed of the software</strong>: How much space does the RDBMS itself take up in local or remote memory? How quickly will the RDBMS process a query?</p></li>
<li><p><strong>Security</strong>: What procedures are in place to limit which users can access the data?</p></li>
<li><p><strong>Popularity</strong>: More popular DMBSs will have the bigger communities of developers. Those communities will in general produce better documentation for the software, and will develop more third party extensions for the software.</p></li>
<li><p><strong>Functionality and SQL compliance</strong>: Functionality refers to the set of tasks that a particular DBMS is able to run, and some DBMSs have abilities that other DBMSs do not. Functionality is in part determined by how much a DBMS complies with the entire SQL coding standard. SQL is a language that exists outside the control of any particular DBMS and the full set of SQL commands and syntax is maintained by the <a class="reference external" href="https://en.wikipedia.org/wiki/ANSI">American National Standards Institute (ANSI)</a> and the <a class="reference external" href="https://en.wikipedia.org/wiki/ISO">International Organization for Standardization (ISO)</a>. Although most RDMSs use SQL, not every RDBMS implements everything from standard SQL. Some RDBMSs, however, provide new functions that are outside standard SQL.</p></li>
</ol>
<p>The following table describes the strengths and weaknesses of open-source RDBMSs with regard to the considerations listed above:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Consideration</p></th>
<th class="head text-left"><p>MySQL</p></th>
<th class="head text-left"><p>SQLite</p></th>
<th class="head text-left"><p>PostgreSQL</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>Connectivity</p></td>
<td class="text-left"><p>MySQL is fully equipped for networks, and it a popular choice for web-applications. However, it can violate ACID protocols when many users are issuing read and write commands at the same time.</p></td>
<td class="text-left"><p>Unlike MySQL and PostgreSQL, SQLite does not run a server process, which means that it does not work over networked connections. It works strictly on a local machine. It’s a good choice for organizing data for the use of one person, or to support an application that runs locally, but it is not a viable option for sharing data.</p></td>
<td class="text-left"><p>PostgreSQL is fuly capable of networked connections and employs advanced techniques to ensure transactions comply with the ACID standards.</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Size and speed</p></td>
<td class="text-left"><p>MySQL has a reputation for being the fastest open source RDBMS.</p></td>
<td class="text-left"><p>SQLite is designed to be as lightweight as possible, taking up minimal space in memory. But the space available for storing data is limited by the space available on the local harddrive.</p></td>
<td class="text-left"><p>PostgreSQL is generally slower than MySQL (though the differences are often slight or negligable), but it efficiently uses multiple CPUs to handle queries faster.</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Security</p></td>
<td class="text-left"><p>MySQL allows database owners to manage the credentials and privileges of individual database users.</p></td>
<td class="text-left"><p>SQLite is designed for one person to access the data on local storage, so there’s no mechanism for allowing different users to have different credentials for accessing the data.</p></td>
<td class="text-left"><p>PostgreSQL has all of the security features that MySQL has, and exceeds them in some cases, although there is <a class="reference external" href="https://stackoverflow.com/questions/6475228/postgresqls-security-compared-to-mysql-etc">debate about whether PostgreSQL or MySQL is more secure</a>.</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Popularity as of September 2024</p></td>
<td class="text-left"><p>MySQL is the <a class="reference external" href="https://db-engines.com/en/ranking">most popular</a> open source RDBMS, and is the second most popular RDBMS overall.</p></td>
<td class="text-left"><p>SQLite is the <a class="reference external" href="https://db-engines.com/en/ranking">6th most popular</a> open source RDBMS and 10th most popular overall. But it is a popular addition to application software that is deployed on local systems, such as web browsers.</p></td>
<td class="text-left"><p>PostgreSQL is the <a class="reference external" href="https://db-engines.com/en/ranking">2nd most popular</a> open source RDBMS and 4th most popular RDBMS overall. It is also <a class="reference external" href="https://db-engines.com/en/ranking_trend">growing in popularity</a> more quickly than MySQL or SQLite. There are many third party extensions, just not as many as are available for MySQL right now. While MySQL and SQLite have proprietary elements that sell extensions to the open source base software, PostgreSQL is fully open source.</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Functionality</p></td>
<td class="text-left"><p>MySQL does not implement the full set of SQL functions in order to boost the speed of queries. Specifically, it cannot perform full joins. But it does have a big community of developers that create extensions.</p></td>
<td class="text-left"><p>SQLite implements most of SQL, generally following the functionality of PostgreSQL. SQLite handles fewer data types than MySQL and PostgreSQL.</p></td>
<td class="text-left"><p>PostgreSQL implements most of SQL, more than MySQL does, and is designed to work well with object oriented programming languages. It handles more data types than MySQL, including JSON records.</p></td>
</tr>
</tbody>
</table>
</div>
<p>To summarize, SQLite only works on local systems, although it has many advantages for applications that do not require a network connection: it is lightweight and easy to use and initialize. MySQL and PostgreSQL both work well for allowing users to access the data remotely, and can easily set up credentials for individual users to selectively access parts of the database. MySQL is the most popular open source option, and has been for a while, and is still the fastest option although it is missing some of the functionality that is present in universal SQL. PostgreSQL has functionality that is as close as possible to the complete SQL standard. Also, while MySQL remains open source, its development company is now owned by Oracle, which has been spinning off various proprietary extensions to MySQL. In contrast, PostgreSQL and its extensions all remain open source.</p>
</section>
</section>
<section id="nosql-databases">
<h3><a class="toc-backref" href="#id12" role="doc-backlink"><span class="section-number">6.2.3. </span>NoSQL Databases</a><a class="headerlink" href="#nosql-databases" title="Link to this heading">#</a></h3>
<p>The term “NoSQL” refers to a database that is not organized according to a relational schema, and therefore cannot use any DBMS that uses SQL. A better name for these schema is “non-relational”. NoSQL databases are a recent innovation that have gotten a lot of hype over the last ten years, and it is described in various places as “<a class="reference external" href="https://aws.amazon.com/nosql/">modern</a>” and “<a class="reference external" href="https://www.academia.edu/40346447/Next_Generation_Databases_NoSQL_NewSQL_and_Big_Data_-_What_every_professional_needs_to_know_about_the_future_of_databases_in_a_world_of_NoSQL_and_Big_Data_-_Guy_Harrison">next generation</a>”. Although the language surrounding NoSQL has only existed since the 2000s, the concept of non-relational databases is as old as databases themselves, as the original navigational schema are be considered versions of NoSQL today.</p>
<p>In addition to the key-value store, document store, wide-column store, and graph versions of NoSQL databases described below, there are specialized NoSQL DBMSs for time series data (<a class="reference external" href="https://github.com/influxdata/influxdb">influxDB</a>), object oriented data stores (<a class="reference external" href="https://www.intersystems.com/products/cache/">InterSystems Caché</a>), search engines (<a class="reference external" href="https://www.elastic.co/elasticsearch/">Elasticsearch</a>), Triplestores, Resource Description Framework (RDF), or XML Stores (<a class="reference external" href="https://www.marklogic.com/">MarkLogic</a>), Multivalue Systems (<a class="reference external" href="https://www.softwareag.com/corporate/products/adabas_natural/adabas/default.html">Adabas</a>), Event Stores (<a class="reference external" href="https://eventstore.com/">Event Store</a>), and Content Stores (<a class="reference external" href="http://jackrabbit.apache.org/jcr/index.html">Apache Jackrabbit</a>).</p>
<section id="comparing-nosql-databases-to-relational-databases">
<h4><a class="toc-backref" href="#id13" role="doc-backlink"><span class="section-number">6.2.3.1. </span>Comparing NoSQL Databases to Relational Databases</a><a class="headerlink" href="#comparing-nosql-databases-to-relational-databases" title="Link to this heading">#</a></h4>
<p>Some people argue that NoSQL is a replacement for relational databases, but the reality is that NoSQL and relational databases are well-suited for different purposes and both are likely to remain in the standard toolkit of professionals who work with data for a long time.</p>
<p>NoSQL differs from relational databases in three ways:</p>
<ol class="arabic simple">
<li><p>Unlike relational databases, a NoSQL database allows for a <strong>flexible schema</strong>.</p></li>
</ol>
<p>The term “flexible schema” does not have a specific definition, but it is generally understood to mean a relaxation of the restrictions that relational databases require. For example, when describing <a class="reference external" href="https://aws.amazon.com/dynamodb/">DynamoDB</a>, a NoSQL DBMS owned by Amazon, Amazon’s Chief Technology Officer Werner Vogels <a class="reference external" href="https://www.allthingsdistributed.com/2512/01/amazon-dynamodb.html">wrote</a>:</p>
<blockquote>
<div><p>Amazon DynamoDB is an extremely flexible system that does not force its users into a particular data model … . DynamoDB tables do not have a fixed schema but instead allow each data item to have any number of attributes, including multi-valued attributes.</p>
</div></blockquote>
<p>In other words, when we input a record into a NoSQL database, the attributes in the record, the number of attributes, and the data type of each attribute can change from record to record. We alter the structure of the data to match the specific needs of each record. With NoSQL databases we do not have to follow the rules of any normal form, so multi-valued attributes and non-prime and transitive dependencies are fine.</p>
<p>Relational databases in contrast are very strictly organized. That makes the database easier to use once it is constructed because the ER diagram illustrates where all of the data are stored, and normalization goes a long way towards preventing errors. But in order for a relational database to be worthwhile, there’s a lot of work that has to go in to the design and building of the database, and the data that goes into the database must fit within the tightly controlled schema. For example, the library database described earlier is in 3NF. It’s easy to add new transactions, patrons, books, authors, or librarians to the data. It’s also easy to add new attributes, just so long as they include a key that matches with a primary key in one of the attributes. But it is much more difficult to alter the schema to express the situation in which librarians can work at more than one library branch, or to add items to be checked out that aren’t books, or to handle a patron whose library card has expired and is requesting a new card. All of these transactions are records that the library would want to keep track of, and there is nowhere in the relational database as it is currently organized to store these data. We can reorganize the database, but that would be a lot of work if we already have a great deal of data stored. We would also find ourselves in the same position of being unable to process new data every time the library provides a new class of items or another novel situation occurs that the library would want to keep track of.</p>
<p>An alternative strategy is to store data in a NoSQL database. We can input a record of a patron using a public computer for 30 minutes into a NoSQL database in JSON format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">cardNum</span><span class="o">=</span><span class="mi">18473</span><span class="p">,</span>
<span class="n">Patron</span><span class="o">=</span><span class="s2">&quot;Ernesto Hanna&quot;</span><span class="p">,</span>
<span class="n">Service</span><span class="o">=</span><span class="s2">&quot;Public computer use&quot;</span><span class="p">,</span>
<span class="n">Duration</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
<span class="n">Date</span><span class="o">=</span><span class="s2">&quot;04/24/2520&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>In practice, relational databases require a lot of work when building the database, but all that work makes it easier to query and work with data once the database has been built. In contrast, NoSQL databases require much less work at the outset because every record may follow its own schema, but that flexibility results in more work being necessary to extract a selection of data and to prepare it to be analyzed.</p>
<ol start=2>
    <li>NoSQL databases are easier than relational databases to store on <b>distributed systems</b> by using <b>sharding</b>.</li>
</ol>
<p>A distributed system is network of many separate but connected computers or data servers. Sharding is the act of breaking a database into many distinct parts by storing subsets of the database’s records in separate, smaller databases, called shards. Once a database has been sharded, it can be stored on a distributed system: instead of placing the entire database into one massive storage device (increasing the capacity of one storage device is called <strong>vertical scaling</strong>), we break the database into shards and store each shard on a different storage device (increasing the number of storage devices is called <strong>horizontal scaling</strong>).</p>
<p>It is easier to shard a NoSQL database than it is to shard a relational database. A NoSQL database is a container for many records and does not use different data tables, and that’s why it is straightforward to move single NoSQL records in their entirety to new storage. In contrast, a relational database has separate data tables for each entity, and the concept of a record is much fuzzier: given one library transaction, for example, data about that transaction comes from separate tables for the patron, the book, the book’s authors, and the librarian. It’s not possible to operate on a record in its entirety without first joining all of these tables, and even then, there’s ambiguity about what counts as a record (is it a transaction? a patron? a book? an author? or all of the above?). The puzzle of how exactly to shard a relational database makes horizontal scaling much more difficult for relational databases. For startups and other organizations that cannot invest in the infrastructure to store massive databases in a single storage device, building a NoSQL database and sharding is an economical option.</p>
<ol start=3>
<li>Unlike relational databases, NoSQL databases do not always follow the [ACID](#acid) standards. Instead, they follow the <b>BASE</b> standards.</li>
</ol>
<p>ACID governs how layers of systems involved with one transaction communicate. One of the ACID standards is consistency, which requires that every system has the exact same data. Consistency takes time, as all of the systems need to be updated before a transaction is considered complete. We wait several moments for credit card transactions to process as the various banks and credit card companies sync their data, for example.</p>
<p>But consistency is sometimes too much of a burden on a data sharing system. Take for example a cloud storage system like Dropbox: when you save a file in the Dropbox folder on your computer, it may take several moments for the file to upload to the Dropbox server and several more moments for the server to sync your data with the other devices that are connected to your Dropbox account. During these moments, the data in your local folder differ from the data on the server, so this transaction does not satisfy the ACID requirements. While Dropbox is syncing your files, you are still able to use those files on your computer despite the fact that those files may be different from the ones on the server. This process works because a Dropbox user is confident that the files will all sync up <em>eventually</em>, once Dropbox processes the changes.</p>
<p>The way Dropbox syncs files does not accord with ACID, but it does meet a different set of standards called called <a class="reference external" href="https://neo4j.com/blog/acid-vs-base-consistency-models-explained/">BASE</a> (get it? ACID vs BASE), which are:</p>
<ul class="simple">
<li><p><strong>Basic Availability</strong>: The system should be usable at any given point in time, regardless of how much progress the system has made in syncing data across servers. For Dropbox, that means that a user can still access their files even if they haven’t yet been uploaded to the Dropbox server or synced to other devices.</p></li>
<li><p><strong>Soft-state</strong>: Because the system is constantly updating and syncing data, at any point in time we do not know the true state of the system.</p></li>
<li><p><strong>Eventual consistency</strong>: The system will, given enough time, sync all data to be the same across all the servers connected to the database.</p></li>
</ul>
<p>One advantage of relaxing ACID in favor of BASE is speed. Without the requirement that all data on the system must sync up in real time, individual transactions can proceed more quickly. That’s a big advantage for organizations whose operations depend on quick responses. The disadvantage is that we cannot be certain without the assurances of ACID that the data we use are in fact correct. In some cases working with out-of-date data can be illegal or can lead to unacceptable business risks, but in other situations there can be a lot of tolerance for some incorrect data. Whether or not a database needs to follow the ACID protocols depends on what we need the database to do.</p>
<p>NoSQL databases often follow the BASE standards, and not ACID, because BASE makes more sense in a distributed system. When a database is sharded, it might exist across hundreds or thousands of servers, and updating data across all of those servers can take a significant amount of time. Waiting to achieve total data consistency before using the data to do something can take a prohibitive amount of time. The BASE standards are much more forgiving for applications that need to work faster than the speed at which data updates.</p>
</section>
<section id="key-value-stores">
<h4><a class="toc-backref" href="#id14" role="doc-backlink"><span class="section-number">6.2.3.2. </span>Key-Value Stores</a><a class="headerlink" href="#key-value-stores" title="Link to this heading">#</a></h4>
<p>The three most common types of NoSQL database are <strong>key-value stores</strong> (or key-value databases), <strong>document stores</strong> (or document-oriented databases), and <strong>wide-column stores</strong> (or column-based stores or column-oriented databases). Each format involves three types of data:</p>
<ol class="arabic simple">
<li><p>A key that uniquely identifies each record and is queryable,</p></li>
<li><p>A document (or array, or dictionary) that contains all of the data for a record,</p></li>
<li><p>And metadata that describes the relationships between documents.</p></li>
</ol>
<p>A key-value store is the simplest way to organize data in a NoSQL database. Every record is stored as a tuple of length 2: the first item is a key, and the second value is a string that contains all of the data for that key. For example, the library data can be stored in key-value format as follows:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Key</p></th>
<th class="head text-left"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>1</p></td>
<td class="text-left"><p>[18473, Ernesto Hanna, A Brief History of Time, Stephen Hawking, 8/25/24, 9/3/24, José María Chantal, Charlottesville]</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>2</p></td>
<td class="text-left"><p>[29001, Lakshmi Euripides, Love in the Time of Cholera, Gabriel Garcia Marquez, 11/23/24, 12/14/24, José María Chantal, Charlottesville]</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>3</p></td>
<td class="text-left"><p>[29001, Lakshmi Euripides, Anne of Green Gables, L.M. Montgomery, 1/7/25, 2/3/25, Antony Yusif, Charlottesville]</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>4</p></td>
<td class="text-left"><p>[29001, Lakshmi Euripides, The Master and Margarita, Mikhail Bulgakov, 4/2/25, Antony Yusif, Charlottesville]</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>5</p></td>
<td class="text-left"><p>[73498, Pia Galchobhar, Freakonomics: A Rogue Economist Explores the Hidden Side of Everything, Steven Levitt, Stephen J. Dubner, 3/2/25, 3/25/25, Dominicus Mansoor, Crozet]</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>6</p></td>
<td class="text-left"><p>[73498, Pia Galchobhar, Moneyball: The Art of Winning an Unfair Game, Michael Lewis, 3/24/25, NULL, Antony Yusif, Charlottesville]</p></td>
</tr>
</tbody>
</table>
</div>
<p>In the key-value NoSQL structure, the key is <strong>visible</strong> to the DBMS, which means that we can perform searches or queries for particular keys, but the rest of the data are <strong>opaque</strong>, which means that they are only recognized by the DBMS as a single sting, and we cannot query or search for values of these attributes. Because the DBMS is agnostic about the content of the string, it is possible to put any kind of formatting into the Value field: it can organize the data in a list or array, in a JSON dictionary, or in another structure. It can contain column names, or not. The key-value DBMS can only import this string into another environment, like Python, and it is up to code in the import environment to parse the formatting. That can be extremely tricky because each Value field can contain different attributes and data types. In this example the 4th record is lacking a return date, and the 5th record has two authors: when we read the data, we need to use our knowledge of the data to catch and account for these discrepancies. The advantage of a key-value database is the speed with which it processes queries about a specific key, but the disadvantage is that is cannot query data beyond the key, and the data it returns might be in need of a lot of cleaning. As of April 2020, the <a class="reference external" href="https://db-engines.com/en/ranking/key-value+store">most popular key-value store DBMS</a> is <a class="reference external" href="https://redis.io/">Redis</a>, which is open source.</p>
</section>
<section id="document-stores">
<h4><a class="toc-backref" href="#id15" role="doc-backlink"><span class="section-number">6.2.3.3. </span>Document Stores</a><a class="headerlink" href="#document-stores" title="Link to this heading">#</a></h4>
<p>A document store is similar to a key-value store, with two important differences:</p>
<ol class="arabic simple">
<li><p>The Value field in a document store must be formatted as JSON (or as XML for an XML-oriented database),</p></li>
<li><p>And unlike a key-value database, it is possible to query data based on the fields within the JSON records.</p></li>
</ol>
<p>The first transaction in the library data, for example, is stored in the document store like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">transactionID</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="n">cardNum</span><span class="o">=</span><span class="mi">18473</span><span class="p">,</span>
<span class="n">Patron</span><span class="o">=</span><span class="s2">&quot;Ernesto Hanna&quot;</span><span class="p">,</span>
<span class="n">Book</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;A Brief History of Time&quot;</span><span class="p">,</span> <span class="s2">&quot;Stephen Hawking&quot;</span><span class="p">],</span>
<span class="n">Checkout</span><span class="o">=</span><span class="s2">&quot;8/25/24&quot;</span><span class="p">,</span>
<span class="n">Return</span><span class="o">=</span><span class="s2">&quot;9/3/24&quot;</span><span class="p">,</span>
<span class="n">Librarian</span><span class="o">=</span><span class="s2">&quot;José María Chantal&quot;</span><span class="p">,</span> 
<span class="n">Branch</span><span class="o">=</span><span class="s2">&quot;Charlottesville&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>One JSON record in a document store is called, fittingly, a <strong>document</strong>. Documents contain the key and also the entirety of the Value field, so like a key-value store, it is possible to query the keys. But it is also possible to query any of the fields within this JSON. We could, for example, search for records in which the <code class="docutils literal notranslate"><span class="pre">Patron</span></code> field exists and is equal to <code class="docutils literal notranslate"><span class="pre">&quot;Ernesto</span> <span class="pre">Hanna&quot;</span></code>.</p>
<p>Document stores have more functionality than key-value databases. In addition to the ability to issue more complex queries, document stores can be converted to <strong>search engine databases</strong> with <a class="reference external" href="https://github.com/elastic/elasticsearch">software that implements a search engine</a> to extract data from the documents. In addition, it is possible to store metadata in a JSON record along with the regular data to organize documents or to create an extra layer of security for particular documents. The disadvantage of a document store relative to a key-value store is that the extra functionality results in bigger DBMSs and slower responses, in general. While document stores allow for flexible schema that cannot fit within a relational framework, queries return lists of JSON-formatted records which need to be parsed by code in an external environment.</p>
<p>The <a class="reference external" href="https://db-engines.com/en/ranking/document+store">most popular document store as of April 2020</a> is <a class="reference external" href="https://www.mongodb.com/">MongoDB</a>, which is also the most popular DBMS among all NoSQL options, and the 5th most popular DBMS overall.</p>
</section>
<section id="wide-column-stores">
<h4><a class="toc-backref" href="#id16" role="doc-backlink"><span class="section-number">6.2.3.4. </span>Wide-Column Stores</a><a class="headerlink" href="#wide-column-stores" title="Link to this heading">#</a></h4>
<p>A wide column store, like a relational database, contains tables. However unlike a relational database, every table has only one row, and each of these tables might have different columns.</p>
<p>Two of the records in the library data look like this in wide-column format:</p>
<div class="math notranslate nohighlight">
\[TransactionID = 4\]</div>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p>CardNum</p></th>
<th class="head text-left"><p>Patron</p></th>
<th class="head text-left"><p>BookTitle</p></th>
<th class="head text-left"><p>Author</p></th>
<th class="head text-left"><p>Checkout</p></th>
<th class="head text-left"><p>Librarian</p></th>
<th class="head text-left"><p>Branch</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>29001</p></td>
<td class="text-left"><p>Lakshmi Euripides</p></td>
<td class="text-left"><p>The Master and Margarita</p></td>
<td class="text-left"><p>Mikhail Bulgakov</p></td>
<td class="text-left"><p>4/2/25</p></td>
<td class="text-left"><p>NULL</p></td>
<td class="text-left"><p>Antony Yusif</p></td>
</tr>
</tbody>
</table>
</div>
<div class="math notranslate nohighlight">
\[TransactionID = 5\]</div>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p>CardNum</p></th>
<th class="head text-left"><p>Patron</p></th>
<th class="head text-left"><p>BookTitle</p></th>
<th class="head text-left"><p>Author</p></th>
<th class="head text-left"><p>SecondAuthor</p></th>
<th class="head text-left"><p>Checkout</p></th>
<th class="head text-left"><p>Return</p></th>
<th class="head text-left"><p>Librarian</p></th>
<th class="head text-left"><p>Branch</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>73498</p></td>
<td class="text-left"><p>Pia Galchobhar</p></td>
<td class="text-left"><p>Freakonomics: A Rogue Economist Explores the Hidden Side of Everything</p></td>
<td class="text-left"><p>Steven Levitt</p></td>
<td class="text-left"><p>Stephen J. Dubner</p></td>
<td class="text-left"><p>3/2/25</p></td>
<td class="text-left"><p>3/25/25</p></td>
<td class="text-left"><p>Dominicus Mansoor</p></td>
<td class="text-left"><p>Crozet</p></td>
</tr>
</tbody>
</table>
</div>
<p>Like key-value and document stores, wide-column stores have records with a unique key and a document that contains the data where the schema is flexible. In this case, the table associated with <code class="docutils literal notranslate"><span class="pre">TransactionID=4</span></code> lacks a return date, and the table associated with <code class="docutils literal notranslate"><span class="pre">TransactionID=5</span></code> adds a second author column. Wide-column stores are very similar to document stores in that it is possible to issue a query based on any of the columns. It is also possible to include metadata by clustering columns under shared tags called <strong>supercolumns</strong>. For example, <code class="docutils literal notranslate"><span class="pre">BookTitle</span></code>, <code class="docutils literal notranslate"><span class="pre">Author</span></code>, and <code class="docutils literal notranslate"><span class="pre">SecondAuthor</span></code> may all be clustered within the supercolumn <code class="docutils literal notranslate"><span class="pre">Book</span></code>. These supercolumn families follow exactly the same logic as fields nested within other fields in a JSON tree.</p>
<p>Generally speaking wide-column stores offer the same functionality as document stores, but operate on tables instead of on JSON records. The <a class="reference external" href="https://db-engines.com/en/ranking/wide+column+store">most popular column-oriented DBMS as of April 2020</a> is <a class="reference external" href="https://cassandra.apache.org/">Cassandra</a>.</p>
</section>
<section id="graph-databases">
<h4><a class="toc-backref" href="#id17" role="doc-backlink"><span class="section-number">6.2.3.5. </span>Graph Databases</a><a class="headerlink" href="#graph-databases" title="Link to this heading">#</a></h4>
<p><strong>Graph databases</strong> describe an entirely different paradigm of data models. The key-value, document, and wide-column stores work with <em>independent</em> records. For these systems to work, no record should contain attributes that point to other records in the data. That way, it’s not a problem to treat records separately and store them on different servers. Relational databases on the other hand contain dependencies because the different entities in the data are related to one another. However these relationships exist between columns stored in different tables, not between the records themselves.</p>
<p>If the records in a database are directly related to each other, a graph database provides a way to store specific data about these relationships. The <a class="reference external" href="https://neo4j.com/docs/getting-started/current/graphdb-concepts/">graph database schema</a> combines a relational and wide-column framework. First, each record is stored in a table with one row, as would be the case in a wide-column store. Next the tables are broken into separate entities, as we would do in a relational schema. That is, attributes that would continue to exist in the same entity in a relational database also exist in the same entity in a graph database.</p>
<p>Every entity for every record in a graph database is called a <strong>node</strong>. Every node has at least one <strong>label</strong>, the name of the entity, attached to it. In the library data, we have nodes for transaction, patron, librarian, book, and author. The attributes within one node are called <strong>properties</strong>. Nodes are connected to other nodes through <strong>relationships</strong>, which are represented by an arrow that is directed from one node to another. The node the arrow starts from is called the <strong>source node</strong>, and the relationship for this node is called an <strong>outgoing relationship</strong>; the node the arrow points to is called the <strong>target node</strong>, and the relationship for this node is called an <strong>incoming relationship</strong>. Every arrow is labeled with text describing the <strong>relationship type</strong>.</p>
<p>It can be confusing to know which node is the source and which is the target and what direction the arrow should point, but it is easier to remember that these symbols should follow natural language. We usually say the target node first and the source node second. For example, in the library data, <em>transactions are conducted on behalf of patrons</em>. In this case:</p>
<ul class="simple">
<li><p>TRANSACTION is a source node,</p></li>
<li><p>PATRON is a target node,</p></li>
<li><p>and the relationship points from TRANSACTION to PATRON and is labeled “on behalf of”.</p></li>
</ul>
<p>Breaking a database into nodes for individual records and entities adds complication. But it does provide the advantage of allowing relationships to exist between records in addition to entities. For example, suppose that the library has a program in which parents can apply for library cards for their children. The library might want to know the parent of a child in their patrons table.  Suppose that library patron Pia Galchobhar checks out “Freakonomics: A Rogue Economist Explores the Hidden Side of Everything” by Steven Levitt and Stephen J. Dubner on March 2, 2020 from the Crozet branch, where she is helped by librarian Dominicus Mansoor, and returns it on March 20. Four days later she visits the Charlottesville branch with her daughter Dina where librarian Antony Yusif checks out “Moneyball: The Art of Winning an Unfair Game” by Michael Lewis for her, and “Alice in Wonderland” by Lewis Carroll for Dina. These data have the following graph representation:</p>
<img src="https://github.com/jkropko/DS-6001/raw/master/localimages/graph2.png" width="900">
<p>The arrow that points from the patron node for Pia Galchobhar to the patron node for Dina tells us that Pia is Dina’s parent. All of the other information, however, is also possible to represent in a relational database with an ER diagram. So unless there is compelling information regarding the relationship between records, a relational database is a more elegant and compact representation of the data. As of April 2020, the <a class="reference external" href="https://db-engines.com/en/ranking/graph+dbms">most popular graph database</a> is <a class="reference external" href="https://neo4j.com/">neo4j</a>, which has a great deal of functionality to store graph structured data and to query based on nodes, relationships, labels, or properties. neo4j is also compliant with the ACID standards.</p>
</section>
</section>
</section>
<section id="working-with-databases-in-python">
<h2><a class="toc-backref" href="#id18" role="doc-backlink"><span class="section-number">6.3. </span>Working With Databases in Python</a><a class="headerlink" href="#working-with-databases-in-python" title="Link to this heading">#</a></h2>
<p>There are three challenges that working with databases in Python entails:</p>
<ul class="simple">
<li><p>Installing the database systems, which are external to Python</p></li>
<li><p>Installing and importing the Python packages that we need to connect to these database systems and to issue queries to them</p></li>
<li><p>And setting up a quick way to send commands via SQL or another query language to these systems from Python, getting data back in the form of a pandas dataframe</p></li>
</ul>
<p>There are many approaches to solving these challenges. I will describe some methods to solve them quickly that are applicable on Mac, Windows, and Linux systems both locally and on the cloud.</p>
<section id="installing-database-systems-using-docker">
<h3><a class="toc-backref" href="#id19" role="doc-backlink"><span class="section-number">6.3.1. </span>Installing Database Systems Using Docker</a><a class="headerlink" href="#installing-database-systems-using-docker" title="Link to this heading">#</a></h3>
<p>Only a few database systems, such as SQLite, operate on files only. SQLite exists as a Python package, and databases are stored as files on the disk. These files work just like any other data file we worked with in the prior chapters.</p>
<p>All other database systems set up a separate server that must run either on your own computer’s working memory or on a virtual machine on a cloud system like Amazon Web Services. Those servers usually take the form of separate software that must be installed and run on a machine. Database systems are notoriously difficult to install because the number of configuration parameters and security layers that must be managed is hard to deal with.</p>
<p>The easiest way to install a database system on your machine is to use a <strong>container</strong>. A container runs on a system, such as your computer, and simulates an entirely different computer. Specific kinds of software and configurations can exist inside the container without existing outside the container elsewhere on the system. For example, you can use a container to run Windows on a Mac, or vice versa, or Linux on any system. One major use of containers is to package and distribute software when the software has difficult configuration and storage requirements, as is the case with database systems. The major software for building and managing containers is called Docker, and images (zipped directories that build specific containers) can be stored and shared for free via a website called <a class="reference external" href="https://hub.docker.com">Docker Hub</a>. There are Docker images available for free that deploy <a class="reference external" href="https://hub.docker.com/_/mysql">MySQL</a>, <a class="reference external" href="https://hub.docker.com/_/postgres">PostgreSQL</a>, <a class="reference external" href="https://hub.docker.com/_/mongo">MongoDB</a>, and many other database systems. These images have set up everything the database needs to function inside the container.</p>
<p>This section will cover the main steps needed to use Docker to run MySQL, PostgreSQL, and Mongo. In practice you will probably not need all three of these systems, in which case you can follow the steps but skip the lines of code that reference a system you are not using. If you need a different database system, look on Docker Hub for the official image for that system, and follow these steps using whatever ENV variables, ports, data directories, and specific configurations the Docker Hub page indicates. For a longer and more detailed discussion of Docker as it relates to a data science workflow, see the <a class="reference external" href="https://jkropko.github.io/surfing-the-data-pipeline/docker.html">Appendix</a>.</p>
<p><strong>Step 1</strong>: Install or update the following Python packages:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">-</span><span class="n">connector</span><span class="o">-</span><span class="n">python</span>
<span class="n">psycopg</span><span class="p">[</span><span class="n">binary</span><span class="p">,</span><span class="n">pool</span><span class="p">]</span>
<span class="n">pymongo</span>
<span class="n">sqlalchemy</span>
<span class="n">python</span><span class="o">-</span><span class="n">dotenv</span>
</pre></div>
</div>
<p>Please note, there are packages named <code class="docutils literal notranslate"><span class="pre">mysql-connector</span></code> and <code class="docutils literal notranslate"><span class="pre">psycopg2</span></code>, but we specifically need <code class="docutils literal notranslate"><span class="pre">mysql-connector-python</span></code> and <code class="docutils literal notranslate"><span class="pre">psycopg[binary,pool]</span></code>. Also, while we need to install <code class="docutils literal notranslate"><span class="pre">python-dotenv</span></code>, we import this package as <code class="docutils literal notranslate"><span class="pre">dotenv</span></code>.</p>
<p><strong>Step 2</strong>: Create an “.env” file to store your passwords, API keys, and other sensitive information. Follow the steps to create a .env file discussed in <a class="reference external" href="https://jkropko.github.io/surfing-the-data-pipeline/ch4.html#step-1-creating-a-environmental-variables-file">Chapter 4</a>.</p>
<p><strong>Step 3</strong>: Open the <code class="docutils literal notranslate"><span class="pre">.env</span></code> file. Inside the .env file, paste the following</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">POSTGRES_PASSWORD</span><span class="o">=</span><span class="n">password1</span>
<span class="n">MONGO_INITDB_ROOT_PASSWORD</span><span class="o">=</span><span class="n">password2</span>
<span class="n">MYSQL_ROOT_PASSWORD</span><span class="o">=</span><span class="n">password3</span>
<span class="n">mongo_init_db</span><span class="o">=</span><span class="n">mongodb</span>
<span class="n">MYSQL_DATABASE</span><span class="o">=</span><span class="n">db</span>
<span class="n">MONGO_INITDB_ROOT_USERNAME</span><span class="o">=</span><span class="n">mongo</span>
</pre></div>
</div>
<p>On the first three lines, change <code class="docutils literal notranslate"><span class="pre">password1</span></code>, <code class="docutils literal notranslate"><span class="pre">password2</span></code>, and <code class="docutils literal notranslate"><span class="pre">password3</span></code> to anything you like (but please do not use the &#64; symbol as that causes problems for some packages). Leave the 4th, 5th, and 6th lines alone. Then SAVE the .env file.</p>
<p><strong>Step 4</strong>: If you have not yet done so, download and install the <a class="reference external" href="https://www.docker.com/products/docker-desktop/">Docker desktop client</a> for your operating system. Once the Docker desktop is installed, open it on your local computer.</p>
<p><strong>Step 5</strong>: Open a new text file and save it as “compose.yaml”. Then paste the following code into it and save the file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">services</span><span class="p">:</span>

  <span class="n">mysql</span><span class="p">:</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">mysql</span><span class="p">:</span><span class="n">latest</span>
    <span class="n">env_file</span><span class="p">:</span>
      <span class="o">-</span> <span class="o">.</span><span class="n">env</span>
    <span class="n">ports</span><span class="p">:</span>
      <span class="o">-</span> <span class="s2">&quot;3306:3306&quot;</span>
    <span class="n">volumes</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">mysqldata</span><span class="p">:</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">mysql</span>

  <span class="n">postgres</span><span class="p">:</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">postgres</span><span class="p">:</span><span class="n">latest</span>
    <span class="n">env_file</span><span class="p">:</span> 
      <span class="o">-</span> <span class="o">.</span><span class="n">env</span>
    <span class="n">ports</span><span class="p">:</span> 
      <span class="o">-</span> <span class="s2">&quot;5432:5432&quot;</span>
    <span class="n">volumes</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">postgresdata</span><span class="p">:</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">postgresql</span><span class="o">/</span><span class="n">data</span>
  
  
  <span class="n">mongo</span><span class="p">:</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">mongo</span><span class="p">:</span><span class="n">latest</span>
    <span class="n">env_file</span><span class="p">:</span>
      <span class="o">-</span> <span class="o">.</span><span class="n">env</span>
    <span class="n">ports</span><span class="p">:</span>
      <span class="o">-</span> <span class="s2">&quot;27017:27017&quot;</span>
    <span class="n">volumes</span><span class="p">:</span> 
      <span class="o">-</span> <span class="n">mongodata</span><span class="p">:</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">db</span>

<span class="n">volumes</span><span class="p">:</span>
  <span class="n">mysqldata</span><span class="p">:</span>
  <span class="n">postgresdata</span><span class="p">:</span>
  <span class="n">mongodata</span><span class="p">:</span>
</pre></div>
</div>
<p><strong>Step 6</strong>: In the terminal, use <code class="docutils literal notranslate"><span class="pre">cd</span></code> to navigate to the folder where you saved the compose.yaml file, and type</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">compose</span> <span class="n">up</span>
</pre></div>
</div>
<p>If successful, you will see a large amount of output from JupyterLab, MySQL, PostgreSQL, and Mongo. If you see a “docker daemon” error, then double-check that the Docker desktop client is running.</p>
<p><strong>Step 7</strong>: To test whether MySQL is running properly, run the following code inside your Python script or notebook. If this code runs without error, you are set up to start working with MySQL via Python:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mysql.connector</span>
<span class="kn">import</span> <span class="nn">dotenv</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">dotenv</span><span class="o">.</span><span class="n">load_dotenv</span><span class="p">()</span>
<span class="n">MYSQL_ROOT_PASSWORD</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;MYSQL_ROOT_PASSWORD&#39;</span><span class="p">)</span>
<span class="n">dbserver</span> <span class="o">=</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
    <span class="n">user</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">,</span> 
    <span class="n">password</span><span class="o">=</span><span class="n">MYSQL_ROOT_PASSWORD</span><span class="p">,</span> 
    <span class="n">host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span>
    <span class="n">port</span><span class="o">=</span><span class="s1">&#39;3306&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">MySQLInterfaceError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="nn">File ~/.pyenv/versions/3.12.5/lib/python3.12/site-packages/mysql/connector/connection_cext.py:334,</span> in <span class="ni">CMySQLConnection._open_connection</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">333</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">334</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_cmysql</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="o">**</span><span class="n">cnx_kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">335</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_cmysql</span><span class="o">.</span><span class="n">converter_str_fallback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_converter_str_fallback</span>

<span class="ne">MySQLInterfaceError</span>: Can&#39;t connect to MySQL server on &#39;localhost:3306&#39; (61)

<span class="n">The</span> <span class="n">above</span> <span class="n">exception</span> <span class="n">was</span> <span class="n">the</span> <span class="n">direct</span> <span class="n">cause</span> <span class="n">of</span> <span class="n">the</span> <span class="n">following</span> <span class="n">exception</span><span class="p">:</span>

<span class="ne">DatabaseError</span><span class="g g-Whitespace">                             </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line</span> <span class="mi">6</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">dotenv</span><span class="o">.</span><span class="n">load_dotenv</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">MYSQL_ROOT_PASSWORD</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;MYSQL_ROOT_PASSWORD&#39;</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">6</span> <span class="n">dbserver</span> <span class="o">=</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span>     <span class="n">user</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">,</span> 
<span class="g g-Whitespace">      </span><span class="mi">8</span>     <span class="n">password</span><span class="o">=</span><span class="n">MYSQL_ROOT_PASSWORD</span><span class="p">,</span> 
<span class="g g-Whitespace">      </span><span class="mi">9</span>     <span class="n">host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span>     <span class="n">port</span><span class="o">=</span><span class="s1">&#39;3306&#39;</span><span class="p">)</span>

<span class="nn">File ~/.pyenv/versions/3.12.5/lib/python3.12/site-packages/mysql/connector/pooling.py:322,</span> in <span class="ni">connect</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">319</span>         <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="n">ERROR_NO_CEXT</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">321</span> <span class="k">if</span> <span class="n">CMySQLConnection</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">use_pure</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">322</span>     <span class="k">return</span> <span class="n">CMySQLConnection</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">323</span> <span class="k">return</span> <span class="n">MySQLConnection</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File ~/.pyenv/versions/3.12.5/lib/python3.12/site-packages/mysql/connector/connection_cext.py:151,</span> in <span class="ni">CMySQLConnection.__init__</span><span class="nt">(self, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">149</span> <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">150</span>     <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">151</span>         <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">152</span>     <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">153</span>         <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="nn">File ~/.pyenv/versions/3.12.5/lib/python3.12/site-packages/mysql/connector/abstracts.py:1399,</span> in <span class="ni">MySQLConnectionAbstract.connect</span><span class="nt">(self, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1396</span>     <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1398</span> <span class="bp">self</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
<span class="ne">-&gt; </span><span class="mi">1399</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_connection</span><span class="p">()</span>
<span class="g g-Whitespace">   </span><span class="mi">1401</span> <span class="n">charset</span><span class="p">,</span> <span class="n">collation</span> <span class="o">=</span> <span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1402</span>     <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;charset&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1403</span>     <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;collation&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1404</span> <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1405</span> <span class="k">if</span> <span class="n">charset</span> <span class="ow">or</span> <span class="n">collation</span><span class="p">:</span>

<span class="nn">File ~/.pyenv/versions/3.12.5/lib/python3.12/site-packages/mysql/connector/connection_cext.py:339,</span> in <span class="ni">CMySQLConnection._open_connection</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">337</span>         <span class="bp">self</span><span class="o">.</span><span class="n">converter</span><span class="o">.</span><span class="n">str_fallback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_converter_str_fallback</span>
<span class="g g-Whitespace">    </span><span class="mi">338</span> <span class="k">except</span> <span class="n">MySQLInterfaceError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">339</span>     <span class="k">raise</span> <span class="n">get_mysql_exception</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">340</span>         <span class="n">msg</span><span class="o">=</span><span class="n">err</span><span class="o">.</span><span class="n">msg</span><span class="p">,</span> <span class="n">errno</span><span class="o">=</span><span class="n">err</span><span class="o">.</span><span class="n">errno</span><span class="p">,</span> <span class="n">sqlstate</span><span class="o">=</span><span class="n">err</span><span class="o">.</span><span class="n">sqlstate</span>
<span class="g g-Whitespace">    </span><span class="mi">341</span>     <span class="p">)</span> <span class="kn">from</span> <span class="nn">err</span>
<span class="g g-Whitespace">    </span><span class="mi">343</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_handshake</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">345</span> <span class="k">if</span> <span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">346</span>     <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ssl_disabled</span>
<span class="g g-Whitespace">    </span><span class="mi">347</span>     <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cmysql</span><span class="p">,</span> <span class="s2">&quot;get_ssl_cipher&quot;</span><span class="p">)</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">352</span> 
<span class="g g-Whitespace">    </span><span class="mi">353</span>     <span class="c1"># `get_ssl_cipher()` returns the name of the cipher being used.</span>

<span class="ne">DatabaseError</span>: 2003 (HY000): Can&#39;t connect to MySQL server on &#39;localhost:3306&#39; (61)
</pre></div>
</div>
</div>
</div>
<p>To test whether PostgreSQL is running properly, run the following code inside your Python script or notebook. If this code runs without error, you are set up to start working with PostgreSQL via Python:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">psycopg</span>
<span class="kn">import</span> <span class="nn">dotenv</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">dotenv</span><span class="o">.</span><span class="n">load_dotenv</span><span class="p">()</span>
<span class="n">POSTGRES_PASSWORD</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;POSTGRES_PASSWORD&#39;</span><span class="p">)</span>
<span class="n">dbserver</span> <span class="o">=</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
    <span class="n">user</span><span class="o">=</span><span class="s1">&#39;postgres&#39;</span><span class="p">,</span> 
    <span class="n">password</span><span class="o">=</span><span class="n">POSTGRES_PASSWORD</span><span class="p">,</span> 
    <span class="n">host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span>
    <span class="n">port</span> <span class="o">=</span> <span class="s1">&#39;5432&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>To test whether MongoDB is running properly, run the following code inside your Python script or notebook. If this code runs without error, you are set up to start working with MongoDB via Python:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pymongo</span>
<span class="kn">import</span> <span class="nn">dotenv</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">dotenv</span><span class="o">.</span><span class="n">load_dotenv</span><span class="p">()</span>
<span class="n">MONGO_INITDB_ROOT_USERNAME</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;MONGO_INITDB_ROOT_USERNAME&#39;</span><span class="p">)</span>
<span class="n">MONGO_INITDB_ROOT_PASSWORD</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;MONGO_INITDB_ROOT_PASSWORD&#39;</span><span class="p">)</span>
<span class="n">myclient</span> <span class="o">=</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">MongoClient</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;mongodb://</span><span class="si">{</span><span class="n">MONGO_INITDB_ROOT_USERNAME</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">MONGO_INITDB_ROOT_PASSWORD</span><span class="si">}</span><span class="s2">@localhost:27017/&quot;</span><span class="p">)</span>
<span class="n">myclient</span><span class="o">.</span><span class="n">list_databases</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pymongo.command_cursor.CommandCursor at 0x1119e8950&gt;
</pre></div>
</div>
</div>
</div>
<p><strong>Step 8</strong>: You are now set up to work in Python in a way that stores data in these databases and issues queries to extract data from the databases.</p>
<p><strong>Step 9</strong>: After you are done working with these databases, return to the terminal where you previously typed <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">compose</span> <span class="pre">up</span></code>. Press CONTROL + C to stop the container. Then type</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">compose</span> <span class="n">down</span>
</pre></div>
</div>
<p>to remove the extra volumes and networks Docker had built and free up that space on your computer.</p>
</section>
<section id="example-wine-reviews">
<h3><a class="toc-backref" href="#id20" role="doc-backlink"><span class="section-number">6.3.2. </span>Example: Wine Reviews</a><a class="headerlink" href="#example-wine-reviews" title="Link to this heading">#</a></h3>
<p>To demonstrate how to work with a database in Python, we will use Kaggle data on over 100,000 <a class="reference external" href="https://www.kaggle.com/zynicide/wine-reviews">wine reviews that appeared in Wine Enthusiast Magazine</a>, which were compiled as a web scraping project by Zack Thoutt:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">total</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://github.com/jkropko/DS-6001/raw/master/localdata/winemag.csv&quot;</span><span class="p">)</span>
<span class="n">total</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>wine_id</th>
      <th>country</th>
      <th>description</th>
      <th>points</th>
      <th>price</th>
      <th>province</th>
      <th>region</th>
      <th>taster_name</th>
      <th>taster_twitter_handle</th>
      <th>title</th>
      <th>variety</th>
      <th>winery</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>Italy</td>
      <td>Aromas include tropical fruit, broom, brimston...</td>
      <td>87</td>
      <td>NaN</td>
      <td>Sicily &amp; Sardinia</td>
      <td>Etna</td>
      <td>Kerin O’Keefe</td>
      <td>@kerinokeefe</td>
      <td>Nicosia 2013 Vulkà Bianco  (Etna)</td>
      <td>White Blend</td>
      <td>Nicosia</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>Portugal</td>
      <td>This is ripe and fruity, a wine that is smooth...</td>
      <td>87</td>
      <td>15.0</td>
      <td>Douro</td>
      <td>NaN</td>
      <td>Roger Voss</td>
      <td>@vossroger</td>
      <td>Quinta dos Avidagos 2011 Avidagos Red (Douro)</td>
      <td>Portuguese Red</td>
      <td>Quinta dos Avidagos</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>US</td>
      <td>Tart and snappy, the flavors of lime flesh and...</td>
      <td>87</td>
      <td>14.0</td>
      <td>Oregon</td>
      <td>Willamette Valley</td>
      <td>Paul Gregutt</td>
      <td>@paulgwine</td>
      <td>Rainstorm 2013 Pinot Gris (Willamette Valley)</td>
      <td>Pinot Gris</td>
      <td>Rainstorm</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>US</td>
      <td>Pineapple rind, lemon pith and orange blossom ...</td>
      <td>87</td>
      <td>13.0</td>
      <td>Michigan</td>
      <td>Lake Michigan Shore</td>
      <td>Alexander Peartree</td>
      <td>NaN</td>
      <td>St. Julian 2013 Reserve Late Harvest Riesling ...</td>
      <td>Riesling</td>
      <td>St. Julian</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>US</td>
      <td>Much like the regular bottling from 2012, this...</td>
      <td>87</td>
      <td>65.0</td>
      <td>Oregon</td>
      <td>Willamette Valley</td>
      <td>Paul Gregutt</td>
      <td>@paulgwine</td>
      <td>Sweet Cheeks 2012 Vintner's Reserve Wild Child...</td>
      <td>Pinot Noir</td>
      <td>Sweet Cheeks</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>103722</th>
      <td>129966</td>
      <td>Germany</td>
      <td>Notes of honeysuckle and cantaloupe sweeten th...</td>
      <td>90</td>
      <td>28.0</td>
      <td>Mosel</td>
      <td>NaN</td>
      <td>Anna Lee C. Iijima</td>
      <td>NaN</td>
      <td>Dr. H. Thanisch (Erben Müller-Burggraef) 2013 ...</td>
      <td>Riesling</td>
      <td>Dr. H. Thanisch (Erben Müller-Burggraef)</td>
    </tr>
    <tr>
      <th>103723</th>
      <td>129967</td>
      <td>US</td>
      <td>Citation is given as much as a decade of bottl...</td>
      <td>90</td>
      <td>75.0</td>
      <td>Oregon</td>
      <td>Oregon</td>
      <td>Paul Gregutt</td>
      <td>@paulgwine</td>
      <td>Citation 2004 Pinot Noir (Oregon)</td>
      <td>Pinot Noir</td>
      <td>Citation</td>
    </tr>
    <tr>
      <th>103724</th>
      <td>129968</td>
      <td>France</td>
      <td>Well-drained gravel soil gives this wine its c...</td>
      <td>90</td>
      <td>30.0</td>
      <td>Alsace</td>
      <td>Alsace</td>
      <td>Roger Voss</td>
      <td>@vossroger</td>
      <td>Domaine Gresser 2013 Kritt Gewurztraminer (Als...</td>
      <td>Gewürztraminer</td>
      <td>Domaine Gresser</td>
    </tr>
    <tr>
      <th>103725</th>
      <td>129969</td>
      <td>France</td>
      <td>A dry style of Pinot Gris, this is crisp with ...</td>
      <td>90</td>
      <td>32.0</td>
      <td>Alsace</td>
      <td>Alsace</td>
      <td>Roger Voss</td>
      <td>@vossroger</td>
      <td>Domaine Marcel Deiss 2012 Pinot Gris (Alsace)</td>
      <td>Pinot Gris</td>
      <td>Domaine Marcel Deiss</td>
    </tr>
    <tr>
      <th>103726</th>
      <td>129970</td>
      <td>France</td>
      <td>Big, rich and off-dry, this is powered by inte...</td>
      <td>90</td>
      <td>21.0</td>
      <td>Alsace</td>
      <td>Alsace</td>
      <td>Roger Voss</td>
      <td>@vossroger</td>
      <td>Domaine Schoffit 2012 Lieu-dit Harth Cuvée Car...</td>
      <td>Gewürztraminer</td>
      <td>Domaine Schoffit</td>
    </tr>
  </tbody>
</table>
<p>103727 rows × 12 columns</p>
</div></div></div>
</div>
<p>The features in this dataframe are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">wine_id</span></code>: a primary key identifying one wine</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">country</span></code>: the country of origin for the wine</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">description</span></code>: the text of the wine review written by the Wine Enthusiast critic</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">points</span></code>: the score given to the wine by the critic on a scale from 0 to 100 (although the lowest rated wine in the data is still rated 80, so even bad wine is pretty good!)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">price</span></code>: the price in U.S. dollars</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">province</span></code>: the province or state within the country in which the wine was produced</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">region</span></code>: the region within the province or state in which the wine was produced (for example, Central Virginia as opposed to NOVA or the Tidewater)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">taster_name</span></code>: the name of the Wine Enthusiast critic</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">taster_twitter_handle</span></code>: the critic’s Twitter handle</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">title</span></code>: the official name and vintage of the wine</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">variety</span></code>: the type of grapes that were used to make the wine</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">winery</span></code>: the name of the winery that produced the wine</p></li>
</ul>
<p>If we want to store these data in a relational database, we need to reorganize the data into separate tables to fit with the rules of database normalization. I create four tables for four separate entities: REVIEWS for the reviews of individual wines, TASTERS for information about the critics, WINERIES for information about the wineries, and LOCATION for the details on where the wine was produced. All relationships are many-to-one: many wines are reviewed by the same critic, many wines are produced by the same winery, and many wines are produced in the same location, but every wine comes from one winery at one location and is reviewed by one critic. The logical entity-relationship diagram for the database is:</p>
<img src="https://github.com/jkropko/DS-6001/raw/master/localimages/wine_er4.png" width="400">
<p>I did the work to generate these tables using <code class="docutils literal notranslate"><span class="pre">pandas</span></code>, and I saved each entity as a separate CSV file:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reviews</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://github.com/jkropko/DS-6001/raw/master/localdata/wines_reviews.csv&quot;</span><span class="p">)</span>
<span class="n">tasters</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://github.com/jkropko/DS-6001/raw/master/localdata/wines_tasters.csv&quot;</span><span class="p">)</span>
<span class="n">wineries</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://github.com/jkropko/DS-6001/raw/master/localdata/wines_wineries.csv&quot;</span><span class="p">)</span>
<span class="n">locations</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://github.com/jkropko/DS-6001/raw/master/localdata/wines_locations.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Once you create a database with a particular DBMS, the easiest workflow is to continue to use that DBMS as implemented in Python, and not to switch DBMSs. SQLite, MySQL, and PostgreSQL all have specific strengths for working with relational databases and MongoDB is a popular choice for document stores, but there are always other DBMS options. Use the DBMS that you like best, or the DBMS that matches the preferences of other people in your organization.</p>
</section>
<section id="using-sqlite">
<h3><a class="toc-backref" href="#id21" role="doc-backlink"><span class="section-number">6.3.3. </span>Using SQLite</a><a class="headerlink" href="#using-sqlite" title="Link to this heading">#</a></h3>
<p>SQLite differs from MySQL, PostgreSQL, and Mongo in that it stores an entire database in a single file saved onto a computer’s hard storage. The <code class="docutils literal notranslate"><span class="pre">sqlite3</span></code> package for Python combines the local installation of SQLite with the Python functionality for working with SQLite. Unlike other DBMSs, there is no need to separately install and run SQLite via Docker or any other method. We can just use <code class="docutils literal notranslate"><span class="pre">sqlite3</span></code>, which should be pre-installed on your version of Python:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlite3</span>
</pre></div>
</div>
</div>
</div>
<p>As SQLite works with files, it is important to first check that your code is set to the proper default directory for saving and loading files. You can do that with <code class="docutils literal notranslate"><span class="pre">os.getcwd()</span></code>. If this is not the folder you want to use to save your database file, you can change this directory by typing <code class="docutils literal notranslate"><span class="pre">os.chdir(</span></code><em>path to folder</em><code class="docutils literal notranslate"><span class="pre">)</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">.connect()</span></code> method in the <code class="docutils literal notranslate"><span class="pre">sqlite3</span></code> package takes a filename as its argument, and creates this file as a new (empty) database if it doesn’t exist. If the file exists, it creates a connection to that database so that we can submit SQL code to query that database. Database files usually have the extension “.db”.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wine_db</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;winereviews.db&quot;</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</div>
<p>The database now exists as “winereviews.db” in your local storage and as <code class="docutils literal notranslate"><span class="pre">wine_db</span></code> in the Python environment. But the database is currently empty. To add data frames to serve as entities in the database, use the <code class="docutils literal notranslate"><span class="pre">.to_sql()</span></code> method, which operates on the four <code class="docutils literal notranslate"><span class="pre">pandas</span></code> data frames we created above:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reviews</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s1">&#39;reviews&#39;</span><span class="p">,</span> <span class="n">wine_db</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s1">&#39;replace&#39;</span><span class="p">)</span>
<span class="n">tasters</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s1">&#39;tasters&#39;</span><span class="p">,</span> <span class="n">wine_db</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s1">&#39;replace&#39;</span><span class="p">)</span>
<span class="n">wineries</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s1">&#39;wineries&#39;</span><span class="p">,</span> <span class="n">wine_db</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s1">&#39;replace&#39;</span><span class="p">)</span>
<span class="n">locations</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s1">&#39;locations&#39;</span><span class="p">,</span> <span class="n">wine_db</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s1">&#39;replace&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1488
</pre></div>
</div>
</div>
</div>
<p>The first argument of <code class="docutils literal notranslate"><span class="pre">.to_sql()</span></code> names the entity, the second argument specifies the database in which these entities should be placed, the third argument switches off the default behavior of uploading the dataframe’s row indices to the database as an additional column in each table, <code class="docutils literal notranslate"><span class="pre">chunksize</span></code> breaks the data transfer into smaller parts to avoid overwhelming the database server (that’s more of a problem for MySQL and PostgreSQL), and the last argument tells the method to overwrite each entity if a table with the given name already exists in the database. If instead you would like to add additional data to existing tables in the database, you can write <code class="docutils literal notranslate"><span class="pre">if_exists='append'</span></code> here. The <code class="docutils literal notranslate"><span class="pre">wine_db</span></code> database now contains four entities, named <code class="docutils literal notranslate"><span class="pre">reviews</span></code>, <code class="docutils literal notranslate"><span class="pre">tasters</span></code>, <code class="docutils literal notranslate"><span class="pre">wineries</span></code>, and <code class="docutils literal notranslate"><span class="pre">locations</span></code>.</p>
<p>Now that the database exists and is populated with the data, we can begin to issue queries. Queries employ SQL code, which we will discuss in detail in <a class="reference external" href="https://jkropko.github.io/surfing-the-data-pipeline/ch7.html">chapter 7</a>. To issue queries, use the <code class="docutils literal notranslate"><span class="pre">pd.read_sql_query()</span></code> method: all you need to do is pass the SQL query as a string as the first argument and the name of the database as the second argument, and the function returns the data frame we want. Although any string will work for the SQL code, I like using the triple quote syntax to allow for a multiline string. For example, to extract the entire “reviews” table, we can type:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">myquery</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">SELECT *</span>
<span class="s1">FROM reviews</span>
<span class="s1">&#39;&#39;&#39;</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">myquery</span><span class="p">,</span> <span class="n">wine_db</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>wine_id</th>
      <th>title</th>
      <th>variety</th>
      <th>description</th>
      <th>points</th>
      <th>price</th>
      <th>taster_id</th>
      <th>winery_id</th>
      <th>location_id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>Nicosia 2013 Vulkà Bianco  (Etna)</td>
      <td>White Blend</td>
      <td>Aromas include tropical fruit, broom, brimston...</td>
      <td>87</td>
      <td>NaN</td>
      <td>1</td>
      <td>10256</td>
      <td>842</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>Quinta dos Avidagos 2011 Avidagos Red (Douro)</td>
      <td>Portuguese Red</td>
      <td>This is ripe and fruity, a wine that is smooth...</td>
      <td>87</td>
      <td>15.0</td>
      <td>2</td>
      <td>11412</td>
      <td>1050</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>Rainstorm 2013 Pinot Gris (Willamette Valley)</td>
      <td>Pinot Gris</td>
      <td>Tart and snappy, the flavors of lime flesh and...</td>
      <td>87</td>
      <td>14.0</td>
      <td>3</td>
      <td>11469</td>
      <td>1456</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>St. Julian 2013 Reserve Late Harvest Riesling ...</td>
      <td>Riesling</td>
      <td>Pineapple rind, lemon pith and orange blossom ...</td>
      <td>87</td>
      <td>13.0</td>
      <td>4</td>
      <td>12612</td>
      <td>1416</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>Sweet Cheeks 2012 Vintner's Reserve Wild Child...</td>
      <td>Pinot Noir</td>
      <td>Much like the regular bottling from 2012, this...</td>
      <td>87</td>
      <td>65.0</td>
      <td>3</td>
      <td>12790</td>
      <td>1456</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>103722</th>
      <td>129966</td>
      <td>Dr. H. Thanisch (Erben Müller-Burggraef) 2013 ...</td>
      <td>Riesling</td>
      <td>Notes of honeysuckle and cantaloupe sweeten th...</td>
      <td>90</td>
      <td>28.0</td>
      <td>6</td>
      <td>6025</td>
      <td>621</td>
    </tr>
    <tr>
      <th>103723</th>
      <td>129967</td>
      <td>Citation 2004 Pinot Noir (Oregon)</td>
      <td>Pinot Noir</td>
      <td>Citation is given as much as a decade of bottl...</td>
      <td>90</td>
      <td>75.0</td>
      <td>3</td>
      <td>4342</td>
      <td>1449</td>
    </tr>
    <tr>
      <th>103724</th>
      <td>129968</td>
      <td>Domaine Gresser 2013 Kritt Gewurztraminer (Als...</td>
      <td>Gewürztraminer</td>
      <td>Well-drained gravel soil gives this wine its c...</td>
      <td>90</td>
      <td>30.0</td>
      <td>2</td>
      <td>5622</td>
      <td>221</td>
    </tr>
    <tr>
      <th>103725</th>
      <td>129969</td>
      <td>Domaine Marcel Deiss 2012 Pinot Gris (Alsace)</td>
      <td>Pinot Gris</td>
      <td>A dry style of Pinot Gris, this is crisp with ...</td>
      <td>90</td>
      <td>32.0</td>
      <td>2</td>
      <td>5745</td>
      <td>221</td>
    </tr>
    <tr>
      <th>103726</th>
      <td>129970</td>
      <td>Domaine Schoffit 2012 Lieu-dit Harth Cuvée Car...</td>
      <td>Gewürztraminer</td>
      <td>Big, rich and off-dry, this is powered by inte...</td>
      <td>90</td>
      <td>21.0</td>
      <td>2</td>
      <td>5862</td>
      <td>221</td>
    </tr>
  </tbody>
</table>
<p>103727 rows × 9 columns</p>
</div></div></div>
</div>
<p>One useful feature of SQlite is that it automatically generates an entity named <code class="docutils literal notranslate"><span class="pre">sqlite_master</span></code> that contains metadata about the other tables in the database. For example, to see a list of all of the entity names in the database, we run the following query:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">myquery</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">SELECT name </span>
<span class="s1">FROM sqlite_master </span>
<span class="s1">WHERE type=&#39;table&#39; </span>
<span class="s1">ORDER BY name</span>
<span class="s1">&#39;&#39;&#39;</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">myquery</span><span class="p">,</span> <span class="n">wine_db</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>locations</td>
    </tr>
    <tr>
      <th>1</th>
      <td>reviews</td>
    </tr>
    <tr>
      <th>2</th>
      <td>tasters</td>
    </tr>
    <tr>
      <th>3</th>
      <td>wineries</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>As we work with the database, the <code class="docutils literal notranslate"><span class="pre">.commit()</span></code> method makes any changes we’ve made to the database viewable by any other users of the database, and the <code class="docutils literal notranslate"><span class="pre">.close()</span></code> method prevents any additional changes without first issuing a call to <code class="docutils literal notranslate"><span class="pre">.connect()</span></code> again:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wine_db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="n">wine_db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>These two methods are mostly important for people who are adding, updating, or deleting data from the database and those who work with collaborators.</p>
</section>
<section id="using-mysql">
<h3><a class="toc-backref" href="#id22" role="doc-backlink"><span class="section-number">6.3.4. </span>Using MySQL</a><a class="headerlink" href="#using-mysql" title="Link to this heading">#</a></h3>
<p>First, follow the instructions in <a class="reference external" href="https://jkropko.github.io/surfing-the-data-pipeline/ch6.html#installing-database-systems-using-docker">Installing Database Systems Using Docker</a> to ensure that MySQL is running via a container on your system. Then in your script or notebook, import this module:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mysql.connector</span>
</pre></div>
</div>
</div>
</div>
<p>One important difference between SQLite and MySQL is that MySQL always requires a password to access a database, and SQLite does not. Because SQLite is designed to work only on local storage, the idea of a password is considered redundant because a user would have already entered a password to access their personal operating system. The following examples require a password - but because I do not want to display my password in this notebook, I will use the same method we used in <a class="reference external" href="https://jkropko.github.io/surfing-the-data-pipeline/ch4.html#step-1-creating-a-environmental-variables-file">Chapter 4</a> to load the password chosen in Step 3 in the <a class="reference external" href="https://jkropko.github.io/surfing-the-data-pipeline/ch6.html#installing-database-systems-using-docker">Installing Database Systems Using Docker</a> section of this chapter:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dotenv</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="n">dotenv</span><span class="o">.</span><span class="n">load_dotenv</span><span class="p">()</span>
<span class="n">mysqlpassword</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;MYSQL_ROOT_PASSWORD&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>There are two ways to connect to MySQL via Python, and both are needed:</p>
<ul class="simple">
<li><p>We can connect to the <strong>MySQL server</strong>: the instance of MySQL running on the computer (via a Docker container). Connecting to the server is important for things like creating new databases on this server, adding or removing users who can access these databases, and viewing metadata about these databases.</p></li>
<li><p>Or we can connect to one of the <strong>databases</strong> that currently exists on the MySQL server. Connecting to a database is the proper way of using SQL to pull data from a database.</p></li>
</ul>
<p>When we first create a database, we should do so using a connection to the server. But after creating the database, most of the work we do in Python involving that database will be done by connecting directly to the database.</p>
<section id="connecting-to-the-mysql-server-and-creating-a-new-database">
<h4><a class="toc-backref" href="#id23" role="doc-backlink"><span class="section-number">6.3.4.1. </span>Connecting to the MySQL Server and Creating a New Database</a><a class="headerlink" href="#connecting-to-the-mysql-server-and-creating-a-new-database" title="Link to this heading">#</a></h4>
<p>We can connect to the local MySQL server by typing</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dbserver</span> <span class="o">=</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
    <span class="n">user</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">,</span> 
    <span class="n">password</span><span class="o">=</span><span class="n">MYSQL_ROOT_PASSWORD</span><span class="p">,</span> 
    <span class="n">host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span>
    <span class="n">port</span><span class="o">=</span><span class="s1">&#39;3306&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Here we specify “root” as the username because we are acting as the <a class="reference external" href="https://en.wikipedia.org/wiki/Superuser">root user</a>, or administrator, of the database server. In other circumstances, if you are not the administrator, you will be assigned a different user name that can be specified under <code class="docutils literal notranslate"><span class="pre">user</span></code>. Because we are running the DBMS ourselves <code class="docutils literal notranslate"><span class="pre">password</span></code> is the <code class="docutils literal notranslate"><span class="pre">MYSQL_ROOT_PASSWORD</span></code> we chose in the .env file when we lauched MySQL via Docker. <code class="docutils literal notranslate"><span class="pre">host='localhost'</span></code> refers to the fact that MySQL is running on our local computer, and not on a remote or cloud system. If the database were running instead on a remote system, we would place that computer’s IP address here. <code class="docutils literal notranslate"><span class="pre">port</span></code> is the local port on this computer that we specified in the <code class="docutils literal notranslate"><span class="pre">compose.yaml</span></code> file.</p>
<p>To work with this server we create a cursor which uses the <code class="docutils literal notranslate"><span class="pre">.execute()</span></code> method to understand SQL code:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cursor</span> <span class="o">=</span> <span class="n">dbserver</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Note: do not run the following code to access an existing database. This is for creating a new database from scratch, or for deleting an existing database and starting one from scratch to replace it.</strong> To create a new database within your MySQL server, type</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;CREATE DATABASE winedb&quot;</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;DROP DATABASE winedb&quot;</span><span class="p">)</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;CREATE DATABASE winedb&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">winedb</span></code> is the name of the new (empty) database on your server. If there is already a database named <code class="docutils literal notranslate"><span class="pre">winedb</span></code> on this server, <code class="docutils literal notranslate"><span class="pre">cursor.execute(&quot;CREATE</span> <span class="pre">DATABASE</span> <span class="pre">winedb&quot;)</span></code> will yield an error. The <code class="docutils literal notranslate"><span class="pre">try:</span></code> and <code class="docutils literal notranslate"><span class="pre">except:</span></code> syntax is called a <strong>try-catch block</strong>: it executes the code under <code class="docutils literal notranslate"><span class="pre">try:</span></code>, and if there is an error, executes the code under <code class="docutils literal notranslate"><span class="pre">except:</span></code> instead. In this case, if the database already exists, the <code class="docutils literal notranslate"><span class="pre">except</span></code> block drops the database then creates a new (empty) version of that database.</p>
<p>To see all of the databases that currently exist on the server, type</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SHOW DATABASES&quot;</span><span class="p">)</span>
<span class="n">databases</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<span class="n">databases</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;information_schema&#39;,),
 (&#39;mysql&#39;,),
 (&#39;performance_schema&#39;,),
 (&#39;sys&#39;,),
 (&#39;winedb&#39;,)]
</pre></div>
</div>
</div>
</div>
</section>
<section id="connecting-to-an-existing-database-on-mysql">
<h4><a class="toc-backref" href="#id24" role="doc-backlink"><span class="section-number">6.3.4.2. </span>Connecting to an Existing Database on MySQL</a><a class="headerlink" href="#connecting-to-an-existing-database-on-mysql" title="Link to this heading">#</a></h4>
<p>Before we can place data into the empty wine database, we have to connect to this database. For that we can use the same syntax that we used to connect to the MySQL server, but a simpler approach is to use the <code class="docutils literal notranslate"><span class="pre">sqlalchemy</span></code> package to simplify the process for storing data in and extracting data from a database.</p>
<p><code class="docutils literal notranslate"><span class="pre">sqlalchemy</span></code> is widely used, and works with many different DBMSs in Python. To see a full list, see <a class="reference external" href="https://docs.sqlalchemy.org/en/21/dialects/index.html">this discussion</a> in the sqlalchemy documentation.</p>
<p>The idea is that we can combine all of the information for accessing the database including usernames, passwords, hosts, ports, and database names into a single string called an <strong>engine</strong>. We can then pass this engine to various methods, including many <code class="docutils literal notranslate"><span class="pre">pandas</span></code> methods, to work with exactly the right database. First we import the <code class="docutils literal notranslate"><span class="pre">create_engine()</span></code> method from <code class="docutils literal notranslate"><span class="pre">sqlalchemy</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
</pre></div>
</div>
</div>
</div>
<p>Engines are easier to understand if we use a formatted string, like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dbms</span> <span class="o">=</span> <span class="s1">&#39;mysql&#39;</span>
<span class="n">package</span> <span class="o">=</span> <span class="s1">&#39;mysqlconnector&#39;</span>
<span class="n">user</span> <span class="o">=</span> <span class="s1">&#39;root&#39;</span>
<span class="n">password</span> <span class="o">=</span> <span class="n">MYSQL_ROOT_PASSWORD</span>
<span class="n">host</span> <span class="o">=</span> <span class="s1">&#39;localhost&#39;</span>
<span class="n">port</span> <span class="o">=</span> <span class="s1">&#39;3306&#39;</span>
<span class="n">db</span> <span class="o">=</span> <span class="s1">&#39;winedb&#39;</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dbms</span><span class="si">}</span><span class="s2">+</span><span class="si">{</span><span class="n">package</span><span class="si">}</span><span class="s2">://</span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">password</span><span class="si">}</span><span class="s2">@</span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">db</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">engine</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Engine(mysql+mysqlconnector://root:***@localhost:3306/winedb)
</pre></div>
</div>
</div>
</div>
<p>This engine allows us to use the <code class="docutils literal notranslate"><span class="pre">.to_sql()</span></code> method from <code class="docutils literal notranslate"><span class="pre">pandas</span></code> to place the four data frames into the wine database. First we set a name for each entity, then we pass the <code class="docutils literal notranslate"><span class="pre">sqlalchemy</span></code> engine, then we specify that the entity should be overwritten with new data if it already exists (we could also specify that the data is appended to the old, or that the operation provides an error if the entity already exists):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reviews</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s1">&#39;reviews&#39;</span><span class="p">,</span> <span class="n">con</span> <span class="o">=</span> <span class="n">engine</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">if_exists</span> <span class="o">=</span> <span class="s1">&#39;replace&#39;</span><span class="p">)</span>
<span class="n">tasters</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s1">&#39;tasters&#39;</span><span class="p">,</span> <span class="n">con</span> <span class="o">=</span> <span class="n">engine</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">if_exists</span> <span class="o">=</span> <span class="s1">&#39;replace&#39;</span><span class="p">)</span>
<span class="n">wineries</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s1">&#39;wineries&#39;</span><span class="p">,</span> <span class="n">con</span> <span class="o">=</span> <span class="n">engine</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">if_exists</span> <span class="o">=</span> <span class="s1">&#39;replace&#39;</span><span class="p">)</span>
<span class="n">locations</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s1">&#39;locations&#39;</span><span class="p">,</span> <span class="n">con</span> <span class="o">=</span> <span class="n">engine</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">if_exists</span> <span class="o">=</span> <span class="s1">&#39;replace&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1488
</pre></div>
</div>
</div>
</div>
<p>Now all four tables are entities within the <code class="docutils literal notranslate"><span class="pre">winedb</span></code> database.</p>
<p>To query the database, we can use the <code class="docutils literal notranslate"><span class="pre">pd.read_sql_query()</span></code> function by passing the <code class="docutils literal notranslate"><span class="pre">sqlalchemy</span></code> engine to this function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">myquery</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">SELECT *</span>
<span class="s1">FROM reviews</span>
<span class="s1">&#39;&#39;&#39;</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">myquery</span><span class="p">,</span> <span class="n">con</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>wine_id</th>
      <th>title</th>
      <th>variety</th>
      <th>description</th>
      <th>points</th>
      <th>price</th>
      <th>taster_id</th>
      <th>winery_id</th>
      <th>location_id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>Nicosia 2013 Vulkà Bianco  (Etna)</td>
      <td>White Blend</td>
      <td>Aromas include tropical fruit, broom, brimston...</td>
      <td>87</td>
      <td>NaN</td>
      <td>1</td>
      <td>10256</td>
      <td>842</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>Quinta dos Avidagos 2011 Avidagos Red (Douro)</td>
      <td>Portuguese Red</td>
      <td>This is ripe and fruity, a wine that is smooth...</td>
      <td>87</td>
      <td>15.0</td>
      <td>2</td>
      <td>11412</td>
      <td>1050</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>Rainstorm 2013 Pinot Gris (Willamette Valley)</td>
      <td>Pinot Gris</td>
      <td>Tart and snappy, the flavors of lime flesh and...</td>
      <td>87</td>
      <td>14.0</td>
      <td>3</td>
      <td>11469</td>
      <td>1456</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>St. Julian 2013 Reserve Late Harvest Riesling ...</td>
      <td>Riesling</td>
      <td>Pineapple rind, lemon pith and orange blossom ...</td>
      <td>87</td>
      <td>13.0</td>
      <td>4</td>
      <td>12612</td>
      <td>1416</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>Sweet Cheeks 2012 Vintner's Reserve Wild Child...</td>
      <td>Pinot Noir</td>
      <td>Much like the regular bottling from 2012, this...</td>
      <td>87</td>
      <td>65.0</td>
      <td>3</td>
      <td>12790</td>
      <td>1456</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>103722</th>
      <td>129966</td>
      <td>Dr. H. Thanisch (Erben Müller-Burggraef) 2013 ...</td>
      <td>Riesling</td>
      <td>Notes of honeysuckle and cantaloupe sweeten th...</td>
      <td>90</td>
      <td>28.0</td>
      <td>6</td>
      <td>6025</td>
      <td>621</td>
    </tr>
    <tr>
      <th>103723</th>
      <td>129967</td>
      <td>Citation 2004 Pinot Noir (Oregon)</td>
      <td>Pinot Noir</td>
      <td>Citation is given as much as a decade of bottl...</td>
      <td>90</td>
      <td>75.0</td>
      <td>3</td>
      <td>4342</td>
      <td>1449</td>
    </tr>
    <tr>
      <th>103724</th>
      <td>129968</td>
      <td>Domaine Gresser 2013 Kritt Gewurztraminer (Als...</td>
      <td>Gewürztraminer</td>
      <td>Well-drained gravel soil gives this wine its c...</td>
      <td>90</td>
      <td>30.0</td>
      <td>2</td>
      <td>5622</td>
      <td>221</td>
    </tr>
    <tr>
      <th>103725</th>
      <td>129969</td>
      <td>Domaine Marcel Deiss 2012 Pinot Gris (Alsace)</td>
      <td>Pinot Gris</td>
      <td>A dry style of Pinot Gris, this is crisp with ...</td>
      <td>90</td>
      <td>32.0</td>
      <td>2</td>
      <td>5745</td>
      <td>221</td>
    </tr>
    <tr>
      <th>103726</th>
      <td>129970</td>
      <td>Domaine Schoffit 2012 Lieu-dit Harth Cuvée Car...</td>
      <td>Gewürztraminer</td>
      <td>Big, rich and off-dry, this is powered by inte...</td>
      <td>90</td>
      <td>21.0</td>
      <td>2</td>
      <td>5862</td>
      <td>221</td>
    </tr>
  </tbody>
</table>
<p>103727 rows × 9 columns</p>
</div></div></div>
</div>
<p>Before ending our work with this MySQL database, we use the <code class="docutils literal notranslate"><span class="pre">.commit()</span></code> method to save and make any changes we made in the MySQL server accessible to other users:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dbserver</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>And we close the connection to the server to prevent any other applications from interfacing with this server:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dbserver</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="using-postgresql">
<h3><a class="toc-backref" href="#id25" role="doc-backlink"><span class="section-number">6.3.5. </span>Using PostgreSQL</a><a class="headerlink" href="#using-postgresql" title="Link to this heading">#</a></h3>
<p>PostgreSQL and MySQL are accessed in Python in very similar ways. The following discussion mirrors the discussion for MySQL above, with only a few small changes as needed.</p>
<p>First, follow the instructions in <a class="reference external" href="https://jkropko.github.io/surfing-the-data-pipeline/ch6.html#installing-database-systems-using-docker">Installing Database Systems Using Docker</a> to ensure that PostgreSQL is running via a container on your system. Then in your script or notebook, import this module:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">psycopg</span>
</pre></div>
</div>
</div>
</div>
<p>Like MySQL, PostgreSQL always requires a password to access a database, and we specified a password in the .env file in the same directory as the <code class="docutils literal notranslate"><span class="pre">compose.yaml</span></code> file, so that our local installation of the PostgreSQL server via Docker recognizes this password. We first load the password from the .env file:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">postgres_password</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;POSTGRES_PASSWORD&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>As with MySQL, there are two ways to connect to PostgreSQL via Python, and both are needed:</p>
<ul class="simple">
<li><p>We can connect to the <strong>PostgreSQL server</strong>: the instance of PostgreSQL running on the computer (via a Docker container). Connecting to the server is important for things like creating new databases on this server, adding or removing users who can access these databases, and viewing metadata about these databases.</p></li>
<li><p>Or we can connect to one of the <strong>databases</strong> that currently exists on the PostgreSQL server. Connecting to a database is the proper way of using SQL to pull data from a database.</p></li>
</ul>
<p>When we first create a database, we should do so using a connection to the server. But after creating the database, most of the work we do in Python involving that database will be done by connecting directly to the database.</p>
<section id="connecting-to-the-postgresql-server-and-creating-a-new-database">
<h4><a class="toc-backref" href="#id26" role="doc-backlink"><span class="section-number">6.3.5.1. </span>Connecting to the PostgreSQL Server and Creating a New Database</a><a class="headerlink" href="#connecting-to-the-postgresql-server-and-creating-a-new-database" title="Link to this heading">#</a></h4>
<p>We can connect to the local PostgreSQL server by typing</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dbserver</span> <span class="o">=</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
    <span class="n">user</span><span class="o">=</span><span class="s1">&#39;postgres&#39;</span><span class="p">,</span> 
    <span class="n">password</span><span class="o">=</span><span class="n">POSTGRES_PASSWORD</span><span class="p">,</span> 
    <span class="n">host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span>
    <span class="n">port</span> <span class="o">=</span> <span class="s1">&#39;5432&#39;</span>
<span class="p">)</span>
<span class="n">dbserver</span><span class="o">.</span><span class="n">autocommit</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
</div>
<p>Here we specify “postgres” as the username because we are acting as the superuser, or administrator, of the database server and “postgres” is the default name for the PostgreSQL superuser with <code class="docutils literal notranslate"><span class="pre">password</span></code> set to <code class="docutils literal notranslate"><span class="pre">POSTGRES_PASSWORD</span></code>. <code class="docutils literal notranslate"><span class="pre">host='localhost'</span></code> refers to the fact that PostgreSQL is running on our local computer, and not on a remote or cloud system. If the database were running instead on a remote system, we would place that computer’s IP address here. <code class="docutils literal notranslate"><span class="pre">port</span></code> is the local port on this computer that we specified in the <code class="docutils literal notranslate"><span class="pre">compose.yaml</span></code> file (PostgreSQL runs on port 5432 by default). <code class="docutils literal notranslate"><span class="pre">dbserver.autocommit</span> <span class="pre">=</span> <span class="pre">True</span></code> instructs PostgreSQL to run every SQL query individually, rather than abiding by the <a class="reference external" href="https://www.geeksforgeeks.org/enable-autocommit-in-psycopg2-using-python/">default behavior</a> of taking all SQL commands as part of one transaction and running them all together when the user employs the <code class="docutils literal notranslate"><span class="pre">.commit()</span></code> method.</p>
<p>To work with this server we create a cursor which uses the <code class="docutils literal notranslate"><span class="pre">.execute()</span></code> method to understand SQL code:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cursor</span> <span class="o">=</span> <span class="n">dbserver</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Note: do not run the following code to access an existing database. This is for creating a new database from scratch, or for deleting an existing database and starting one from scratch to replace it.</strong> To create a new database within the PostgreSQL server, type</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;CREATE DATABASE winedb&quot;</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;DROP DATABASE winedb&quot;</span><span class="p">)</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;CREATE DATABASE winedb&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">winedb</span></code> is the name of the new (empty) database on your server. If there is already a database named <code class="docutils literal notranslate"><span class="pre">winedb</span></code> on this server, <code class="docutils literal notranslate"><span class="pre">cursor.execute(&quot;CREATE</span> <span class="pre">DATABASE</span> <span class="pre">winedb&quot;)</span></code> will yield an error. The <code class="docutils literal notranslate"><span class="pre">try:</span></code> and <code class="docutils literal notranslate"><span class="pre">except:</span></code> syntax (a try-catch block) executes the code under <code class="docutils literal notranslate"><span class="pre">try:</span></code>, and if there is an error, executes the code under <code class="docutils literal notranslate"><span class="pre">except:</span></code> instead. In this case, if the database already exists, the <code class="docutils literal notranslate"><span class="pre">except</span></code> block drops the database then creates a new (empty) version of that database.</p>
<p>To see all of the databases that currently exist on the server, type</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT datname FROM pg_database&quot;</span><span class="p">)</span>
<span class="n">databases</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<span class="n">databases</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;postgres&#39;,), (&#39;winedb&#39;,), (&#39;template1&#39;,), (&#39;template0&#39;,)]
</pre></div>
</div>
</div>
</div>
</section>
<section id="connecting-to-an-existing-database-on-postgresql">
<h4><a class="toc-backref" href="#id27" role="doc-backlink"><span class="section-number">6.3.5.2. </span>Connecting to an Existing Database on PostgreSQL</a><a class="headerlink" href="#connecting-to-an-existing-database-on-postgresql" title="Link to this heading">#</a></h4>
<p>Before we can place data into the empty wine database, we have to connect to this database. For that, the simplest approach is to use the <code class="docutils literal notranslate"><span class="pre">create_engine()</span></code> method from the <code class="docutils literal notranslate"><span class="pre">sqlalchemy</span></code> package to simplify the process for storing data in and extracting data from a database. We combine all of the information for accessing the database including usernames, passwords, hosts, ports, and database names into a single string called an <strong>engine</strong>. We can then pass this engine to various methods, including many <code class="docutils literal notranslate"><span class="pre">pandas</span></code> methods, to work with exactly the right database.</p>
<p>Engines are easier to understand if we use a formatted string, like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dbms</span> <span class="o">=</span> <span class="s1">&#39;postgresql&#39;</span>
<span class="n">package</span> <span class="o">=</span> <span class="s1">&#39;psycopg&#39;</span>
<span class="n">user</span> <span class="o">=</span> <span class="s1">&#39;postgres&#39;</span>
<span class="n">password</span> <span class="o">=</span> <span class="n">POSTGRES_PASSWORD</span>
<span class="n">host</span> <span class="o">=</span> <span class="s1">&#39;localhost&#39;</span>
<span class="n">port</span> <span class="o">=</span> <span class="s1">&#39;5432&#39;</span>
<span class="n">db</span> <span class="o">=</span> <span class="s1">&#39;winedb&#39;</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dbms</span><span class="si">}</span><span class="s2">+</span><span class="si">{</span><span class="n">package</span><span class="si">}</span><span class="s2">://</span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">password</span><span class="si">}</span><span class="s2">@</span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">db</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">engine</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Engine(postgresql+psycopg://postgres:***@localhost:5432/winedb)
</pre></div>
</div>
</div>
</div>
<p>This engine allows us to use the <code class="docutils literal notranslate"><span class="pre">.to_sql()</span></code> method from <code class="docutils literal notranslate"><span class="pre">pandas</span></code> to place the four data frames into the wine database. First we set a name for each entity, then we pass the <code class="docutils literal notranslate"><span class="pre">sqlalchemy</span></code> engine, then we specify that the entity should be overwritten with new data if it already exists (we could also specify that the data is appended to the old, or that the operation provides an error if the entity already exists):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reviews</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s1">&#39;reviews&#39;</span><span class="p">,</span> <span class="n">con</span> <span class="o">=</span> <span class="n">engine</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">if_exists</span> <span class="o">=</span> <span class="s1">&#39;replace&#39;</span><span class="p">)</span>
<span class="n">tasters</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s1">&#39;tasters&#39;</span><span class="p">,</span> <span class="n">con</span> <span class="o">=</span> <span class="n">engine</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">if_exists</span> <span class="o">=</span> <span class="s1">&#39;replace&#39;</span><span class="p">)</span>
<span class="n">wineries</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s1">&#39;wineries&#39;</span><span class="p">,</span> <span class="n">con</span> <span class="o">=</span> <span class="n">engine</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">if_exists</span> <span class="o">=</span> <span class="s1">&#39;replace&#39;</span><span class="p">)</span>
<span class="n">locations</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s1">&#39;locations&#39;</span><span class="p">,</span> <span class="n">con</span> <span class="o">=</span> <span class="n">engine</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">if_exists</span> <span class="o">=</span> <span class="s1">&#39;replace&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-2
</pre></div>
</div>
</div>
</div>
<p>Now all four tables are entities within the <code class="docutils literal notranslate"><span class="pre">winedb</span></code> database.</p>
<p>To query the database, we can use the <code class="docutils literal notranslate"><span class="pre">pd.read_sql_query()</span></code> function by passing the <code class="docutils literal notranslate"><span class="pre">sqlalchemy</span></code> engine to this function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">myquery</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">SELECT *</span>
<span class="s1">FROM reviews</span>
<span class="s1">&#39;&#39;&#39;</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">myquery</span><span class="p">,</span> <span class="n">con</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>wine_id</th>
      <th>title</th>
      <th>variety</th>
      <th>description</th>
      <th>points</th>
      <th>price</th>
      <th>taster_id</th>
      <th>winery_id</th>
      <th>location_id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>Nicosia 2013 Vulkà Bianco  (Etna)</td>
      <td>White Blend</td>
      <td>Aromas include tropical fruit, broom, brimston...</td>
      <td>87</td>
      <td>NaN</td>
      <td>1</td>
      <td>10256</td>
      <td>842</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>Quinta dos Avidagos 2011 Avidagos Red (Douro)</td>
      <td>Portuguese Red</td>
      <td>This is ripe and fruity, a wine that is smooth...</td>
      <td>87</td>
      <td>15.0</td>
      <td>2</td>
      <td>11412</td>
      <td>1050</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>Rainstorm 2013 Pinot Gris (Willamette Valley)</td>
      <td>Pinot Gris</td>
      <td>Tart and snappy, the flavors of lime flesh and...</td>
      <td>87</td>
      <td>14.0</td>
      <td>3</td>
      <td>11469</td>
      <td>1456</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>St. Julian 2013 Reserve Late Harvest Riesling ...</td>
      <td>Riesling</td>
      <td>Pineapple rind, lemon pith and orange blossom ...</td>
      <td>87</td>
      <td>13.0</td>
      <td>4</td>
      <td>12612</td>
      <td>1416</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>Sweet Cheeks 2012 Vintner's Reserve Wild Child...</td>
      <td>Pinot Noir</td>
      <td>Much like the regular bottling from 2012, this...</td>
      <td>87</td>
      <td>65.0</td>
      <td>3</td>
      <td>12790</td>
      <td>1456</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>103722</th>
      <td>129966</td>
      <td>Dr. H. Thanisch (Erben Müller-Burggraef) 2013 ...</td>
      <td>Riesling</td>
      <td>Notes of honeysuckle and cantaloupe sweeten th...</td>
      <td>90</td>
      <td>28.0</td>
      <td>6</td>
      <td>6025</td>
      <td>621</td>
    </tr>
    <tr>
      <th>103723</th>
      <td>129967</td>
      <td>Citation 2004 Pinot Noir (Oregon)</td>
      <td>Pinot Noir</td>
      <td>Citation is given as much as a decade of bottl...</td>
      <td>90</td>
      <td>75.0</td>
      <td>3</td>
      <td>4342</td>
      <td>1449</td>
    </tr>
    <tr>
      <th>103724</th>
      <td>129968</td>
      <td>Domaine Gresser 2013 Kritt Gewurztraminer (Als...</td>
      <td>Gewürztraminer</td>
      <td>Well-drained gravel soil gives this wine its c...</td>
      <td>90</td>
      <td>30.0</td>
      <td>2</td>
      <td>5622</td>
      <td>221</td>
    </tr>
    <tr>
      <th>103725</th>
      <td>129969</td>
      <td>Domaine Marcel Deiss 2012 Pinot Gris (Alsace)</td>
      <td>Pinot Gris</td>
      <td>A dry style of Pinot Gris, this is crisp with ...</td>
      <td>90</td>
      <td>32.0</td>
      <td>2</td>
      <td>5745</td>
      <td>221</td>
    </tr>
    <tr>
      <th>103726</th>
      <td>129970</td>
      <td>Domaine Schoffit 2012 Lieu-dit Harth Cuvée Car...</td>
      <td>Gewürztraminer</td>
      <td>Big, rich and off-dry, this is powered by inte...</td>
      <td>90</td>
      <td>21.0</td>
      <td>2</td>
      <td>5862</td>
      <td>221</td>
    </tr>
  </tbody>
</table>
<p>103727 rows × 9 columns</p>
</div></div></div>
</div>
<p>Finally we close the connection to the server to prevent any other applications from interfacing with this server:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dbserver</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="using-mongodb">
<h3><a class="toc-backref" href="#id28" role="doc-backlink"><span class="section-number">6.3.6. </span>Using MongoDB</a><a class="headerlink" href="#using-mongodb" title="Link to this heading">#</a></h3>
<p>MongoDB works with document stores, a type of NoSQL database that stores records as documents, often in JSON format. As with MySQL and PostgreSQL, the first step is to install the external MongoDB software on to your computer via Docker. The version we will use is the Community Edition, which is open source. First, follow the instructions in <a class="reference external" href="https://jkropko.github.io/surfing-the-data-pipeline/ch6.html#installing-database-systems-using-docker">Installing Database Systems Using Docker</a> to ensure that Mongo is running via a container on your system.</p>
<p>For this example, we’ll use a JSON version of the wine database. The following code converts the total wine reviews dataset to JSON format and registers it as JSON formatted data (in this case, a list containing dictionaries for each wine):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="n">wine_json_text</span> <span class="o">=</span> <span class="n">total</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;records&quot;</span><span class="p">)</span>
<span class="n">wine_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">wine_json_text</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The first record in the JSON data is</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wine_json</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;wine_id&#39;: 0,
 &#39;country&#39;: &#39;Italy&#39;,
 &#39;description&#39;: &quot;Aromas include tropical fruit, broom, brimstone and dried herb. The palate isn&#39;t overly expressive, offering unripened apple, citrus and dried sage alongside brisk acidity.&quot;,
 &#39;points&#39;: 87,
 &#39;price&#39;: None,
 &#39;province&#39;: &#39;Sicily &amp; Sardinia&#39;,
 &#39;region&#39;: &#39;Etna&#39;,
 &#39;taster_name&#39;: &#39;Kerin O’Keefe&#39;,
 &#39;taster_twitter_handle&#39;: &#39;@kerinokeefe&#39;,
 &#39;title&#39;: &#39;Nicosia 2013 Vulkà Bianco  (Etna)&#39;,
 &#39;variety&#39;: &#39;White Blend&#39;,
 &#39;winery&#39;: &#39;Nicosia&#39;}
</pre></div>
</div>
</div>
</div>
<p>To work with MongoDB in Python, we use the <code class="docutils literal notranslate"><span class="pre">pymongo</span></code> library:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pymongo</span>
</pre></div>
</div>
</div>
</div>
<p>To access the MongoDB server, use the <code class="docutils literal notranslate"><span class="pre">.MongoClient()</span></code> method. The address inside the following call to <code class="docutils literal notranslate"><span class="pre">.MongoClient()</span></code> works similarly to a <code class="docutils literal notranslate"><span class="pre">sqlalchemy</span></code> engine by combining the host and port of the server with the username and password for accessing this server:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mongo_user</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;MONGO_INITDB_ROOT_USERNAME&#39;</span><span class="p">)</span>
<span class="n">mongo_password</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;MONGO_INITDB_ROOT_PASSWORD&#39;</span><span class="p">)</span>
<span class="n">host</span> <span class="o">=</span> <span class="s1">&#39;localhost&#39;</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">27017</span>
<span class="n">myclient</span> <span class="o">=</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">MongoClient</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;mongodb://</span><span class="si">{</span><span class="n">mongo_user</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">mongo_password</span><span class="si">}</span><span class="s2">@</span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s2">/&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Unlike MySQL and PostgreSQL, the same connection represented with <code class="docutils literal notranslate"><span class="pre">myclient</span></code> can be used to communicate with both the Mongo server and databases on that server in a straightforward way.</p>
<p>To create a database on this server, we pass a string element to <code class="docutils literal notranslate"><span class="pre">myclient</span></code> named after the database we want to create. Here we create a database called “winedb” on the MongoDB server, and we refer to this database as <code class="docutils literal notranslate"><span class="pre">winedb</span></code> in the Python environment. If “winedb” already exists, this code establishes a connection to the existing database without overwriting it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">winedb</span> <span class="o">=</span> <span class="n">myclient</span><span class="p">[</span><span class="s2">&quot;winedb&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Another difference between Mongo and relational DBMSs like MySQL and PostgreSQL is that Mongo adds an additional layer of storage. MySQL and PostreSQL have two layers: a server that contains many databases, and databases that contain data. With Mongo, however, while the server still contains many databases, one database can contain many collections of documents. Here we set up a new collection named “winecollection” inside the “winedb” database on the MongoDB server, and we refer to this collection as <code class="docutils literal notranslate"><span class="pre">winecollection</span></code> in the Python environment.</p>
<p>For the purposes of this example, I start with an empty collection. <strong>Note: do not run the following code to access an existing collection. This is for creating a new collection from scratch, or for deleting an existing collection and starting one from scratch to replace it.</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">collist</span> <span class="o">=</span> <span class="n">winedb</span><span class="o">.</span><span class="n">list_collection_names</span><span class="p">()</span>
<span class="k">if</span> <span class="s2">&quot;winecollection&quot;</span> <span class="ow">in</span> <span class="n">collist</span><span class="p">:</span>
  <span class="n">winedb</span><span class="o">.</span><span class="n">winecollection</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>The following code accesses “winecollection” if it exists, or creates an empty collection named “winecollection” if it does not yet exist:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">winecollection</span> <span class="o">=</span> <span class="n">winedb</span><span class="p">[</span><span class="s2">&quot;winecollection&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>It’s time to put some documents into this document store. To put one document into a collection, use the <code class="docutils literal notranslate"><span class="pre">.insert_one()</span></code> method which operates on the Python variable that refers to the collection we are editing. Here we put the first wine in the data into “winecollection”:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">onewine</span> <span class="o">=</span> <span class="n">winecollection</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">wine_json</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>When we operate on a MongoDB database by creating, reading, updating, or deleting records, and set this operation equal to a Python variable (<code class="docutils literal notranslate"><span class="pre">onewine</span></code> in this case), that variable acts as the cursor for the database.</p>
<p>When we put documents into a MongoDB document store, MongoDB places a unique primary key onto the document. To see the primary key for the record we just placed into the database, call the <code class="docutils literal notranslate"><span class="pre">.inserted_id</span></code> attribute of the cursor:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">onewine</span><span class="o">.</span><span class="n">inserted_id</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ObjectId(&#39;673ca6e778ef897a253fb2c2&#39;)
</pre></div>
</div>
</div>
</div>
<p>To query the database, write the query in JSON format, not in SQL format. For example, to find the wine whose title is “Nicosia 2013 Vulkà Bianco (Etna)”, we write:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">myquery</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Nicosia 2013 Vulkà Bianco  (Etna)&#39;</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>To execute this query, specify the collection and apply the <code class="docutils literal notranslate"><span class="pre">.find()</span></code> method, passing the query to <code class="docutils literal notranslate"><span class="pre">.find()</span></code>. To see the query results, use a loop across elements of the cursor (<code class="docutils literal notranslate"><span class="pre">mywine</span></code> in this case) and print the elements. Here, because we are issuing a query for the only record in the database, we see one result:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mywine</span> <span class="o">=</span> <span class="n">winecollection</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">myquery</span><span class="p">)</span> 
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">mywine</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;_id&#39;: ObjectId(&#39;673ca6e778ef897a253fb2c2&#39;), &#39;wine_id&#39;: 0, &#39;country&#39;: &#39;Italy&#39;, &#39;description&#39;: &quot;Aromas include tropical fruit, broom, brimstone and dried herb. The palate isn&#39;t overly expressive, offering unripened apple, citrus and dried sage alongside brisk acidity.&quot;, &#39;points&#39;: 87, &#39;price&#39;: None, &#39;province&#39;: &#39;Sicily &amp; Sardinia&#39;, &#39;region&#39;: &#39;Etna&#39;, &#39;taster_name&#39;: &#39;Kerin O’Keefe&#39;, &#39;taster_twitter_handle&#39;: &#39;@kerinokeefe&#39;, &#39;title&#39;: &#39;Nicosia 2013 Vulkà Bianco  (Etna)&#39;, &#39;variety&#39;: &#39;White Blend&#39;, &#39;winery&#39;: &#39;Nicosia&#39;}
</pre></div>
</div>
</div>
</div>
<p>To delete documents, query the documents you want to delete and pass this query to the <code class="docutils literal notranslate"><span class="pre">.delete_one()</span></code> method:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">myquery</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Nicosia 2013 Vulkà Bianco  (Etna)&#39;</span><span class="p">}</span>
<span class="n">winecollection</span><span class="o">.</span><span class="n">delete_one</span><span class="p">(</span><span class="n">myquery</span><span class="p">)</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DeleteResult({&#39;n&#39;: 1, &#39;ok&#39;: 1.0}, acknowledged=True)
</pre></div>
</div>
</div>
</div>
<p>Now “winecollection” is empty again.</p>
<p>Next, let’s insert all of the records into “winecollection”. In this case, we use the <code class="docutils literal notranslate"><span class="pre">.insert_many()</span></code> method applied to <code class="docutils literal notranslate"><span class="pre">winecollection</span></code> and pass a list of individual JSON formatted records:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">allwine</span> <span class="o">=</span> <span class="n">winecollection</span><span class="o">.</span><span class="n">insert_many</span><span class="p">(</span><span class="n">wine_json</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>To see the number of documents in a collection, use the <code class="docutils literal notranslate"><span class="pre">.count_documents()</span></code> method on the collection. Passing an empty set <code class="docutils literal notranslate"><span class="pre">{}</span></code> counts all documents, and passing a JSON query counts the number of documents that match that query:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">winecollection</span><span class="o">.</span><span class="n">count_documents</span><span class="p">({})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>103727
</pre></div>
</div>
</div>
</div>
<p>Of all of these wines, we can use a query to identify all of the reviews of wines from Virginia. We can further narrow that search down to only the Cabernet Sauvignons from Virginia. The query that identifies these documents is:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">myquery</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;province&#39;</span><span class="p">:</span> <span class="s1">&#39;Virginia&#39;</span><span class="p">,</span>
          <span class="s1">&#39;variety&#39;</span><span class="p">:</span> <span class="s1">&#39;Cabernet Sauvignon&#39;</span><span class="p">}</span>
<span class="n">vawine</span> <span class="o">=</span> <span class="n">winecollection</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">myquery</span><span class="p">)</span> 
<span class="n">winecollection</span><span class="o">.</span><span class="n">count_documents</span><span class="p">(</span><span class="n">myquery</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>13
</pre></div>
</div>
</div>
</div>
<p>There are 13 Cabernet Sauvignons from Virginia in the data. To collect the data from these records and output a JSON file with only these wines, we use the <code class="docutils literal notranslate"><span class="pre">dumps</span></code> and <code class="docutils literal notranslate"><span class="pre">loads</span></code> functions from the <code class="docutils literal notranslate"><span class="pre">bson.json_util</span></code> module. Do not type <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">bson</span></code>: the <code class="docutils literal notranslate"><span class="pre">bson</span></code> library is installed along with <code class="docutils literal notranslate"><span class="pre">pymongo</span></code> with matching versions. Installing <code class="docutils literal notranslate"><span class="pre">bson</span></code> separately acquires the old version of <code class="docutils literal notranslate"><span class="pre">bson</span></code>, which can clash with <code class="docutils literal notranslate"><span class="pre">pymongo</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">bson.json_util</span></code> is similar to the <code class="docutils literal notranslate"><span class="pre">json</span></code> library, but it contains extra functionality to work with the <code class="docutils literal notranslate"><span class="pre">pymongo</span></code> curser to extract the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bson.json_util</span> <span class="kn">import</span> <span class="n">dumps</span><span class="p">,</span> <span class="n">loads</span>
</pre></div>
</div>
</div>
</div>
<p>To assist in issuing queries to the Mongo collection, we can use the following helper function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">mongo_query</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">row_query</span><span class="o">=</span><span class="p">{},</span> <span class="n">col_query</span><span class="o">=</span><span class="p">{}):</span>
    <span class="n">find</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">row_query</span><span class="p">,</span> <span class="n">col_query</span><span class="p">)</span>
    <span class="n">find_dump</span> <span class="o">=</span> <span class="n">dumps</span><span class="p">(</span><span class="n">find</span><span class="p">)</span>
    <span class="n">find_loads</span> <span class="o">=</span> <span class="n">loads</span><span class="p">(</span><span class="n">find_dump</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">find_loads</span>
</pre></div>
</div>
</div>
</div>
<p>This function passes a query to the Mongo database that uses a dictionary to filter the rows and another dictionary to filter the columns. The result of the query is formatted as a list of dictionaries. We will discuss the Mongo query language in greater detail in <a class="reference external" href="https://jkropko.github.io/surfing-the-data-pipeline/ch7.html#mongodb-queries">the next chapter</a>.</p>
<p>For example, to see all of the wines that are Cabernet Sauvignons from Virginia, we can type:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span><span class="n">mongo_query</span><span class="p">(</span><span class="n">winecollection</span><span class="p">,</span> 
            <span class="n">row_query</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;province&#39;</span><span class="p">:</span> <span class="s1">&#39;Virginia&#39;</span><span class="p">,</span><span class="s1">&#39;variety&#39;</span><span class="p">:</span> <span class="s1">&#39;Cabernet Sauvignon&#39;</span><span class="p">},</span> 
            <span class="n">col_query</span><span class="o">=</span><span class="p">{})</span>
<span class="n">results</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[{&#39;_id&#39;: ObjectId(&#39;673ca6e778ef897a253fd8db&#39;),
  &#39;wine_id&#39;: 12218,
  &#39;country&#39;: &#39;US&#39;,
  &#39;description&#39;: &#39;Cherry jam notes are bright on the nose, showing sawdust and menthol tones in the background. A smooth palate with little tannic grip is driven by juicy red currant, accented by a sprinkling of black pepper.&#39;,
  &#39;points&#39;: 86,
  &#39;price&#39;: 25.0,
  &#39;province&#39;: &#39;Virginia&#39;,
  &#39;region&#39;: &#39;Virginia&#39;,
  &#39;taster_name&#39;: &#39;Alexander Peartree&#39;,
  &#39;taster_twitter_handle&#39;: None,
  &#39;title&#39;: &#39;The Boneyard 2012 Cabernet Sauvignon (Virginia)&#39;,
  &#39;variety&#39;: &#39;Cabernet Sauvignon&#39;,
  &#39;winery&#39;: &#39;The Boneyard&#39;},
 {&#39;_id&#39;: ObjectId(&#39;673ca6e778ef897a253fe4b4&#39;),
  &#39;wine_id&#39;: 16002,
  &#39;country&#39;: &#39;US&#39;,
  &#39;description&#39;: &#39;This Cabernet Sauvignon smells ripe, with cherry cola, red currant and red plum aromas. Pleasant tones of church incense and vanilla lead to an oaky palate. Cherry and geranium come through, but the oak is prevalent and leads to a long, smoky finish.&#39;,
  &#39;points&#39;: 86,
  &#39;price&#39;: 50.0,
  &#39;province&#39;: &#39;Virginia&#39;,
  &#39;region&#39;: &#39;Virginia&#39;,
  &#39;taster_name&#39;: &#39;Carrie Dykes&#39;,
  &#39;taster_twitter_handle&#39;: None,
  &#39;title&#39;: &#39;Gray Ghost 2014 Reserve Cabernet Sauvignon (Virginia)&#39;,
  &#39;variety&#39;: &#39;Cabernet Sauvignon&#39;,
  &#39;winery&#39;: &#39;Gray Ghost&#39;},
 {&#39;_id&#39;: ObjectId(&#39;673ca6e778ef897a253fe4b5&#39;),
  &#39;wine_id&#39;: 16003,
  &#39;country&#39;: &#39;US&#39;,
  &#39;description&#39;: &#39;This wine has upfront aromas of black cherries, dried herbs and baking spices. On the palate the spices take over, showing charred oak, bramble and vanilla. A full body and drying tannins crave an acidic lift. The finish is long and spicy.&#39;,
  &#39;points&#39;: 86,
  &#39;price&#39;: 28.0,
  &#39;province&#39;: &#39;Virginia&#39;,
  &#39;region&#39;: &#39;Virginia&#39;,
  &#39;taster_name&#39;: &#39;Carrie Dykes&#39;,
  &#39;taster_twitter_handle&#39;: None,
  &#39;title&#39;: &#39;Gray Ghost 2015 Unfiltered Cabernet Sauvignon (Virginia)&#39;,
  &#39;variety&#39;: &#39;Cabernet Sauvignon&#39;,
  &#39;winery&#39;: &#39;Gray Ghost&#39;},
 {&#39;_id&#39;: ObjectId(&#39;673ca6e778ef897a253ffb8a&#39;),
  &#39;wine_id&#39;: 23457,
  &#39;country&#39;: &#39;US&#39;,
  &#39;description&#39;: &quot;Currant, cola, spice and cherry lead this layered Cab from Delfosse. It&#39;s an approachable style but with added character: cinnamon spice, tobacco and black cherry on the palate is integrated and smooth. An elegant wine with ageable chops.&quot;,
  &#39;points&#39;: 86,
  &#39;price&#39;: 24.0,
  &#39;province&#39;: &#39;Virginia&#39;,
  &#39;region&#39;: &#39;Monticello&#39;,
  &#39;taster_name&#39;: &#39;Susan Kostrzewa&#39;,
  &#39;taster_twitter_handle&#39;: &#39;@suskostrzewa&#39;,
  &#39;title&#39;: &#39;Delfosse 2007 Cabernet Sauvignon (Monticello)&#39;,
  &#39;variety&#39;: &#39;Cabernet Sauvignon&#39;,
  &#39;winery&#39;: &#39;Delfosse&#39;},
 {&#39;_id&#39;: ObjectId(&#39;673ca6e778ef897a25400611&#39;),
  &#39;wine_id&#39;: 26887,
  &#39;country&#39;: &#39;US&#39;,
  &#39;description&#39;: &quot;The nose on this wine is quite interesting, with a ripe cranberry scent and a prominent note of marijuana. That herbal, grassy note is also the main player on the palate, as there&#39;s not much fruit or other components to go with it. It&#39;s light in body and tannin, with ample acidity.&quot;,
  &#39;points&#39;: 81,
  &#39;price&#39;: 43.0,
  &#39;province&#39;: &#39;Virginia&#39;,
  &#39;region&#39;: &#39;Virginia&#39;,
  &#39;taster_name&#39;: &#39;Carrie Dykes&#39;,
  &#39;taster_twitter_handle&#39;: None,
  &#39;title&#39;: &#39;Winery at La Grange 2012 Cabernet Sauvignon (Virginia)&#39;,
  &#39;variety&#39;: &#39;Cabernet Sauvignon&#39;,
  &#39;winery&#39;: &#39;Winery at La Grange&#39;},
 {&#39;_id&#39;: ObjectId(&#39;673ca6e778ef897a25403530&#39;),
  &#39;wine_id&#39;: 41932,
  &#39;country&#39;: &#39;US&#39;,
  &#39;description&#39;: &#39;An oaky aroma of buttered toast is elevated over ripe cherry and crushed black pepper. The palate shows more nuance, with tart red currant leading to juicy red fruit and granite dust. Slightly sandy tannins provide just enough grip to give this wine appropriate balance and structure.&#39;,
  &#39;points&#39;: 87,
  &#39;price&#39;: 26.0,
  &#39;province&#39;: &#39;Virginia&#39;,
  &#39;region&#39;: &#39;Virginia&#39;,
  &#39;taster_name&#39;: &#39;Alexander Peartree&#39;,
  &#39;taster_twitter_handle&#39;: None,
  &#39;title&#39;: &#39;Annefield Vineyards 2012 Cabernet Sauvignon (Virginia)&#39;,
  &#39;variety&#39;: &#39;Cabernet Sauvignon&#39;,
  &#39;winery&#39;: &#39;Annefield Vineyards&#39;},
 {&#39;_id&#39;: ObjectId(&#39;673ca6e778ef897a25403909&#39;),
  &#39;wine_id&#39;: 43247,
  &#39;country&#39;: &#39;US&#39;,
  &#39;description&#39;: &#39;Lush black plum, bramble and black pepper mingle with cedar and spicy oak notes in this wine. These extend to the palate, where licorice and dried herbs linger. This wine is deep and extracted, so the full tannic structure does not seem out of place.&#39;,
  &#39;points&#39;: 87,
  &#39;price&#39;: 34.0,
  &#39;province&#39;: &#39;Virginia&#39;,
  &#39;region&#39;: &#39;Middleburg&#39;,
  &#39;taster_name&#39;: &#39;Carrie Dykes&#39;,
  &#39;taster_twitter_handle&#39;: None,
  &#39;title&#39;: &#39;Casanel 2014 Estate Cabernet Sauvignon (Middleburg)&#39;,
  &#39;variety&#39;: &#39;Cabernet Sauvignon&#39;,
  &#39;winery&#39;: &#39;Casanel&#39;},
 {&#39;_id&#39;: ObjectId(&#39;673ca6e878ef897a254076c4&#39;),
  &#39;wine_id&#39;: 63335,
  &#39;country&#39;: &#39;US&#39;,
  &#39;description&#39;: &#39;Cherry candies, grapefruit and watermelon grace the nose. The light-bodied palate shows little intensity and focuses on an underripe strawberry note.&#39;,
  &#39;points&#39;: 84,
  &#39;price&#39;: 19.0,
  &#39;province&#39;: &#39;Virginia&#39;,
  &#39;region&#39;: &#39;Shenandoah Valley&#39;,
  &#39;taster_name&#39;: &#39;Alexander Peartree&#39;,
  &#39;taster_twitter_handle&#39;: None,
  &#39;title&#39;: &#39;Shenandoah Vineyards 2014 Rosé of Cabernet Sauvignon (Shenandoah Valley)&#39;,
  &#39;variety&#39;: &#39;Cabernet Sauvignon&#39;,
  &#39;winery&#39;: &#39;Shenandoah Vineyards&#39;},
 {&#39;_id&#39;: ObjectId(&#39;673ca6e878ef897a254081d2&#39;),
  &#39;wine_id&#39;: 66833,
  &#39;country&#39;: &#39;US&#39;,
  &#39;description&#39;: &#39;Lush blackberry, vanilla and baking spices entice the olfactory. These aromas carry through to the palate, where a clove flavor becomes more abundant. It offers grippy tannins and decent acidity, with a long, dry and spicy finish.&#39;,
  &#39;points&#39;: 87,
  &#39;price&#39;: 28.0,
  &#39;province&#39;: &#39;Virginia&#39;,
  &#39;region&#39;: &#39;Middleburg&#39;,
  &#39;taster_name&#39;: &#39;Carrie Dykes&#39;,
  &#39;taster_twitter_handle&#39;: None,
  &#39;title&#39;: &#39;Casanel 2013 Cabernet Sauvignon (Middleburg)&#39;,
  &#39;variety&#39;: &#39;Cabernet Sauvignon&#39;,
  &#39;winery&#39;: &#39;Casanel&#39;},
 {&#39;_id&#39;: ObjectId(&#39;673ca6e878ef897a2540ae15&#39;),
  &#39;wine_id&#39;: 80812,
  &#39;country&#39;: &#39;US&#39;,
  &#39;description&#39;: &#39;Ripe and rich on the nose with a harmonious black fruit and sweet vanilla bean aroma, this Virginia Cab is clean and pure with a remarkably pristine fruit profile. Bright and fresh with balanced acidity and a nicely concentrated midpalate.&#39;,
  &#39;points&#39;: 86,
  &#39;price&#39;: 19.0,
  &#39;province&#39;: &#39;Virginia&#39;,
  &#39;region&#39;: &#39;Virginia&#39;,
  &#39;taster_name&#39;: &#39;Anna Lee C. Iijima&#39;,
  &#39;taster_twitter_handle&#39;: None,
  &#39;title&#39;: &#39;Veramar 2008 Estate Club Cabernet Sauvignon (Virginia)&#39;,
  &#39;variety&#39;: &#39;Cabernet Sauvignon&#39;,
  &#39;winery&#39;: &#39;Veramar&#39;},
 {&#39;_id&#39;: ObjectId(&#39;673ca6e878ef897a2540c9a3&#39;),
  &#39;wine_id&#39;: 89662,
  &#39;country&#39;: &#39;US&#39;,
  &#39;description&#39;: &#39;This wine has intense aromas of blueberry pie and vanilla, along with a barnyard note. The palate is jammy in prune and baked berry flavors. There is a yeasty and resinous quality as well. The finish is long, tart and mouthwatering, with a charred-oak note on the back.&#39;,
  &#39;points&#39;: 84,
  &#39;price&#39;: 27.0,
  &#39;province&#39;: &#39;Virginia&#39;,
  &#39;region&#39;: &#39;Virginia&#39;,
  &#39;taster_name&#39;: &#39;Carrie Dykes&#39;,
  &#39;taster_twitter_handle&#39;: None,
  &#39;title&#39;: &#39;Narmada 2014 Cabernet Sauvignon (Virginia)&#39;,
  &#39;variety&#39;: &#39;Cabernet Sauvignon&#39;,
  &#39;winery&#39;: &#39;Narmada&#39;},
 {&#39;_id&#39;: ObjectId(&#39;673ca6e878ef897a25411844&#39;),
  &#39;wine_id&#39;: 114775,
  &#39;country&#39;: &#39;US&#39;,
  &#39;description&#39;: &#39;With notes of green pepper, clove and ripe plum, this wine is super herbacious and stalky on the nose. Green pepper is heavy on the palate as well, and mingles with blackberry, currant, white pepper, black pepper and some baking spices. The tannins and acidity are well integrated and lend to a long finish that ends on a charred-oak note.&#39;,
  &#39;points&#39;: 85,
  &#39;price&#39;: 34.0,
  &#39;province&#39;: &#39;Virginia&#39;,
  &#39;region&#39;: &#39;Virginia&#39;,
  &#39;taster_name&#39;: &#39;Carrie Dykes&#39;,
  &#39;taster_twitter_handle&#39;: None,
  &#39;title&#39;: &#39;James River 2010 Cabernet Sauvignon (Virginia)&#39;,
  &#39;variety&#39;: &#39;Cabernet Sauvignon&#39;,
  &#39;winery&#39;: &#39;James River&#39;},
 {&#39;_id&#39;: ObjectId(&#39;673ca6e878ef897a25413abb&#39;),
  &#39;wine_id&#39;: 125676,
  &#39;country&#39;: &#39;US&#39;,
  &#39;description&#39;: &#39;Cherry jam notes are bright on the nose, showing sawdust and menthol tones in the background. A smooth palate with little tannic grip is driven by juicy red currant, accented by a sprinkling of black pepper.&#39;,
  &#39;points&#39;: 86,
  &#39;price&#39;: 25.0,
  &#39;province&#39;: &#39;Virginia&#39;,
  &#39;region&#39;: &#39;Virginia&#39;,
  &#39;taster_name&#39;: &#39;Alexander Peartree&#39;,
  &#39;taster_twitter_handle&#39;: None,
  &#39;title&#39;: &#39;The Boneyard 2012 Cabernet Sauvignon (Virginia)&#39;,
  &#39;variety&#39;: &#39;Cabernet Sauvignon&#39;,
  &#39;winery&#39;: &#39;The Boneyard&#39;}]
</pre></div>
</div>
</div>
</div>
<p>A list of dictionaries can be converted to a pandas dataframe with the <code class="docutils literal notranslate"><span class="pre">pd.DataFrame.from_records()</span></code> method:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_records</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>_id</th>
      <th>wine_id</th>
      <th>country</th>
      <th>description</th>
      <th>points</th>
      <th>price</th>
      <th>province</th>
      <th>region</th>
      <th>taster_name</th>
      <th>taster_twitter_handle</th>
      <th>title</th>
      <th>variety</th>
      <th>winery</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>673ca6e778ef897a253fd8db</td>
      <td>12218</td>
      <td>US</td>
      <td>Cherry jam notes are bright on the nose, showi...</td>
      <td>86</td>
      <td>25.0</td>
      <td>Virginia</td>
      <td>Virginia</td>
      <td>Alexander Peartree</td>
      <td>None</td>
      <td>The Boneyard 2012 Cabernet Sauvignon (Virginia)</td>
      <td>Cabernet Sauvignon</td>
      <td>The Boneyard</td>
    </tr>
    <tr>
      <th>1</th>
      <td>673ca6e778ef897a253fe4b4</td>
      <td>16002</td>
      <td>US</td>
      <td>This Cabernet Sauvignon smells ripe, with cher...</td>
      <td>86</td>
      <td>50.0</td>
      <td>Virginia</td>
      <td>Virginia</td>
      <td>Carrie Dykes</td>
      <td>None</td>
      <td>Gray Ghost 2014 Reserve Cabernet Sauvignon (Vi...</td>
      <td>Cabernet Sauvignon</td>
      <td>Gray Ghost</td>
    </tr>
    <tr>
      <th>2</th>
      <td>673ca6e778ef897a253fe4b5</td>
      <td>16003</td>
      <td>US</td>
      <td>This wine has upfront aromas of black cherries...</td>
      <td>86</td>
      <td>28.0</td>
      <td>Virginia</td>
      <td>Virginia</td>
      <td>Carrie Dykes</td>
      <td>None</td>
      <td>Gray Ghost 2015 Unfiltered Cabernet Sauvignon ...</td>
      <td>Cabernet Sauvignon</td>
      <td>Gray Ghost</td>
    </tr>
    <tr>
      <th>3</th>
      <td>673ca6e778ef897a253ffb8a</td>
      <td>23457</td>
      <td>US</td>
      <td>Currant, cola, spice and cherry lead this laye...</td>
      <td>86</td>
      <td>24.0</td>
      <td>Virginia</td>
      <td>Monticello</td>
      <td>Susan Kostrzewa</td>
      <td>@suskostrzewa</td>
      <td>Delfosse 2007 Cabernet Sauvignon (Monticello)</td>
      <td>Cabernet Sauvignon</td>
      <td>Delfosse</td>
    </tr>
    <tr>
      <th>4</th>
      <td>673ca6e778ef897a25400611</td>
      <td>26887</td>
      <td>US</td>
      <td>The nose on this wine is quite interesting, wi...</td>
      <td>81</td>
      <td>43.0</td>
      <td>Virginia</td>
      <td>Virginia</td>
      <td>Carrie Dykes</td>
      <td>None</td>
      <td>Winery at La Grange 2012 Cabernet Sauvignon (V...</td>
      <td>Cabernet Sauvignon</td>
      <td>Winery at La Grange</td>
    </tr>
    <tr>
      <th>5</th>
      <td>673ca6e778ef897a25403530</td>
      <td>41932</td>
      <td>US</td>
      <td>An oaky aroma of buttered toast is elevated ov...</td>
      <td>87</td>
      <td>26.0</td>
      <td>Virginia</td>
      <td>Virginia</td>
      <td>Alexander Peartree</td>
      <td>None</td>
      <td>Annefield Vineyards 2012 Cabernet Sauvignon (V...</td>
      <td>Cabernet Sauvignon</td>
      <td>Annefield Vineyards</td>
    </tr>
    <tr>
      <th>6</th>
      <td>673ca6e778ef897a25403909</td>
      <td>43247</td>
      <td>US</td>
      <td>Lush black plum, bramble and black pepper ming...</td>
      <td>87</td>
      <td>34.0</td>
      <td>Virginia</td>
      <td>Middleburg</td>
      <td>Carrie Dykes</td>
      <td>None</td>
      <td>Casanel 2014 Estate Cabernet Sauvignon (Middle...</td>
      <td>Cabernet Sauvignon</td>
      <td>Casanel</td>
    </tr>
    <tr>
      <th>7</th>
      <td>673ca6e878ef897a254076c4</td>
      <td>63335</td>
      <td>US</td>
      <td>Cherry candies, grapefruit and watermelon grac...</td>
      <td>84</td>
      <td>19.0</td>
      <td>Virginia</td>
      <td>Shenandoah Valley</td>
      <td>Alexander Peartree</td>
      <td>None</td>
      <td>Shenandoah Vineyards 2014 Rosé of Cabernet Sau...</td>
      <td>Cabernet Sauvignon</td>
      <td>Shenandoah Vineyards</td>
    </tr>
    <tr>
      <th>8</th>
      <td>673ca6e878ef897a254081d2</td>
      <td>66833</td>
      <td>US</td>
      <td>Lush blackberry, vanilla and baking spices ent...</td>
      <td>87</td>
      <td>28.0</td>
      <td>Virginia</td>
      <td>Middleburg</td>
      <td>Carrie Dykes</td>
      <td>None</td>
      <td>Casanel 2013 Cabernet Sauvignon (Middleburg)</td>
      <td>Cabernet Sauvignon</td>
      <td>Casanel</td>
    </tr>
    <tr>
      <th>9</th>
      <td>673ca6e878ef897a2540ae15</td>
      <td>80812</td>
      <td>US</td>
      <td>Ripe and rich on the nose with a harmonious bl...</td>
      <td>86</td>
      <td>19.0</td>
      <td>Virginia</td>
      <td>Virginia</td>
      <td>Anna Lee C. Iijima</td>
      <td>None</td>
      <td>Veramar 2008 Estate Club Cabernet Sauvignon (V...</td>
      <td>Cabernet Sauvignon</td>
      <td>Veramar</td>
    </tr>
    <tr>
      <th>10</th>
      <td>673ca6e878ef897a2540c9a3</td>
      <td>89662</td>
      <td>US</td>
      <td>This wine has intense aromas of blueberry pie ...</td>
      <td>84</td>
      <td>27.0</td>
      <td>Virginia</td>
      <td>Virginia</td>
      <td>Carrie Dykes</td>
      <td>None</td>
      <td>Narmada 2014 Cabernet Sauvignon (Virginia)</td>
      <td>Cabernet Sauvignon</td>
      <td>Narmada</td>
    </tr>
    <tr>
      <th>11</th>
      <td>673ca6e878ef897a25411844</td>
      <td>114775</td>
      <td>US</td>
      <td>With notes of green pepper, clove and ripe plu...</td>
      <td>85</td>
      <td>34.0</td>
      <td>Virginia</td>
      <td>Virginia</td>
      <td>Carrie Dykes</td>
      <td>None</td>
      <td>James River 2010 Cabernet Sauvignon (Virginia)</td>
      <td>Cabernet Sauvignon</td>
      <td>James River</td>
    </tr>
    <tr>
      <th>12</th>
      <td>673ca6e878ef897a25413abb</td>
      <td>125676</td>
      <td>US</td>
      <td>Cherry jam notes are bright on the nose, showi...</td>
      <td>86</td>
      <td>25.0</td>
      <td>Virginia</td>
      <td>Virginia</td>
      <td>Alexander Peartree</td>
      <td>None</td>
      <td>The Boneyard 2012 Cabernet Sauvignon (Virginia)</td>
      <td>Cabernet Sauvignon</td>
      <td>The Boneyard</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">pymongo</span></code> does not require that we commit the changes, but we do end our session by closing the connection to the MongoDB server:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">myclient</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="ch5.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">5. </span>Web Scraping Using <code class="docutils literal notranslate"><span class="pre">BeautifulSoup</span></code></p>
      </div>
    </a>
    <a class="right-next"
       href="ch7.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">7. </span>Database Queries</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-what-is-a-database">6.1. Introduction: What is a Database?</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#querying-a-database-vs-using-an-api">6.1.1. Querying a Database vs. Using an API</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#atomicity-consistency-isolation-durability-acid">6.1.2. Atomicity, Consistency, Isolation, Durability (ACID)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-brief-history-of-databases">6.1.3. A Brief History of Databases</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#types-of-databases">6.2. Types of Databases</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#navigational-databases">6.2.1. Navigational Databases</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#relational-databases">6.2.2. Relational Databases</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#relational-database-normalization">6.2.2.1. Relational Database Normalization</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#first-normal-form">6.2.2.1.1. First Normal Form</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#functional-dependence">6.2.2.1.2. Functional Dependence</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#second-normal-form">6.2.2.1.3. Second Normal Form</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#third-normal-form">6.2.2.1.4. Third Normal Form</a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#entity-relationship-diagrams">6.2.2.2. Entity-Relationship Diagrams</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#relational-database-management-systems-rdbms">6.2.2.3. Relational Database Management Systems (RDBMS)</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nosql-databases">6.2.3. NoSQL Databases</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#comparing-nosql-databases-to-relational-databases">6.2.3.1. Comparing NoSQL Databases to Relational Databases</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#key-value-stores">6.2.3.2. Key-Value Stores</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#document-stores">6.2.3.3. Document Stores</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#wide-column-stores">6.2.3.4. Wide-Column Stores</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#graph-databases">6.2.3.5. Graph Databases</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#working-with-databases-in-python">6.3. Working With Databases in Python</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#installing-database-systems-using-docker">6.3.1. Installing Database Systems Using Docker</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-wine-reviews">6.3.2. Example: Wine Reviews</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-sqlite">6.3.3. Using SQLite</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-mysql">6.3.4. Using MySQL</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#connecting-to-the-mysql-server-and-creating-a-new-database">6.3.4.1. Connecting to the MySQL Server and Creating a New Database</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#connecting-to-an-existing-database-on-mysql">6.3.4.2. Connecting to an Existing Database on MySQL</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-postgresql">6.3.5. Using PostgreSQL</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#connecting-to-the-postgresql-server-and-creating-a-new-database">6.3.5.1. Connecting to the PostgreSQL Server and Creating a New Database</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#connecting-to-an-existing-database-on-postgresql">6.3.5.2. Connecting to an Existing Database on PostgreSQL</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-mongodb">6.3.6. Using MongoDB</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Jonathan Kropko (jkropko@virginia.edu)
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>