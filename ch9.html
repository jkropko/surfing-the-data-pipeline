

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>9. Reshaping and Merging Data and Working with Strings, Dates, and Times &#8212; Surfing the Data Pipeline with Python</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'ch9';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="10. Exploratory Data Analysis" href="ch10.html" />
    <link rel="prev" title="8. Data Wrangling with pandas" href="ch8.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/surf.jpg" class="logo__image only-light" alt="Surfing the Data Pipeline with Python - Home"/>
    <script>document.write(`<img src="_static/surf.jpg" class="logo__image only-dark" alt="Surfing the Data Pipeline with Python - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Surfing the Data Pipeline with Python
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Get Started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ch1.html">1. Getting Yourself Unstuck</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Get Data</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ch2.html">2. Loading Data from Electronic Data Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch3.html">3. Loading, Converting, and Writing JSON Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch4.html">4. Acquiring Data from APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch5.html">5. Web Scraping Using <code class="docutils literal notranslate"><span class="pre">BeautifulSoup</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="ch6.html">6. Creating and Connecting to Databases</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Wrangle Data</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ch7.html">7. Database Queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch8.html">8. Data Wrangling with <code class="docutils literal notranslate"><span class="pre">pandas</span></code></a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">9. Reshaping and Merging Data and Working with Strings, Dates, and Times</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Explore and Communicate Data</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ch10.html">10. Exploratory Data Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch11.html">11. Static Data Visualizations</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch12.html">12. Interactive Data Visualizations and Dashboards</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/ch9.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Reshaping and Merging Data and Working with Strings, Dates, and Times</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-pandas-or-sql">9.1. Introduction: <code class="docutils literal notranslate"><span class="pre">pandas</span></code> or SQL?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#joining-dataframes">9.2. Joining Dataframes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-merging-data-on-u-s-state-election-results-income-economies-and-area">9.2.1. Example: Merging Data on U.S. State Election Results, Income, Economies, and Area</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-the-pd-merge-function">9.2.2. Using the <code class="docutils literal notranslate"><span class="pre">pd.merge()</span></code> Function</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#checking-for-problems-that-can-occur-without-errors">9.2.3. Checking for Problems That Can Occur Without Errors</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#merging-all-of-the-dataframes-together-while-checking-for-problems">9.2.4. Merging all of the Dataframes Together While Checking for Problems</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reshaping-data">9.3. Reshaping Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-gross-domestic-product-by-state-1997-2015">9.3.1. Example: Gross domestic product by state, 1997-2015</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#melting-turning-columns-to-rows">9.3.2. Melting: Turning Columns to Rows</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pivoting-turning-rows-to-columns">9.3.3. Pivoting: Turning Rows to Columns</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#working-with-strings-example-the-2019-anes-pilot-study">9.4. Working with Strings (Example: the 2019 ANES Pilot Study)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#working-with-dates-and-times-example-twitter">9.5. Working with Dates and Times (Example: Twitter)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#extracting-year-month-day-and-time-from-a-timestamp-column">9.5.1. Extracting Year, Month, Day, and Time from a Timestamp Column</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#generating-timestamps-from-separate-month-day-and-year-columns">9.5.2. Generating Timestamps from Separate Month, Day, and Year Columns</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#converting-string-columns-to-timestamps">9.5.3. Converting String Columns to Timestamps</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#filtering-rows-based-on-date-ranges">9.5.4. Filtering Rows Based on Date Ranges</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#leads-and-lags">9.5.5. Leads and Lags</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="reshaping-and-merging-data-and-working-with-strings-dates-and-times">
<h1><a class="toc-backref" href="#id1" role="doc-backlink"><span class="section-number">9. </span>Reshaping and Merging Data and Working with Strings, Dates, and Times</a><a class="headerlink" href="#reshaping-and-merging-data-and-working-with-strings-dates-and-times" title="Permalink to this heading">#</a></h1>
<nav class="contents" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#reshaping-and-merging-data-and-working-with-strings-dates-and-times" id="id1">Reshaping and Merging Data and Working with Strings, Dates, and Times</a></p>
<ul>
<li><p><a class="reference internal" href="#introduction-pandas-or-sql" id="id2">Introduction: <code class="docutils literal notranslate"><span class="pre">pandas</span></code> or SQL?</a></p></li>
<li><p><a class="reference internal" href="#joining-dataframes" id="id3">Joining Dataframes</a></p>
<ul>
<li><p><a class="reference internal" href="#example-merging-data-on-u-s-state-election-results-income-economies-and-area" id="id4">Example: Merging Data on U.S. State Election Results, Income, Economies, and Area</a></p></li>
<li><p><a class="reference internal" href="#using-the-pd-merge-function" id="id5">Using the <code class="docutils literal notranslate"><span class="pre">pd.merge()</span></code> Function</a></p></li>
<li><p><a class="reference internal" href="#checking-for-problems-that-can-occur-without-errors" id="id6">Checking for Problems That Can Occur Without Errors</a></p></li>
<li><p><a class="reference internal" href="#merging-all-of-the-dataframes-together-while-checking-for-problems" id="id7">Merging all of the Dataframes Together While Checking for Problems</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#reshaping-data" id="id8">Reshaping Data</a></p>
<ul>
<li><p><a class="reference internal" href="#example-gross-domestic-product-by-state-1997-2015" id="id9">Example: Gross domestic product by state, 1997-2015</a></p></li>
<li><p><a class="reference internal" href="#melting-turning-columns-to-rows" id="id10">Melting: Turning Columns to Rows</a></p></li>
<li><p><a class="reference internal" href="#pivoting-turning-rows-to-columns" id="id11">Pivoting: Turning Rows to Columns</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#working-with-strings-example-the-2019-anes-pilot-study" id="id12">Working with Strings (Example: the 2019 ANES Pilot Study)</a></p></li>
<li><p><a class="reference internal" href="#working-with-dates-and-times-example-twitter" id="id13">Working with Dates and Times (Example: Twitter)</a></p>
<ul>
<li><p><a class="reference internal" href="#extracting-year-month-day-and-time-from-a-timestamp-column" id="id14">Extracting Year, Month, Day, and Time from a Timestamp Column</a></p></li>
<li><p><a class="reference internal" href="#generating-timestamps-from-separate-month-day-and-year-columns" id="id15">Generating Timestamps from Separate Month, Day, and Year Columns</a></p></li>
<li><p><a class="reference internal" href="#converting-string-columns-to-timestamps" id="id16">Converting String Columns to Timestamps</a></p></li>
<li><p><a class="reference internal" href="#filtering-rows-based-on-date-ranges" id="id17">Filtering Rows Based on Date Ranges</a></p></li>
<li><p><a class="reference internal" href="#leads-and-lags" id="id18">Leads and Lags</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
<div style= "float:left;position: relative; padding: 20px">
<a href="https://xkcd.com/1409/"><img src="https://i.imgflip.com/45ymyw.jpg" width="300"></a>
</div>
<section id="introduction-pandas-or-sql">
<h2><a class="toc-backref" href="#id2" role="doc-backlink"><span class="section-number">9.1. </span>Introduction: <code class="docutils literal notranslate"><span class="pre">pandas</span></code> or SQL?</a><a class="headerlink" href="#introduction-pandas-or-sql" title="Permalink to this heading">#</a></h2>
<p>As we saw in module 7, read operations in SQL not only extract data from a database, but they can select and rename columns, filter and sort rows, join tables, and aggregate data. With <code class="docutils literal notranslate"><span class="pre">pandas</span></code>, we can also select and rename columns, filter and sort rows, join tables, and aggregate data. So the question is, should we be using SQL or <code class="docutils literal notranslate"><span class="pre">pandas</span></code> to perform all these data manipulation steps?</p>
<p>SQL is sometimes referred to as <strong>server-side</strong> data manipulation, because databases are often stored on remote servers and SQL queries are processed on the server instead on on a local machine. Data manipulation that is conducted using <code class="docutils literal notranslate"><span class="pre">pandas</span></code> on a local Python installation is called <strong>client-side</strong> data manipulation.</p>
<p>The question of SQL vs. <code class="docutils literal notranslate"><span class="pre">pandas</span></code> (or SQL vs. the tidyverse in R) is the subject of a lot of debate among professionals who use data. The question <a class="reference external" href="https://www.quora.com/In-what-situations-should-you-use-SQL-instead-of-Pandas-as-a-data-scientist">comes up</a> <a class="reference external" href="https://towardsdatascience.com/sql-and-pandas-268f634a4f5d">frequently</a> on <a class="reference external" href="https://www.reddit.com/r/Python/comments/1tqjt4/why_do_you_use_pandas_instead_of_sql/">various</a> <a class="reference external" href="https://datascience.stackexchange.com/questions/34357/why-do-people-prefer-pandas-to-sql">coding forums</a>. Some <a class="reference external" href="https://blog.thedataincubator.com/2018/05/sqlite-vs-pandas-performance-benchmarks/">blog posts</a> have tried to compare SQL and <code class="docutils literal notranslate"><span class="pre">pandas</span></code> in terms of the <a class="reference external" href="https://wesmckinney.com/blog/high-performance-database-joins-with-pandas-dataframe-more-benchmarks/">speed</a> with which they complete equivalent operations, with differing results. <a class="reference external" href="https://medium.com/carwow-product-engineering/sql-vs-pandas-how-to-balance-tasks-between-server-and-client-side-9e2f6c95677">Tina Wenzel and Kavya Gupta</a> note that many factors influence the relative speed of SQL and <code class="docutils literal notranslate"><span class="pre">pandas</span></code> operations, including the configuration of a PostgreSQL database and the bandwidth available in a network connection. They take the mixed evidence into account and conclude that</p>
<blockquote>
<div><p>SQL is the best tool to use for basic data retrieval and the better you know it, the more it will speed up your workflow. More advanced data manipulation tasks can be performed both on the server and client side and it is up to the analyst to balance the workload optimally.</p>
</div></blockquote>
<p>In short, the existing evidence does not overwhelmingly support one option or the other as best practice for data manipulation. The reality is that both SQL and <code class="docutils literal notranslate"><span class="pre">pandas</span></code> are extremely useful and widely-used, and both tools will become part of your workflow. It will take some time and experience with end-to-end projects in data science to learn how to balance SQL and <code class="docutils literal notranslate"><span class="pre">pandas</span></code> in a way that is most comfortable for you in your workflow. But at this stage, there are some important points to keep in mind when thinking about these tools.</p>
<p>First, there are many situations in which the question of SQL vs. <code class="docutils literal notranslate"><span class="pre">pandas</span></code> might be moot. For a given project, our data might not come from a database, but instead from a CSV file, from a JSON document acquired via an API, or from raw HTML that we scraped from a webpage. So in order to use SQL, we would have to take the additional step of creating a database. If we hold ourselves to the principles that E. F. Codd and others laid out about the organization of relational databases, it can take a significant amount of work to create this database. If there is no database involved for a specific data project, there is no role for SQL, but because <code class="docutils literal notranslate"><span class="pre">pandas</span></code> works on dataframes it can be a primary tool for data manipulation regardless of the original source for the data.</p>
<p>Second, while there are differences in speed, these differences only become a significant factor for projects that involve big data, and in those cases, we will almost certainly be working with data stored on remote servers. If the data are organized using a database, then SQL may well be faster than <code class="docutils literal notranslate"><span class="pre">pandas</span></code>, but it very much depends on how the database is <a class="reference external" href="https://severalnines.com/database-blog/guide-postgresql-server-configuration-parameters">configured</a> and on the myriad factors that determine the speed with which code runs through a remote connection. <code class="docutils literal notranslate"><span class="pre">pandas</span></code> can also be used in scripts or Jupyter notebooks that are run on remote servers. Sometimes it makes sense to pull selections of remotely stored data into a local environment so that we can manipulate the data without having to seek permission from a database manager, and in that case, a mix of SQL to choose a selection and <code class="docutils literal notranslate"><span class="pre">pandas</span></code> to manipulate the local data can be very effective.</p>
<p>Third, <code class="docutils literal notranslate"><span class="pre">pandas</span></code> simply has more functionality and flexibility than SQL. For example, it is fairly straightforward to reshape (e.g. pivot) data using <code class="docutils literal notranslate"><span class="pre">pandas</span></code>, and it is <a class="reference external" href="https://stackoverflow.com/questions/2444708/sqlite-long-to-wide-formats">much more difficult to reshape data</a> in SQL. <code class="docutils literal notranslate"><span class="pre">pandas</span></code> has better functionality for working with strings and time and date features than SQL, and <code class="docutils literal notranslate"><span class="pre">pandas</span></code>, being part of a Python environment, works well with any other Python package that works with dataframes or arrays. In contrast, while various DBMSs add specific additions to the base SQL language, SQL extensions tend to be fairly limited because of the inherent tension between expanding the functionality of a query language and staying close enough to base SQL to still be considered SQL. The easiest way to bring SQL query results into a Python enviromnent uses an <code class="docutils literal notranslate"><span class="pre">sqlalchemy</span></code> engine and the <code class="docutils literal notranslate"><span class="pre">pd.read_sql_query()</span></code> funtion from <code class="docutils literal notranslate"><span class="pre">pandas</span></code>.</p>
<p>Fourth, both <code class="docutils literal notranslate"><span class="pre">pandas</span></code> and SQL enable us to work as part of larger teams that share tools, but we might choose or be required to use one tool over the other to work better as part of the team. <code class="docutils literal notranslate"><span class="pre">pandas</span></code> is essential for projects in which the whole team works within Python. SQL is readable and usable for people who do not use Python but still work with databases.</p>
<p>Fifth, and most importantly, the choice of SQL vs. <code class="docutils literal notranslate"><span class="pre">pandas</span></code> should be made based on how comfortable we feel with each tool. Both SQL and <code class="docutils literal notranslate"><span class="pre">pandas</span></code> can perform data manipulation correctly, and it will probably be the case that we can remember the code with one tool better than with the other. We should try as much as we can to do the work that comprises 80% of our time as data scientists more quickly.</p>
<p>For now, we need to practice both <code class="docutils literal notranslate"><span class="pre">pandas</span></code> and SQL and get comfortable with these tools, and we need to be flexible in the future as different situations will call for SQL or <code class="docutils literal notranslate"><span class="pre">pandas</span></code>.</p>
</section>
<section id="joining-dataframes">
<h2><a class="toc-backref" href="#id3" role="doc-backlink"><span class="section-number">9.2. </span>Joining Dataframes</a><a class="headerlink" href="#joining-dataframes" title="Permalink to this heading">#</a></h2>
<p>Joining dataframes is also called merging dataframes, and I will use the words “join” and “merge” interchangeably below. Every kind of merge that is possible in SQL is possible in <code class="docutils literal notranslate"><span class="pre">pandas</span></code>: inner, outer, left, right, natural, cross, and anti-joins. One important difference between joining in SQL and merging in <code class="docutils literal notranslate"><span class="pre">pandas</span></code> is that dataframes might not be as carefully curated as data tables in a relational database, and we should not assume that the join worked properly even if there is no error. Primary keys might not uniquely identify rows in general, and joins might turn into cross joins. Some of values of keys that should match might not match due to differences in coding and spelling. And if we attempt a natural join, the wrong columns might be automatically selected as the keys.</p>
<p>Too many discussions of merging data provide clean examples. Here I will show you how merging works when the data contain some common problems that may invalidate the merge. In the following discussion, we will discuss how to perform merges in <code class="docutils literal notranslate"><span class="pre">pandas</span></code>, and also how to check that the merge worked in the way we want to.</p>
<p>First, for the following examples, we load these packages:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
</div>
<section id="example-merging-data-on-u-s-state-election-results-income-economies-and-area">
<h3><a class="toc-backref" href="#id4" role="doc-backlink"><span class="section-number">9.2.1. </span>Example: Merging Data on U.S. State Election Results, Income, Economies, and Area</a><a class="headerlink" href="#example-merging-data-on-u-s-state-election-results-income-economies-and-area" title="Permalink to this heading">#</a></h3>
<p>The “state_elections.csv” file contains information about the result of presidential elections by state for every presidential election between 1964 and 2004. In this dataset, the primary keys are <code class="docutils literal notranslate"><span class="pre">State</span></code> and <code class="docutils literal notranslate"><span class="pre">year</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">elect</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://github.com/jkropko/DS-6001/raw/master/localdata/state_elections.csv&quot;</span><span class="p">)</span>
<span class="n">elect</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>State</th>
      <th>year</th>
      <th>demvote</th>
      <th>repvote</th>
      <th>wallacevote</th>
      <th>dempercent</th>
      <th>reppercent</th>
      <th>population</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Alabama</td>
      <td>1964</td>
      <td>210732</td>
      <td>479085</td>
      <td>0</td>
      <td>30.54897</td>
      <td>69.45103</td>
      <td>1919000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Alabama</td>
      <td>1968</td>
      <td>196579</td>
      <td>146923</td>
      <td>691425</td>
      <td>18.99448</td>
      <td>81.00552</td>
      <td>1993000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Alabama</td>
      <td>1972</td>
      <td>256923</td>
      <td>728701</td>
      <td>0</td>
      <td>26.06704</td>
      <td>73.93296</td>
      <td>3540080</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Alabama</td>
      <td>1976</td>
      <td>659170</td>
      <td>504070</td>
      <td>0</td>
      <td>56.66673</td>
      <td>43.33327</td>
      <td>3737204</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Alabama</td>
      <td>1980</td>
      <td>636730</td>
      <td>654192</td>
      <td>0</td>
      <td>49.32366</td>
      <td>50.67634</td>
      <td>3894025</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>“state_income.txt” contains varous summary statistics (percentiles and means, broken down separately for men, for women, and for the overall population) about personal incomes within each state. In this dataset, the primary keys are <code class="docutils literal notranslate"><span class="pre">stcode</span></code> (the post office’s two letter abbreviation for states) and <code class="docutils literal notranslate"><span class="pre">year</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">income</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://github.com/jkropko/DS-6001/raw/master/localdata/state_income.txt&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># tab separated (note the header in this file)</span>
<span class="n">income</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>stcode</th>
      <th>year</th>
      <th>income</th>
      <th>p10income</th>
      <th>p20income</th>
      <th>p30income</th>
      <th>p40income</th>
      <th>p50income</th>
      <th>p60income</th>
      <th>p70income</th>
      <th>...</th>
      <th>wom_p90income</th>
      <th>wom_meanincome</th>
      <th>wom_minincome</th>
      <th>wom_maxincome</th>
      <th>wom_sdincome</th>
      <th>wom_ineqincome</th>
      <th>wom_gini_income</th>
      <th>wom_n_income</th>
      <th>wom_nwgt_income</th>
      <th>medincome</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AL</td>
      <td>1964</td>
      <td>89.83488</td>
      <td>3269.85</td>
      <td>5731.07</td>
      <td>7988.87</td>
      <td>10318.3</td>
      <td>13189.1</td>
      <td>16007.3</td>
      <td>18744.4</td>
      <td>...</td>
      <td>24233.0</td>
      <td>11400.0</td>
      <td>58.13953</td>
      <td>72674.42</td>
      <td>1796.89</td>
      <td>29.53152</td>
      <td>0.473738</td>
      <td>175.0</td>
      <td>418494.1</td>
      <td>76.68081</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AL</td>
      <td>1968</td>
      <td>92.18238</td>
      <td>4469.95</td>
      <td>7455.28</td>
      <td>10050.30</td>
      <td>12792.1</td>
      <td>15580.2</td>
      <td>18392.4</td>
      <td>21310.7</td>
      <td>...</td>
      <td>26287.5</td>
      <td>12005.3</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1968.78</td>
      <td>27.40979</td>
      <td>0.485090</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>80.72643</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AL</td>
      <td>1972</td>
      <td>94.87543</td>
      <td>6734.11</td>
      <td>10314.80</td>
      <td>13336.30</td>
      <td>16421.5</td>
      <td>19088.9</td>
      <td>22141.6</td>
      <td>25410.7</td>
      <td>...</td>
      <td>30278.0</td>
      <td>14667.9</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>8604.25</td>
      <td>17.83577</td>
      <td>0.457932</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>82.27975</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AL</td>
      <td>1976</td>
      <td>67.53671</td>
      <td>7759.81</td>
      <td>11176.60</td>
      <td>13823.20</td>
      <td>16431.8</td>
      <td>18982.8</td>
      <td>21923.5</td>
      <td>25180.8</td>
      <td>...</td>
      <td>31119.2</td>
      <td>15362.5</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>12842.20</td>
      <td>15.77765</td>
      <td>0.454074</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>60.07215</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AL</td>
      <td>1980</td>
      <td>46.29869</td>
      <td>7602.15</td>
      <td>10637.00</td>
      <td>13532.60</td>
      <td>16279.6</td>
      <td>19111.8</td>
      <td>21802.5</td>
      <td>25190.6</td>
      <td>...</td>
      <td>29623.1</td>
      <td>14804.2</td>
      <td>28.38428</td>
      <td>120196.50</td>
      <td>5944.71</td>
      <td>14.52640</td>
      <td>0.436961</td>
      <td>543.0</td>
      <td>711278.2</td>
      <td>41.72882</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 55 columns</p>
</div></div></div>
</div>
<p>“state_economics.txt” contains information about the macro-level economy in each state and year, including overall and per capita gross domestic product, and GDP broken down by industry. In this dataset, the primary keys are <code class="docutils literal notranslate"><span class="pre">fips</span></code> (a standard numeric code that identifies countries and provinces within countries) and <code class="docutils literal notranslate"><span class="pre">year</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">econ</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://github.com/jkropko/DS-6001/raw/master/localdata/state_economics.txt&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">)</span> <span class="c1"># semi-colon separated</span>
<span class="n">econ</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fips</th>
      <th>year</th>
      <th>GDP</th>
      <th>GDPpc</th>
      <th>Private</th>
      <th>Agriculture</th>
      <th>Farms</th>
      <th>Mining</th>
      <th>Utilities</th>
      <th>Construction</th>
      <th>...</th>
      <th>Construction_share</th>
      <th>Manufacturing_share</th>
      <th>Finance_Insurance_share</th>
      <th>Legal_share</th>
      <th>Education_share</th>
      <th>Health_share</th>
      <th>Government_share</th>
      <th>Government_federal_share</th>
      <th>Government_military_share</th>
      <th>Government_statelocal_share</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1964</td>
      <td>8201</td>
      <td>4273.580</td>
      <td>6900</td>
      <td>312</td>
      <td>283</td>
      <td>115</td>
      <td>235</td>
      <td>379</td>
      <td>...</td>
      <td>4.621387</td>
      <td>28.22827</td>
      <td>11.41324</td>
      <td>0.402390</td>
      <td>0.256066</td>
      <td>1.902207</td>
      <td>15.86392</td>
      <td>6.291915</td>
      <td>2.402146</td>
      <td>7.182051</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>1968</td>
      <td>10949</td>
      <td>5493.728</td>
      <td>9095</td>
      <td>294</td>
      <td>253</td>
      <td>133</td>
      <td>294</td>
      <td>499</td>
      <td>...</td>
      <td>4.557494</td>
      <td>28.74235</td>
      <td>10.67677</td>
      <td>0.429263</td>
      <td>0.365330</td>
      <td>2.228514</td>
      <td>16.93305</td>
      <td>5.945748</td>
      <td>2.630377</td>
      <td>8.356928</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>1972</td>
      <td>15336</td>
      <td>4332.105</td>
      <td>12696</td>
      <td>481</td>
      <td>418</td>
      <td>223</td>
      <td>435</td>
      <td>702</td>
      <td>...</td>
      <td>4.577465</td>
      <td>26.05634</td>
      <td>11.48279</td>
      <td>0.469484</td>
      <td>0.443401</td>
      <td>2.595201</td>
      <td>17.21440</td>
      <td>5.692488</td>
      <td>2.679969</td>
      <td>8.841941</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>1976</td>
      <td>24206</td>
      <td>6477.035</td>
      <td>19988</td>
      <td>781</td>
      <td>683</td>
      <td>584</td>
      <td>714</td>
      <td>1281</td>
      <td>...</td>
      <td>5.292076</td>
      <td>24.85334</td>
      <td>11.50541</td>
      <td>0.479220</td>
      <td>0.359415</td>
      <td>2.986863</td>
      <td>17.42543</td>
      <td>5.787821</td>
      <td>2.255639</td>
      <td>9.386103</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>1980</td>
      <td>36006</td>
      <td>9246.474</td>
      <td>29567</td>
      <td>674</td>
      <td>542</td>
      <td>1351</td>
      <td>1228</td>
      <td>1588</td>
      <td>...</td>
      <td>4.410376</td>
      <td>24.60423</td>
      <td>11.63417</td>
      <td>0.649892</td>
      <td>0.352719</td>
      <td>3.660501</td>
      <td>17.88313</td>
      <td>5.782370</td>
      <td>2.171860</td>
      <td>9.928901</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 36 columns</p>
</div></div></div>
</div>
<p>“state_area.csv” contains various measures of the total, land, and water areas of each state. In this dataset, the primary key is <code class="docutils literal notranslate"><span class="pre">state</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">area</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://github.com/jkropko/DS-6001/raw/master/localdata/state_area.csv&quot;</span><span class="p">)</span> 
<span class="n">area</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>state</th>
      <th>area_sqmi</th>
      <th>area_sqkm</th>
      <th>landarea_sqmi</th>
      <th>landarea_sqkm</th>
      <th>water_sqmi</th>
      <th>water_sqkm</th>
      <th>percent_water</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Alaska</td>
      <td>663,267.26</td>
      <td>1,717,854</td>
      <td>571,951.26</td>
      <td>1,481,347</td>
      <td>91,316.00</td>
      <td>236,507</td>
      <td>13.77</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Texas</td>
      <td>268,580.82</td>
      <td>695,621</td>
      <td>261,797.12</td>
      <td>678,051</td>
      <td>6,783.70</td>
      <td>17,570</td>
      <td>2.53</td>
    </tr>
    <tr>
      <th>2</th>
      <td>California</td>
      <td>163,695.57</td>
      <td>423,970</td>
      <td>155,939.52</td>
      <td>403,882</td>
      <td>7,736.23</td>
      <td>20,037</td>
      <td>4.73</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Montana</td>
      <td>147,042.40</td>
      <td>380,838</td>
      <td>145,552.43</td>
      <td>376,979</td>
      <td>1,489.96</td>
      <td>3,859</td>
      <td>1.01</td>
    </tr>
    <tr>
      <th>4</th>
      <td>New Mexico</td>
      <td>121,589.48</td>
      <td>314,915</td>
      <td>121,355.53</td>
      <td>314,309</td>
      <td>233.96</td>
      <td>606</td>
      <td>0.19</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Because the datasets above contain three ways to identify states - by name, with two-letter abbreviations, and with FIPS codes - we also need a dataset that matches each state by name to its abbreviation and FIPS code. Datasets that exist solely for the purpose of matching values of keys across datasets are called <strong>crosswalks</strong>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">crosswalk</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://github.com/jkropko/DS-6001/raw/master/localdata/crosswalk.csv&quot;</span><span class="p">)</span>
<span class="n">crosswalk</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fips</th>
      <th>State</th>
      <th>stcode</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Alabama</td>
      <td>AL</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>Alaska</td>
      <td>AK</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4</td>
      <td>Arizona</td>
      <td>AZ</td>
    </tr>
    <tr>
      <th>3</th>
      <td>5</td>
      <td>Arkansas</td>
      <td>AR</td>
    </tr>
    <tr>
      <th>4</th>
      <td>6</td>
      <td>California</td>
      <td>CA</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Our goal is to merge all five of these datasets together.</p>
</section>
<section id="using-the-pd-merge-function">
<h3><a class="toc-backref" href="#id5" role="doc-backlink"><span class="section-number">9.2.2. </span>Using the <code class="docutils literal notranslate"><span class="pre">pd.merge()</span></code> Function</a><a class="headerlink" href="#using-the-pd-merge-function" title="Permalink to this heading">#</a></h3>
<p>When using a crosswalk to merge dataframes together, the first step is to merge a dataframe with the crosswalk. Here we start by joining the <code class="docutils literal notranslate"><span class="pre">elect</span></code> and <code class="docutils literal notranslate"><span class="pre">crosswalk</span></code> dataframes together. To join dataframes, we use the <code class="docutils literal notranslate"><span class="pre">pd.merge()</span></code> function. The following code works:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">elect</span><span class="p">,</span> <span class="n">crosswalk</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;State&#39;</span><span class="p">)</span>
<span class="n">merged_data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>State</th>
      <th>year</th>
      <th>demvote</th>
      <th>repvote</th>
      <th>wallacevote</th>
      <th>dempercent</th>
      <th>reppercent</th>
      <th>population</th>
      <th>fips</th>
      <th>stcode</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Alabama</td>
      <td>1964</td>
      <td>210732</td>
      <td>479085</td>
      <td>0</td>
      <td>30.54897</td>
      <td>69.45103</td>
      <td>1919000</td>
      <td>1</td>
      <td>AL</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Alabama</td>
      <td>1968</td>
      <td>196579</td>
      <td>146923</td>
      <td>691425</td>
      <td>18.99448</td>
      <td>81.00552</td>
      <td>1993000</td>
      <td>1</td>
      <td>AL</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Alabama</td>
      <td>1972</td>
      <td>256923</td>
      <td>728701</td>
      <td>0</td>
      <td>26.06704</td>
      <td>73.93296</td>
      <td>3540080</td>
      <td>1</td>
      <td>AL</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Alabama</td>
      <td>1976</td>
      <td>659170</td>
      <td>504070</td>
      <td>0</td>
      <td>56.66673</td>
      <td>43.33327</td>
      <td>3737204</td>
      <td>1</td>
      <td>AL</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Alabama</td>
      <td>1980</td>
      <td>636730</td>
      <td>654192</td>
      <td>0</td>
      <td>49.32366</td>
      <td>50.67634</td>
      <td>3894025</td>
      <td>1</td>
      <td>AL</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>556</th>
      <td>Wyoming</td>
      <td>1988</td>
      <td>67113</td>
      <td>106867</td>
      <td>0</td>
      <td>38.57512</td>
      <td>61.42488</td>
      <td>465080</td>
      <td>56</td>
      <td>WY</td>
    </tr>
    <tr>
      <th>557</th>
      <td>Wyoming</td>
      <td>1992</td>
      <td>68160</td>
      <td>79347</td>
      <td>0</td>
      <td>46.20798</td>
      <td>53.79202</td>
      <td>466251</td>
      <td>56</td>
      <td>WY</td>
    </tr>
    <tr>
      <th>558</th>
      <td>Wyoming</td>
      <td>1996</td>
      <td>77934</td>
      <td>105388</td>
      <td>0</td>
      <td>42.51208</td>
      <td>57.48792</td>
      <td>488167</td>
      <td>56</td>
      <td>WY</td>
    </tr>
    <tr>
      <th>559</th>
      <td>Wyoming</td>
      <td>2000</td>
      <td>60481</td>
      <td>147947</td>
      <td>0</td>
      <td>29.01769</td>
      <td>70.98231</td>
      <td>493782</td>
      <td>56</td>
      <td>WY</td>
    </tr>
    <tr>
      <th>560</th>
      <td>Wyoming</td>
      <td>2004</td>
      <td>70776</td>
      <td>167629</td>
      <td>0</td>
      <td>29.68730</td>
      <td>70.31271</td>
      <td>506529</td>
      <td>56</td>
      <td>WY</td>
    </tr>
  </tbody>
</table>
<p>561 rows × 10 columns</p>
</div></div></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">merged_data</span></code> dataframe now contains the features from <code class="docutils literal notranslate"><span class="pre">elect</span></code> and from <code class="docutils literal notranslate"><span class="pre">crosswalk</span></code>, which means we’ve added <code class="docutils literal notranslate"><span class="pre">stcode</span></code> and <code class="docutils literal notranslate"><span class="pre">fips</span></code> to the <code class="docutils literal notranslate"><span class="pre">elect</span></code> data, and that enables us to merge <code class="docutils literal notranslate"><span class="pre">merged_data</span></code> with <code class="docutils literal notranslate"><span class="pre">income</span></code> and <code class="docutils literal notranslate"><span class="pre">econ</span></code>.</p>
<p>Before moving on to the rest of the example, we should discuss some properties of the <code class="docutils literal notranslate"><span class="pre">pd.merge()</span></code> function. Recall from module 7 that there are many different kinds of joins that differ only in how they treat unmatched observations. <code class="docutils literal notranslate"><span class="pre">pd.merge()</span></code> conducts an inner join by default, leaving only the matched observations in the merged data. To change the type of merge, use the <code class="docutils literal notranslate"><span class="pre">how</span></code> argument:</p>
<p><code class="docutils literal notranslate"><span class="pre">how='outer'</span></code> performs an outer or full join. It brings all rows from both dataframes into the merged data, and replaces the features for the unmatched rows with <code class="docutils literal notranslate"><span class="pre">NaN</span></code> for the columns without data.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">merged_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">elect</span><span class="p">,</span> <span class="n">crosswalk</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;State&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">how='left'</span></code> performs a left join. It brings all rows from the first dataframe listed into the merged data, and only those in the second dataframe that are matched to the first.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">merged_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">elect</span><span class="p">,</span> <span class="n">crosswalk</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;State&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">how='right'</span></code> performs a right join. It brings all rows from the second dataframe listed into the merged data, and only those in the first dataframe that are matched to the second.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">merged_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">elect</span><span class="p">,</span> <span class="n">crosswalk</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;State&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>There are two ways to specify the key or keys on which to match rows. If the key or keys have the same name in both dataframes, use the <code class="docutils literal notranslate"><span class="pre">on</span></code> argument. If there is one key, pass this name as a string to <code class="docutils literal notranslate"><span class="pre">on</span></code> like we did above. If there is more than one key, pass these names as a list to <code class="docutils literal notranslate"><span class="pre">on</span></code>. For example, if we merge on both <code class="docutils literal notranslate"><span class="pre">State</span></code> and <code class="docutils literal notranslate"><span class="pre">year</span></code>, we will type <code class="docutils literal notranslate"><span class="pre">on</span> <span class="pre">=</span> <span class="pre">['State',</span> <span class="pre">'year']</span></code>.</p>
<p>If the keys have different names in each dataframe, we use <code class="docutils literal notranslate"><span class="pre">left_on</span></code> to specify the names of these keys in the first dataframe listed in the <code class="docutils literal notranslate"><span class="pre">pd.merge()</span></code> function, and <code class="docutils literal notranslate"><span class="pre">right_on</span></code> to specify the names of these keys in the second dataframe listed. Suppose, for example, that the keys are named “State” and “year” in the first dataframe, and “st” and “yr” in the second dataframe. We would type <code class="docutils literal notranslate"><span class="pre">left_on</span> <span class="pre">=</span> <span class="pre">['State',</span> <span class="pre">'year'],</span> <span class="pre">right_on</span> <span class="pre">=</span> <span class="pre">['st',</span> <span class="pre">'yr']</span></code>.</p>
<p>Depending on the type of join we use, a row can be matched, or can come from just the first or just the second dataframe listed in <code class="docutils literal notranslate"><span class="pre">pd.merge()</span></code>. To see which rows come from which sources, specify <code class="docutils literal notranslate"><span class="pre">indicator='newname'</span></code>, where <code class="docutils literal notranslate"><span class="pre">'newname'</span></code> is a name you choose for a new column that contains this information. For example, the following code repeats the merge we performed above, but uses an outer join instead of an inner join and adds a column <code class="docutils literal notranslate"><span class="pre">matched</span></code> that tells us how each row is matched:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">elect</span><span class="p">,</span> <span class="n">crosswalk</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;State&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">,</span> <span class="n">indicator</span><span class="o">=</span><span class="s1">&#39;matched&#39;</span><span class="p">)</span>
<span class="n">merged_data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>State</th>
      <th>year</th>
      <th>demvote</th>
      <th>repvote</th>
      <th>wallacevote</th>
      <th>dempercent</th>
      <th>reppercent</th>
      <th>population</th>
      <th>fips</th>
      <th>stcode</th>
      <th>matched</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Alabama</td>
      <td>1964</td>
      <td>210732</td>
      <td>479085</td>
      <td>0</td>
      <td>30.54897</td>
      <td>69.45103</td>
      <td>1919000</td>
      <td>1</td>
      <td>AL</td>
      <td>both</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Alabama</td>
      <td>1968</td>
      <td>196579</td>
      <td>146923</td>
      <td>691425</td>
      <td>18.99448</td>
      <td>81.00552</td>
      <td>1993000</td>
      <td>1</td>
      <td>AL</td>
      <td>both</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Alabama</td>
      <td>1972</td>
      <td>256923</td>
      <td>728701</td>
      <td>0</td>
      <td>26.06704</td>
      <td>73.93296</td>
      <td>3540080</td>
      <td>1</td>
      <td>AL</td>
      <td>both</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Alabama</td>
      <td>1976</td>
      <td>659170</td>
      <td>504070</td>
      <td>0</td>
      <td>56.66673</td>
      <td>43.33327</td>
      <td>3737204</td>
      <td>1</td>
      <td>AL</td>
      <td>both</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Alabama</td>
      <td>1980</td>
      <td>636730</td>
      <td>654192</td>
      <td>0</td>
      <td>49.32366</td>
      <td>50.67634</td>
      <td>3894025</td>
      <td>1</td>
      <td>AL</td>
      <td>both</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>556</th>
      <td>Wyoming</td>
      <td>1988</td>
      <td>67113</td>
      <td>106867</td>
      <td>0</td>
      <td>38.57512</td>
      <td>61.42488</td>
      <td>465080</td>
      <td>56</td>
      <td>WY</td>
      <td>both</td>
    </tr>
    <tr>
      <th>557</th>
      <td>Wyoming</td>
      <td>1992</td>
      <td>68160</td>
      <td>79347</td>
      <td>0</td>
      <td>46.20798</td>
      <td>53.79202</td>
      <td>466251</td>
      <td>56</td>
      <td>WY</td>
      <td>both</td>
    </tr>
    <tr>
      <th>558</th>
      <td>Wyoming</td>
      <td>1996</td>
      <td>77934</td>
      <td>105388</td>
      <td>0</td>
      <td>42.51208</td>
      <td>57.48792</td>
      <td>488167</td>
      <td>56</td>
      <td>WY</td>
      <td>both</td>
    </tr>
    <tr>
      <th>559</th>
      <td>Wyoming</td>
      <td>2000</td>
      <td>60481</td>
      <td>147947</td>
      <td>0</td>
      <td>29.01769</td>
      <td>70.98231</td>
      <td>493782</td>
      <td>56</td>
      <td>WY</td>
      <td>both</td>
    </tr>
    <tr>
      <th>560</th>
      <td>Wyoming</td>
      <td>2004</td>
      <td>70776</td>
      <td>167629</td>
      <td>0</td>
      <td>29.68730</td>
      <td>70.31271</td>
      <td>506529</td>
      <td>56</td>
      <td>WY</td>
      <td>both</td>
    </tr>
  </tbody>
</table>
<p>561 rows × 11 columns</p>
</div></div></div>
</div>
</section>
<section id="checking-for-problems-that-can-occur-without-errors">
<h3><a class="toc-backref" href="#id6" role="doc-backlink"><span class="section-number">9.2.3. </span>Checking for Problems That Can Occur Without Errors</a><a class="headerlink" href="#checking-for-problems-that-can-occur-without-errors" title="Permalink to this heading">#</a></h3>
<p>Whenever we apply <code class="docutils literal notranslate"><span class="pre">pd.merge()</span></code>, there’s a great risk that the merge was incorrect even if the function runs without error. There are two ways that a merge can fail.</p>
<p><strong>Problem 1:</strong> what we <em>thought</em> was a unique ID was not a unique ID.</p>
<p>If we merge two dataframes on a column (or set of columns) that fail to uniquely identify the rows in either dataframe, then <code class="docutils literal notranslate"><span class="pre">pd.merge()</span></code> returns all pairwise combinations of rows with matching IDs. To see this, consider the following two example dataframes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dict1</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">],</span>
         <span class="s1">&#39;data1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">150</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">25</span><span class="p">]}</span>
<span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">dict1</span><span class="p">)</span>
<span class="n">df1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>data1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A</td>
      <td>150</td>
    </tr>
    <tr>
      <th>1</th>
      <td>A</td>
      <td>200</td>
    </tr>
    <tr>
      <th>2</th>
      <td>B</td>
      <td>50</td>
    </tr>
    <tr>
      <th>3</th>
      <td>B</td>
      <td>25</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dict2</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">],</span>
         <span class="s1">&#39;data2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="o">-</span><span class="mi">75</span><span class="p">,</span> <span class="o">-</span><span class="mi">125</span><span class="p">,</span> <span class="o">-</span><span class="mi">250</span><span class="p">]}</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">dict2</span><span class="p">)</span>
<span class="n">df2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>data2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A</td>
      <td>-20</td>
    </tr>
    <tr>
      <th>1</th>
      <td>A</td>
      <td>-75</td>
    </tr>
    <tr>
      <th>2</th>
      <td>B</td>
      <td>-125</td>
    </tr>
    <tr>
      <th>3</th>
      <td>B</td>
      <td>-250</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Note that the two dataframes share a column “id”, but that “id” is not a unique identifier in either dataframe. If I try to merge the two based on “id”, the result is:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_merge</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
<span class="n">df_merge</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>data1</th>
      <th>data2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A</td>
      <td>150</td>
      <td>-20</td>
    </tr>
    <tr>
      <th>1</th>
      <td>A</td>
      <td>150</td>
      <td>-75</td>
    </tr>
    <tr>
      <th>2</th>
      <td>A</td>
      <td>200</td>
      <td>-20</td>
    </tr>
    <tr>
      <th>3</th>
      <td>A</td>
      <td>200</td>
      <td>-75</td>
    </tr>
    <tr>
      <th>4</th>
      <td>B</td>
      <td>50</td>
      <td>-125</td>
    </tr>
    <tr>
      <th>5</th>
      <td>B</td>
      <td>50</td>
      <td>-250</td>
    </tr>
    <tr>
      <th>6</th>
      <td>B</td>
      <td>25</td>
      <td>-125</td>
    </tr>
    <tr>
      <th>7</th>
      <td>B</td>
      <td>25</td>
      <td>-250</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Because we did not have a unique ID in either dataframe, we artificially increased the number of rows from 4 to 8. At first glance, the merged data looks nice, but with double the number of rows we are supposed to have the data is in fact corrupted, and we cannot use it for any subsequent analysis. Also, note that the merge ran without any errors. If we aren’t careful, we might move forward with data that cannot be used.</p>
<p>The above example is an instance of a <strong>many-to-many</strong> merge, in which rows in the left dataframe can match to more than one row in the right dataframe, and rows in the right dataframe can match to more than one row in the left dataframe. In these cases <code class="docutils literal notranslate"><span class="pre">pandas</span></code> performs a cross join within the subsets of the two dataframes that share the same key, inflating the number of rows. But a many-to-many join is almost never what we want to do with data, and if it happens, it is usually a mistake.</p>
<p>The other types of merges are</p>
<ul class="simple">
<li><p><strong>one-to-one</strong>, in which every row in the left dataframe matches to at most one row in the right dataframe, and every row in the right dataframe matches to at most one row in the left dataframe,</p></li>
<li><p><strong>many-to-one</strong>, in which rows in the left dataframe can match to more than one row in the right dataframe, and every row in the right dataframe mnatches to at most one row in the left dataframe,</p></li>
<li><p>and <strong>one-to-many</strong>, in which every row in the left dataframe matches to at most one row in the right dataframe, and rows in the right dataframe can match to more than one row in the left dataframe.</p></li>
</ul>
<p>The best way to prevent this mistake is to first think about whether the two dataframes should constitute a one-to-one, many-to-one, or one-to-many merge. It is important to have a clear expectation. Then use the <code class="docutils literal notranslate"><span class="pre">validate</span></code> argument to have <code class="docutils literal notranslate"><span class="pre">pandas</span></code> automatically check to see whether this expectation is met. If not, the code will generate an error, which will bring our attention to problems in the data we might not have caught otherwise. If we write</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">validate</span> <span class="pre">=</span> <span class="pre">'one_to_one'</span></code> then <code class="docutils literal notranslate"><span class="pre">pandas</span></code> checks to see whether the merge keys are unique in both dataframes,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">validate</span> <span class="pre">=</span> <span class="pre">'many_to_one'</span></code> then <code class="docutils literal notranslate"><span class="pre">pandas</span></code> checks to see whether the merge keys are unique in the right dataframe,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">validate</span> <span class="pre">=</span> <span class="pre">'one_to_many'</span></code> then <code class="docutils literal notranslate"><span class="pre">pandas</span></code> checks to see whether the merge keys are unique in the left dataframe.</p></li>
</ul>
<p>There are many reasons why our expectations might be incorrect. In messy, real-world data, mistakes like duplicated keys often make it past review processes and exist in the data without any clue of it in the codebook. The <code class="docutils literal notranslate"><span class="pre">validate</span></code> argument is an important check for these kinds of issues. For example, we expect that merging <code class="docutils literal notranslate"><span class="pre">elect</span></code> and <code class="docutils literal notranslate"><span class="pre">crosswalk</span></code> will be a many-to-one merge, so we confirm that the merge is many-to-one as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">elect</span><span class="p">,</span> <span class="n">crosswalk</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;State&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">,</span> 
                       <span class="n">indicator</span><span class="o">=</span><span class="s1">&#39;matched&#39;</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="s1">&#39;many_to_one&#39;</span><span class="p">)</span>
<span class="n">merged_data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>State</th>
      <th>year</th>
      <th>demvote</th>
      <th>repvote</th>
      <th>wallacevote</th>
      <th>dempercent</th>
      <th>reppercent</th>
      <th>population</th>
      <th>fips</th>
      <th>stcode</th>
      <th>matched</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Alabama</td>
      <td>1964</td>
      <td>210732</td>
      <td>479085</td>
      <td>0</td>
      <td>30.54897</td>
      <td>69.45103</td>
      <td>1919000</td>
      <td>1</td>
      <td>AL</td>
      <td>both</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Alabama</td>
      <td>1968</td>
      <td>196579</td>
      <td>146923</td>
      <td>691425</td>
      <td>18.99448</td>
      <td>81.00552</td>
      <td>1993000</td>
      <td>1</td>
      <td>AL</td>
      <td>both</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Alabama</td>
      <td>1972</td>
      <td>256923</td>
      <td>728701</td>
      <td>0</td>
      <td>26.06704</td>
      <td>73.93296</td>
      <td>3540080</td>
      <td>1</td>
      <td>AL</td>
      <td>both</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Alabama</td>
      <td>1976</td>
      <td>659170</td>
      <td>504070</td>
      <td>0</td>
      <td>56.66673</td>
      <td>43.33327</td>
      <td>3737204</td>
      <td>1</td>
      <td>AL</td>
      <td>both</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Alabama</td>
      <td>1980</td>
      <td>636730</td>
      <td>654192</td>
      <td>0</td>
      <td>49.32366</td>
      <td>50.67634</td>
      <td>3894025</td>
      <td>1</td>
      <td>AL</td>
      <td>both</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>556</th>
      <td>Wyoming</td>
      <td>1988</td>
      <td>67113</td>
      <td>106867</td>
      <td>0</td>
      <td>38.57512</td>
      <td>61.42488</td>
      <td>465080</td>
      <td>56</td>
      <td>WY</td>
      <td>both</td>
    </tr>
    <tr>
      <th>557</th>
      <td>Wyoming</td>
      <td>1992</td>
      <td>68160</td>
      <td>79347</td>
      <td>0</td>
      <td>46.20798</td>
      <td>53.79202</td>
      <td>466251</td>
      <td>56</td>
      <td>WY</td>
      <td>both</td>
    </tr>
    <tr>
      <th>558</th>
      <td>Wyoming</td>
      <td>1996</td>
      <td>77934</td>
      <td>105388</td>
      <td>0</td>
      <td>42.51208</td>
      <td>57.48792</td>
      <td>488167</td>
      <td>56</td>
      <td>WY</td>
      <td>both</td>
    </tr>
    <tr>
      <th>559</th>
      <td>Wyoming</td>
      <td>2000</td>
      <td>60481</td>
      <td>147947</td>
      <td>0</td>
      <td>29.01769</td>
      <td>70.98231</td>
      <td>493782</td>
      <td>56</td>
      <td>WY</td>
      <td>both</td>
    </tr>
    <tr>
      <th>560</th>
      <td>Wyoming</td>
      <td>2004</td>
      <td>70776</td>
      <td>167629</td>
      <td>0</td>
      <td>29.68730</td>
      <td>70.31271</td>
      <td>506529</td>
      <td>56</td>
      <td>WY</td>
      <td>both</td>
    </tr>
  </tbody>
</table>
<p>561 rows × 11 columns</p>
</div></div></div>
</div>
<p><strong>Problem 2</strong>: rows should be matched, but aren’t.</p>
<p>This problem is especially common when matching on strings, such as names. With countries, it’s possible for one dataframe to write “USA” and the other to write “United States”. You will have to go back into a dataframe to edit individual ID cells so that they match. But to identify the cells that need to be edited, we have to construct a dataframe of the rows that were unmatched in one or the other dataframe. The easiest way to see this is to use an anti-join: a merge that keeps only the rows in the left dataframe that have no match in the right dataframe. Like SQL, there is no anti-join function built in to <code class="docutils literal notranslate"><span class="pre">pandas</span></code>, but there are ways to program our own anti-join. The easiest way is to perform an outer join with the <code class="docutils literal notranslate"><span class="pre">indicator='matched'</span></code> argument, then to filter the data to those rows for which <code class="docutils literal notranslate"><span class="pre">matched</span></code> is not equal to “both”.</p>
<p>For this step, I recommend creating a second, working version of the data <code class="docutils literal notranslate"><span class="pre">merge_test</span></code> to contain the first attempt at the merge. If there are issues, it is easier to fix the problems and recreate the working dataframe than to restart the kernel. If there are no problems, then we can assign the <code class="docutils literal notranslate"><span class="pre">merged_data</span></code> dataframe to be equal to the working version.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merge_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">elect</span><span class="p">,</span> <span class="n">crosswalk</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;State&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">,</span> <span class="n">indicator</span><span class="o">=</span><span class="s1">&#39;matched&#39;</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="s1">&#39;many_to_one&#39;</span><span class="p">)</span>
<span class="n">merge_test</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;matched!=&#39;both&#39;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>State</th>
      <th>year</th>
      <th>demvote</th>
      <th>repvote</th>
      <th>wallacevote</th>
      <th>dempercent</th>
      <th>reppercent</th>
      <th>population</th>
      <th>fips</th>
      <th>stcode</th>
      <th>matched</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
</div></div></div>
</div>
<p>There are no rows in <code class="docutils literal notranslate"><span class="pre">crosswalk</span></code> with no match to <code class="docutils literal notranslate"><span class="pre">elect</span></code>, and there are no rows in <code class="docutils literal notranslate"><span class="pre">elect</span></code> without a match in <code class="docutils literal notranslate"><span class="pre">crosswalk</span></code>. But if there were unmatched rows, there are two reasons why some rows may have been unmatched: rows can be unmatched due to differences in coverage, and they might be unmatched due to differences in coding or spelling. <code class="docutils literal notranslate"><span class="pre">pandas</span></code> cannot tell the difference between these two reasons why rows might be unmatched, and an inner join will drop unmatched rows regardless of the reason. Using an outer join with <code class="docutils literal notranslate"><span class="pre">indicator='matched'</span></code> is best practice for seeing the unmatched rows and thinking about whether any rows that should be matched are for some reason unmatched. We can use the category relabeling functionality in <code class="docutils literal notranslate"><span class="pre">pandas</span></code> to fix issues of mispelled and miscoded keys, as we will do in the examples in the next section.</p>
<p>After performing this check, if we intend to perform another merge, we will either need to choose a new name for the indicator column, or we can drop the <code class="docutils literal notranslate"><span class="pre">matched</span></code> column so that we can reuse this name later. We set <code class="docutils literal notranslate"><span class="pre">merged_data</span></code> to the working dataframe <code class="docutils literal notranslate"><span class="pre">merge_test</span></code> without the <code class="docutils literal notranslate"><span class="pre">matched</span></code> column:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged_data</span> <span class="o">=</span> <span class="n">merge_test</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;matched&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="merging-all-of-the-dataframes-together-while-checking-for-problems">
<h3><a class="toc-backref" href="#id7" role="doc-backlink"><span class="section-number">9.2.4. </span>Merging all of the Dataframes Together While Checking for Problems</a><a class="headerlink" href="#merging-all-of-the-dataframes-together-while-checking-for-problems" title="Permalink to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">merged_data</span></code> and <code class="docutils literal notranslate"><span class="pre">income</span></code> dataframes share keys named <code class="docutils literal notranslate"><span class="pre">stcode</span></code> and <code class="docutils literal notranslate"><span class="pre">year</span></code>. Joining these two dataframes should be a one-to-one merge because there should be only one occurrence of the same state and year in each dataframe. We use <code class="docutils literal notranslate"><span class="pre">how='outer'</span></code> and <code class="docutils literal notranslate"><span class="pre">indicator='matched'</span></code> (since we deleted the previous <code class="docutils literal notranslate"><span class="pre">matched</span></code> column) to enable us to filter the result to the unmatched rows, and we use <code class="docutils literal notranslate"><span class="pre">validate='one_to_one'</span></code> to catch anomolies that violate our expectation that this is a one-to-one merge:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merge_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">merged_data</span><span class="p">,</span> <span class="n">income</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;stcode&#39;</span><span class="p">,</span><span class="s1">&#39;year&#39;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">,</span> <span class="n">indicator</span><span class="o">=</span><span class="s1">&#39;matched&#39;</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="s1">&#39;one_to_one&#39;</span><span class="p">)</span>
<span class="n">merge_test</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;matched!=&#39;both&#39;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>State</th>
      <th>year</th>
      <th>demvote</th>
      <th>repvote</th>
      <th>wallacevote</th>
      <th>dempercent</th>
      <th>reppercent</th>
      <th>population</th>
      <th>fips</th>
      <th>stcode</th>
      <th>...</th>
      <th>wom_meanincome</th>
      <th>wom_minincome</th>
      <th>wom_maxincome</th>
      <th>wom_sdincome</th>
      <th>wom_ineqincome</th>
      <th>wom_gini_income</th>
      <th>wom_n_income</th>
      <th>wom_nwgt_income</th>
      <th>medincome</th>
      <th>matched</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
<p>0 rows × 64 columns</p>
</div></div></div>
</div>
<p>There are no unmatched rows so there are no issues with miscoded or mispelled ID values. The merged data now contain information on both state election results and state incomes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merge_test</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>State</th>
      <th>year</th>
      <th>demvote</th>
      <th>repvote</th>
      <th>wallacevote</th>
      <th>dempercent</th>
      <th>reppercent</th>
      <th>population</th>
      <th>fips</th>
      <th>stcode</th>
      <th>...</th>
      <th>wom_meanincome</th>
      <th>wom_minincome</th>
      <th>wom_maxincome</th>
      <th>wom_sdincome</th>
      <th>wom_ineqincome</th>
      <th>wom_gini_income</th>
      <th>wom_n_income</th>
      <th>wom_nwgt_income</th>
      <th>medincome</th>
      <th>matched</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Alabama</td>
      <td>1964</td>
      <td>210732</td>
      <td>479085</td>
      <td>0</td>
      <td>30.54897</td>
      <td>69.45103</td>
      <td>1919000</td>
      <td>1</td>
      <td>AL</td>
      <td>...</td>
      <td>11400.0</td>
      <td>58.139530</td>
      <td>72674.42</td>
      <td>1796.89</td>
      <td>29.53152</td>
      <td>0.473738</td>
      <td>175.0</td>
      <td>418494.1</td>
      <td>76.68081</td>
      <td>both</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Alabama</td>
      <td>1968</td>
      <td>196579</td>
      <td>146923</td>
      <td>691425</td>
      <td>18.99448</td>
      <td>81.00552</td>
      <td>1993000</td>
      <td>1</td>
      <td>AL</td>
      <td>...</td>
      <td>12005.3</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1968.78</td>
      <td>27.40979</td>
      <td>0.485090</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>80.72643</td>
      <td>both</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Alabama</td>
      <td>1972</td>
      <td>256923</td>
      <td>728701</td>
      <td>0</td>
      <td>26.06704</td>
      <td>73.93296</td>
      <td>3540080</td>
      <td>1</td>
      <td>AL</td>
      <td>...</td>
      <td>14667.9</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>8604.25</td>
      <td>17.83577</td>
      <td>0.457932</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>82.27975</td>
      <td>both</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Alabama</td>
      <td>1976</td>
      <td>659170</td>
      <td>504070</td>
      <td>0</td>
      <td>56.66673</td>
      <td>43.33327</td>
      <td>3737204</td>
      <td>1</td>
      <td>AL</td>
      <td>...</td>
      <td>15362.5</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>12842.20</td>
      <td>15.77765</td>
      <td>0.454074</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>60.07215</td>
      <td>both</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Alabama</td>
      <td>1980</td>
      <td>636730</td>
      <td>654192</td>
      <td>0</td>
      <td>49.32366</td>
      <td>50.67634</td>
      <td>3894025</td>
      <td>1</td>
      <td>AL</td>
      <td>...</td>
      <td>14804.2</td>
      <td>28.384280</td>
      <td>120196.50</td>
      <td>5944.71</td>
      <td>14.52640</td>
      <td>0.436961</td>
      <td>543.0</td>
      <td>711278.2</td>
      <td>41.72882</td>
      <td>both</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>556</th>
      <td>Wyoming</td>
      <td>1988</td>
      <td>67113</td>
      <td>106867</td>
      <td>0</td>
      <td>38.57512</td>
      <td>61.42488</td>
      <td>465080</td>
      <td>56</td>
      <td>WY</td>
      <td>...</td>
      <td>17188.0</td>
      <td>75.987840</td>
      <td>77507.60</td>
      <td>10402.40</td>
      <td>23.54822</td>
      <td>0.478940</td>
      <td>318.0</td>
      <td>110956.1</td>
      <td>36.63389</td>
      <td>both</td>
    </tr>
    <tr>
      <th>557</th>
      <td>Wyoming</td>
      <td>1992</td>
      <td>68160</td>
      <td>79347</td>
      <td>0</td>
      <td>46.20798</td>
      <td>53.79202</td>
      <td>466251</td>
      <td>56</td>
      <td>WY</td>
      <td>...</td>
      <td>17934.1</td>
      <td>92.307700</td>
      <td>96391.03</td>
      <td>12512.80</td>
      <td>21.14388</td>
      <td>0.469024</td>
      <td>360.0</td>
      <td>117688.6</td>
      <td>30.10564</td>
      <td>both</td>
    </tr>
    <tr>
      <th>558</th>
      <td>Wyoming</td>
      <td>1996</td>
      <td>77934</td>
      <td>105388</td>
      <td>0</td>
      <td>42.51208</td>
      <td>57.48792</td>
      <td>488167</td>
      <td>56</td>
      <td>WY</td>
      <td>...</td>
      <td>18796.4</td>
      <td>29.816510</td>
      <td>122420.90</td>
      <td>14517.60</td>
      <td>22.74368</td>
      <td>0.461693</td>
      <td>413.0</td>
      <td>125222.3</td>
      <td>26.93395</td>
      <td>both</td>
    </tr>
    <tr>
      <th>559</th>
      <td>Wyoming</td>
      <td>2000</td>
      <td>60481</td>
      <td>147947</td>
      <td>0</td>
      <td>29.01769</td>
      <td>70.98231</td>
      <td>493782</td>
      <td>56</td>
      <td>WY</td>
      <td>...</td>
      <td>20463.4</td>
      <td>88.819230</td>
      <td>333171.40</td>
      <td>16609.80</td>
      <td>15.30497</td>
      <td>0.447124</td>
      <td>440.0</td>
      <td>128753.9</td>
      <td>26.05026</td>
      <td>both</td>
    </tr>
    <tr>
      <th>560</th>
      <td>Wyoming</td>
      <td>2004</td>
      <td>70776</td>
      <td>167629</td>
      <td>0</td>
      <td>29.68730</td>
      <td>70.31271</td>
      <td>506529</td>
      <td>56</td>
      <td>WY</td>
      <td>...</td>
      <td>20225.1</td>
      <td>9.587728</td>
      <td>206166.80</td>
      <td>18311.90</td>
      <td>11.33138</td>
      <td>0.432011</td>
      <td>692.0</td>
      <td>123164.1</td>
      <td>24.74094</td>
      <td>both</td>
    </tr>
  </tbody>
</table>
<p>561 rows × 64 columns</p>
</div></div></div>
</div>
<p>Since there are no problems, we set <code class="docutils literal notranslate"><span class="pre">merged_data</span></code> equal to <code class="docutils literal notranslate"><span class="pre">merge_test</span></code>. Because we intend to merge the data with another dataframe, we drop the <code class="docutils literal notranslate"><span class="pre">matched</span></code> column.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged_data</span> <span class="o">=</span> <span class="n">merge_test</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;matched&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Next we merge this result with the <code class="docutils literal notranslate"><span class="pre">econ</span></code> dataframe. These two dataframes share <code class="docutils literal notranslate"><span class="pre">fips</span></code> and <code class="docutils literal notranslate"><span class="pre">year</span></code> as keys, and should also be a one-to-one merge. We check to see whether there are unmatched rows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merge_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">merged_data</span><span class="p">,</span> <span class="n">econ</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;fips&#39;</span><span class="p">,</span><span class="s1">&#39;year&#39;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">,</span> <span class="n">indicator</span><span class="o">=</span><span class="s1">&#39;matched&#39;</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="s1">&#39;one_to_one&#39;</span><span class="p">)</span>
<span class="n">merge_test</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;matched!=&#39;both&#39;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>State</th>
      <th>year</th>
      <th>demvote</th>
      <th>repvote</th>
      <th>wallacevote</th>
      <th>dempercent</th>
      <th>reppercent</th>
      <th>population</th>
      <th>fips</th>
      <th>stcode</th>
      <th>...</th>
      <th>Manufacturing_share</th>
      <th>Finance_Insurance_share</th>
      <th>Legal_share</th>
      <th>Education_share</th>
      <th>Health_share</th>
      <th>Government_share</th>
      <th>Government_federal_share</th>
      <th>Government_military_share</th>
      <th>Government_statelocal_share</th>
      <th>matched</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
<p>0 rows × 98 columns</p>
</div></div></div>
</div>
<p>Again, there are no unmatched rows so there are no issues with miscoded or mispelled ID values. The merged data now contain information on state election results, state incomes, and state economies:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merge_test</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>State</th>
      <th>year</th>
      <th>demvote</th>
      <th>repvote</th>
      <th>wallacevote</th>
      <th>dempercent</th>
      <th>reppercent</th>
      <th>population</th>
      <th>fips</th>
      <th>stcode</th>
      <th>...</th>
      <th>Manufacturing_share</th>
      <th>Finance_Insurance_share</th>
      <th>Legal_share</th>
      <th>Education_share</th>
      <th>Health_share</th>
      <th>Government_share</th>
      <th>Government_federal_share</th>
      <th>Government_military_share</th>
      <th>Government_statelocal_share</th>
      <th>matched</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Alabama</td>
      <td>1964</td>
      <td>210732</td>
      <td>479085</td>
      <td>0</td>
      <td>30.54897</td>
      <td>69.45103</td>
      <td>1919000</td>
      <td>1</td>
      <td>AL</td>
      <td>...</td>
      <td>28.228270</td>
      <td>11.413240</td>
      <td>0.402390</td>
      <td>0.256066</td>
      <td>1.902207</td>
      <td>15.86392</td>
      <td>6.291915</td>
      <td>2.402146</td>
      <td>7.182051</td>
      <td>both</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Alabama</td>
      <td>1968</td>
      <td>196579</td>
      <td>146923</td>
      <td>691425</td>
      <td>18.99448</td>
      <td>81.00552</td>
      <td>1993000</td>
      <td>1</td>
      <td>AL</td>
      <td>...</td>
      <td>28.742350</td>
      <td>10.676770</td>
      <td>0.429263</td>
      <td>0.365330</td>
      <td>2.228514</td>
      <td>16.93305</td>
      <td>5.945748</td>
      <td>2.630377</td>
      <td>8.356928</td>
      <td>both</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Alabama</td>
      <td>1972</td>
      <td>256923</td>
      <td>728701</td>
      <td>0</td>
      <td>26.06704</td>
      <td>73.93296</td>
      <td>3540080</td>
      <td>1</td>
      <td>AL</td>
      <td>...</td>
      <td>26.056340</td>
      <td>11.482790</td>
      <td>0.469484</td>
      <td>0.443401</td>
      <td>2.595201</td>
      <td>17.21440</td>
      <td>5.692488</td>
      <td>2.679969</td>
      <td>8.841941</td>
      <td>both</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Alabama</td>
      <td>1976</td>
      <td>659170</td>
      <td>504070</td>
      <td>0</td>
      <td>56.66673</td>
      <td>43.33327</td>
      <td>3737204</td>
      <td>1</td>
      <td>AL</td>
      <td>...</td>
      <td>24.853340</td>
      <td>11.505410</td>
      <td>0.479220</td>
      <td>0.359415</td>
      <td>2.986863</td>
      <td>17.42543</td>
      <td>5.787821</td>
      <td>2.255639</td>
      <td>9.386103</td>
      <td>both</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Alabama</td>
      <td>1980</td>
      <td>636730</td>
      <td>654192</td>
      <td>0</td>
      <td>49.32366</td>
      <td>50.67634</td>
      <td>3894025</td>
      <td>1</td>
      <td>AL</td>
      <td>...</td>
      <td>24.604230</td>
      <td>11.634170</td>
      <td>0.649892</td>
      <td>0.352719</td>
      <td>3.660501</td>
      <td>17.88313</td>
      <td>5.782370</td>
      <td>2.171860</td>
      <td>9.928901</td>
      <td>both</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>556</th>
      <td>Wyoming</td>
      <td>1988</td>
      <td>67113</td>
      <td>106867</td>
      <td>0</td>
      <td>38.57512</td>
      <td>61.42488</td>
      <td>465080</td>
      <td>56</td>
      <td>WY</td>
      <td>...</td>
      <td>4.380078</td>
      <td>7.788767</td>
      <td>0.688802</td>
      <td>0.123631</td>
      <td>2.207700</td>
      <td>14.51784</td>
      <td>2.622748</td>
      <td>1.660191</td>
      <td>10.234900</td>
      <td>both</td>
    </tr>
    <tr>
      <th>557</th>
      <td>Wyoming</td>
      <td>1992</td>
      <td>68160</td>
      <td>79347</td>
      <td>0</td>
      <td>46.20798</td>
      <td>53.79202</td>
      <td>466251</td>
      <td>56</td>
      <td>WY</td>
      <td>...</td>
      <td>4.303816</td>
      <td>7.670391</td>
      <td>0.704806</td>
      <td>0.179951</td>
      <td>2.579291</td>
      <td>14.99588</td>
      <td>2.811727</td>
      <td>1.552073</td>
      <td>10.632080</td>
      <td>both</td>
    </tr>
    <tr>
      <th>558</th>
      <td>Wyoming</td>
      <td>1996</td>
      <td>77934</td>
      <td>105388</td>
      <td>0</td>
      <td>42.51208</td>
      <td>57.48792</td>
      <td>488167</td>
      <td>56</td>
      <td>WY</td>
      <td>...</td>
      <td>6.146708</td>
      <td>9.280448</td>
      <td>0.705568</td>
      <td>0.152555</td>
      <td>2.866768</td>
      <td>14.23849</td>
      <td>2.657005</td>
      <td>1.544622</td>
      <td>10.030510</td>
      <td>both</td>
    </tr>
    <tr>
      <th>559</th>
      <td>Wyoming</td>
      <td>2000</td>
      <td>60481</td>
      <td>147947</td>
      <td>0</td>
      <td>29.01769</td>
      <td>70.98231</td>
      <td>493782</td>
      <td>56</td>
      <td>WY</td>
      <td>...</td>
      <td>6.012348</td>
      <td>3.110034</td>
      <td>0.646241</td>
      <td>0.173100</td>
      <td>4.269805</td>
      <td>14.95586</td>
      <td>2.729213</td>
      <td>1.540592</td>
      <td>10.686050</td>
      <td>both</td>
    </tr>
    <tr>
      <th>560</th>
      <td>Wyoming</td>
      <td>2004</td>
      <td>70776</td>
      <td>167629</td>
      <td>0</td>
      <td>29.68730</td>
      <td>70.31271</td>
      <td>506529</td>
      <td>56</td>
      <td>WY</td>
      <td>...</td>
      <td>3.795901</td>
      <td>2.813834</td>
      <td>0.589240</td>
      <td>0.222032</td>
      <td>4.419300</td>
      <td>14.49616</td>
      <td>2.519214</td>
      <td>1.648164</td>
      <td>10.328780</td>
      <td>both</td>
    </tr>
  </tbody>
</table>
<p>561 rows × 98 columns</p>
</div></div></div>
</div>
<p>Again, we set <code class="docutils literal notranslate"><span class="pre">merged_data</span></code> equal to <code class="docutils literal notranslate"><span class="pre">merge_test</span></code>, dropping the <code class="docutils literal notranslate"><span class="pre">matched</span></code> column so that we can reuse this name in the next join:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged_data</span> <span class="o">=</span> <span class="n">merge_test</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;matched&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Finally we merge the data with the <code class="docutils literal notranslate"><span class="pre">area</span></code> dataframe. This merge matches <code class="docutils literal notranslate"><span class="pre">State</span></code> in <code class="docutils literal notranslate"><span class="pre">merged_data</span></code> to <code class="docutils literal notranslate"><span class="pre">state</span></code> in area: this subtle difference is easy to miss and will result in an error if we fail to notice the lowercase s and write <code class="docutils literal notranslate"><span class="pre">on='State'</span></code>. This merge should be a many-to-one merge, as there are many rows for each state in <code class="docutils literal notranslate"><span class="pre">merged_data</span></code> (for many years), but only one row for each state in <code class="docutils literal notranslate"><span class="pre">area</span></code>. As</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merge_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">merged_data</span><span class="p">,</span> <span class="n">area</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;outer&quot;</span><span class="p">,</span>
                      <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;State&#39;</span><span class="p">,</span><span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;state&#39;</span><span class="p">,</span> 
                      <span class="n">indicator</span><span class="o">=</span><span class="s1">&#39;matched&#39;</span><span class="p">,</span> 
                      <span class="n">validate</span><span class="o">=</span><span class="s1">&#39;many_to_one&#39;</span><span class="p">)</span>
<span class="n">merge_test</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;matched!=&#39;both&#39;&quot;</span><span class="p">)[[</span><span class="s1">&#39;State&#39;</span><span class="p">,</span> <span class="s1">&#39;state&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;year&#39;</span><span class="p">,</span><span class="s1">&#39;matched&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>State</th>
      <th>state</th>
      <th>year</th>
      <th>matched</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>77</th>
      <td>D. C.</td>
      <td>NaN</td>
      <td>1964.0</td>
      <td>left_only</td>
    </tr>
    <tr>
      <th>78</th>
      <td>D. C.</td>
      <td>NaN</td>
      <td>1968.0</td>
      <td>left_only</td>
    </tr>
    <tr>
      <th>79</th>
      <td>D. C.</td>
      <td>NaN</td>
      <td>1972.0</td>
      <td>left_only</td>
    </tr>
    <tr>
      <th>80</th>
      <td>D. C.</td>
      <td>NaN</td>
      <td>1976.0</td>
      <td>left_only</td>
    </tr>
    <tr>
      <th>81</th>
      <td>D. C.</td>
      <td>NaN</td>
      <td>1980.0</td>
      <td>left_only</td>
    </tr>
    <tr>
      <th>82</th>
      <td>D. C.</td>
      <td>NaN</td>
      <td>1984.0</td>
      <td>left_only</td>
    </tr>
    <tr>
      <th>83</th>
      <td>D. C.</td>
      <td>NaN</td>
      <td>1988.0</td>
      <td>left_only</td>
    </tr>
    <tr>
      <th>84</th>
      <td>D. C.</td>
      <td>NaN</td>
      <td>1992.0</td>
      <td>left_only</td>
    </tr>
    <tr>
      <th>85</th>
      <td>D. C.</td>
      <td>NaN</td>
      <td>1996.0</td>
      <td>left_only</td>
    </tr>
    <tr>
      <th>86</th>
      <td>D. C.</td>
      <td>NaN</td>
      <td>2000.0</td>
      <td>left_only</td>
    </tr>
    <tr>
      <th>87</th>
      <td>D. C.</td>
      <td>NaN</td>
      <td>2004.0</td>
      <td>left_only</td>
    </tr>
    <tr>
      <th>561</th>
      <td>NaN</td>
      <td>District of Columbia</td>
      <td>NaN</td>
      <td>right_only</td>
    </tr>
    <tr>
      <th>562</th>
      <td>NaN</td>
      <td>Puerto Rico</td>
      <td>NaN</td>
      <td>right_only</td>
    </tr>
    <tr>
      <th>563</th>
      <td>NaN</td>
      <td>Northern Mariana Islands</td>
      <td>NaN</td>
      <td>right_only</td>
    </tr>
    <tr>
      <th>564</th>
      <td>NaN</td>
      <td>United States Virgin Islands</td>
      <td>NaN</td>
      <td>right_only</td>
    </tr>
    <tr>
      <th>565</th>
      <td>NaN</td>
      <td>American Samoa</td>
      <td>NaN</td>
      <td>right_only</td>
    </tr>
    <tr>
      <th>566</th>
      <td>NaN</td>
      <td>Guam</td>
      <td>NaN</td>
      <td>right_only</td>
    </tr>
    <tr>
      <th>567</th>
      <td>NaN</td>
      <td>United States Minor Outlying Islands</td>
      <td>NaN</td>
      <td>right_only</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>In this case, one of our validation checks failed: we have unmatched rows. Some of these rows are due to differences in coverage: we will not bring Puerto Rico, the Northern Mariana Islands, the United States Virgin Islands, American Samoa, Guam, or the United States Minor Outlying Islands into the merged data as these territories do not receive votes in the electoral college. We will however bring the District of Columbia into the merged data as D.C. does get 3 votes in the electoral college. D.C. is unmatched due to spelling discrepancies, and we must correct this mistake before we can proceed. The easiest way to fix the error is to replace values of “District of Columbia” in the <code class="docutils literal notranslate"><span class="pre">area</span></code> dataframe with “D. C.”, as it is written in the merged data. We can use the <code class="docutils literal notranslate"><span class="pre">.replace()</span></code> method (because we only want to replace one <code class="docutils literal notranslate"><span class="pre">state</span></code> category and <code class="docutils literal notranslate"><span class="pre">.replace()</span></code> leaves unlisted categories alone, as opposed to <code class="docutils literal notranslate"><span class="pre">.map()</span></code> which would replace unlisted categories with missing values), as we discussed in module 8:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">area</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">area</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="s1">&#39;District of Columbia&#39;</span><span class="p">:</span><span class="s1">&#39;D. C.&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<p>Now if we repeat the test, we will only see the rows that are unmatched due to differences in coverage:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merge_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">merged_data</span><span class="p">,</span> <span class="n">area</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;State&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;outer&quot;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="n">indicator</span><span class="o">=</span><span class="s1">&#39;matched&#39;</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="s1">&#39;many_to_one&#39;</span><span class="p">)</span>
<span class="n">merge_test</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;matched!=&#39;both&#39;&quot;</span><span class="p">)[[</span><span class="s1">&#39;State&#39;</span><span class="p">,</span> <span class="s1">&#39;state&#39;</span><span class="p">,</span><span class="s1">&#39;year&#39;</span><span class="p">,</span><span class="s1">&#39;matched&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>State</th>
      <th>state</th>
      <th>year</th>
      <th>matched</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>561</th>
      <td>NaN</td>
      <td>Puerto Rico</td>
      <td>NaN</td>
      <td>right_only</td>
    </tr>
    <tr>
      <th>562</th>
      <td>NaN</td>
      <td>Northern Mariana Islands</td>
      <td>NaN</td>
      <td>right_only</td>
    </tr>
    <tr>
      <th>563</th>
      <td>NaN</td>
      <td>United States Virgin Islands</td>
      <td>NaN</td>
      <td>right_only</td>
    </tr>
    <tr>
      <th>564</th>
      <td>NaN</td>
      <td>American Samoa</td>
      <td>NaN</td>
      <td>right_only</td>
    </tr>
    <tr>
      <th>565</th>
      <td>NaN</td>
      <td>Guam</td>
      <td>NaN</td>
      <td>right_only</td>
    </tr>
    <tr>
      <th>566</th>
      <td>NaN</td>
      <td>United States Minor Outlying Islands</td>
      <td>NaN</td>
      <td>right_only</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We replace the <code class="docutils literal notranslate"><span class="pre">merged_data</span></code> dataframe with <code class="docutils literal notranslate"><span class="pre">merge_test</span></code>, keeping only the rows for which <code class="docutils literal notranslate"><span class="pre">matched='both'</span></code>, then dropping the <code class="docutils literal notranslate"><span class="pre">matched</span></code> column:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged_data</span> <span class="o">=</span> <span class="n">merge_test</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;matched==&#39;both&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;matched&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now <code class="docutils literal notranslate"><span class="pre">merged_data</span></code> contains all of the data we need, including state election results, income, economic data, and area:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged_data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>State</th>
      <th>year</th>
      <th>demvote</th>
      <th>repvote</th>
      <th>wallacevote</th>
      <th>dempercent</th>
      <th>reppercent</th>
      <th>population</th>
      <th>fips</th>
      <th>stcode</th>
      <th>...</th>
      <th>Government_military_share</th>
      <th>Government_statelocal_share</th>
      <th>state</th>
      <th>area_sqmi</th>
      <th>area_sqkm</th>
      <th>landarea_sqmi</th>
      <th>landarea_sqkm</th>
      <th>water_sqmi</th>
      <th>water_sqkm</th>
      <th>percent_water</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Alabama</td>
      <td>1964.0</td>
      <td>210732.0</td>
      <td>479085.0</td>
      <td>0.0</td>
      <td>30.54897</td>
      <td>69.45103</td>
      <td>1919000.0</td>
      <td>1.0</td>
      <td>AL</td>
      <td>...</td>
      <td>2.402146</td>
      <td>7.182051</td>
      <td>Alabama</td>
      <td>52,419.02</td>
      <td>135,765</td>
      <td>50,744.00</td>
      <td>131,426</td>
      <td>1,675.01</td>
      <td>4,338</td>
      <td>3.20</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Alabama</td>
      <td>1968.0</td>
      <td>196579.0</td>
      <td>146923.0</td>
      <td>691425.0</td>
      <td>18.99448</td>
      <td>81.00552</td>
      <td>1993000.0</td>
      <td>1.0</td>
      <td>AL</td>
      <td>...</td>
      <td>2.630377</td>
      <td>8.356928</td>
      <td>Alabama</td>
      <td>52,419.02</td>
      <td>135,765</td>
      <td>50,744.00</td>
      <td>131,426</td>
      <td>1,675.01</td>
      <td>4,338</td>
      <td>3.20</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Alabama</td>
      <td>1972.0</td>
      <td>256923.0</td>
      <td>728701.0</td>
      <td>0.0</td>
      <td>26.06704</td>
      <td>73.93296</td>
      <td>3540080.0</td>
      <td>1.0</td>
      <td>AL</td>
      <td>...</td>
      <td>2.679969</td>
      <td>8.841941</td>
      <td>Alabama</td>
      <td>52,419.02</td>
      <td>135,765</td>
      <td>50,744.00</td>
      <td>131,426</td>
      <td>1,675.01</td>
      <td>4,338</td>
      <td>3.20</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Alabama</td>
      <td>1976.0</td>
      <td>659170.0</td>
      <td>504070.0</td>
      <td>0.0</td>
      <td>56.66673</td>
      <td>43.33327</td>
      <td>3737204.0</td>
      <td>1.0</td>
      <td>AL</td>
      <td>...</td>
      <td>2.255639</td>
      <td>9.386103</td>
      <td>Alabama</td>
      <td>52,419.02</td>
      <td>135,765</td>
      <td>50,744.00</td>
      <td>131,426</td>
      <td>1,675.01</td>
      <td>4,338</td>
      <td>3.20</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Alabama</td>
      <td>1980.0</td>
      <td>636730.0</td>
      <td>654192.0</td>
      <td>0.0</td>
      <td>49.32366</td>
      <td>50.67634</td>
      <td>3894025.0</td>
      <td>1.0</td>
      <td>AL</td>
      <td>...</td>
      <td>2.171860</td>
      <td>9.928901</td>
      <td>Alabama</td>
      <td>52,419.02</td>
      <td>135,765</td>
      <td>50,744.00</td>
      <td>131,426</td>
      <td>1,675.01</td>
      <td>4,338</td>
      <td>3.20</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>556</th>
      <td>Wyoming</td>
      <td>1988.0</td>
      <td>67113.0</td>
      <td>106867.0</td>
      <td>0.0</td>
      <td>38.57512</td>
      <td>61.42488</td>
      <td>465080.0</td>
      <td>56.0</td>
      <td>WY</td>
      <td>...</td>
      <td>1.660191</td>
      <td>10.234900</td>
      <td>Wyoming</td>
      <td>97,813.56</td>
      <td>253,336</td>
      <td>97,100.40</td>
      <td>251,489</td>
      <td>713.16</td>
      <td>1,847</td>
      <td>0.73</td>
    </tr>
    <tr>
      <th>557</th>
      <td>Wyoming</td>
      <td>1992.0</td>
      <td>68160.0</td>
      <td>79347.0</td>
      <td>0.0</td>
      <td>46.20798</td>
      <td>53.79202</td>
      <td>466251.0</td>
      <td>56.0</td>
      <td>WY</td>
      <td>...</td>
      <td>1.552073</td>
      <td>10.632080</td>
      <td>Wyoming</td>
      <td>97,813.56</td>
      <td>253,336</td>
      <td>97,100.40</td>
      <td>251,489</td>
      <td>713.16</td>
      <td>1,847</td>
      <td>0.73</td>
    </tr>
    <tr>
      <th>558</th>
      <td>Wyoming</td>
      <td>1996.0</td>
      <td>77934.0</td>
      <td>105388.0</td>
      <td>0.0</td>
      <td>42.51208</td>
      <td>57.48792</td>
      <td>488167.0</td>
      <td>56.0</td>
      <td>WY</td>
      <td>...</td>
      <td>1.544622</td>
      <td>10.030510</td>
      <td>Wyoming</td>
      <td>97,813.56</td>
      <td>253,336</td>
      <td>97,100.40</td>
      <td>251,489</td>
      <td>713.16</td>
      <td>1,847</td>
      <td>0.73</td>
    </tr>
    <tr>
      <th>559</th>
      <td>Wyoming</td>
      <td>2000.0</td>
      <td>60481.0</td>
      <td>147947.0</td>
      <td>0.0</td>
      <td>29.01769</td>
      <td>70.98231</td>
      <td>493782.0</td>
      <td>56.0</td>
      <td>WY</td>
      <td>...</td>
      <td>1.540592</td>
      <td>10.686050</td>
      <td>Wyoming</td>
      <td>97,813.56</td>
      <td>253,336</td>
      <td>97,100.40</td>
      <td>251,489</td>
      <td>713.16</td>
      <td>1,847</td>
      <td>0.73</td>
    </tr>
    <tr>
      <th>560</th>
      <td>Wyoming</td>
      <td>2004.0</td>
      <td>70776.0</td>
      <td>167629.0</td>
      <td>0.0</td>
      <td>29.68730</td>
      <td>70.31271</td>
      <td>506529.0</td>
      <td>56.0</td>
      <td>WY</td>
      <td>...</td>
      <td>1.648164</td>
      <td>10.328780</td>
      <td>Wyoming</td>
      <td>97,813.56</td>
      <td>253,336</td>
      <td>97,100.40</td>
      <td>251,489</td>
      <td>713.16</td>
      <td>1,847</td>
      <td>0.73</td>
    </tr>
  </tbody>
</table>
<p>561 rows × 105 columns</p>
</div></div></div>
</div>
</section>
</section>
<section id="reshaping-data">
<h2><a class="toc-backref" href="#id8" role="doc-backlink"><span class="section-number">9.3. </span>Reshaping Data</a><a class="headerlink" href="#reshaping-data" title="Permalink to this heading">#</a></h2>
<p><strong>Reshaping</strong> a dataframe refers to turning the rows of a dataframe into columns (also known as a long-to-wide reshape), or turning columns into rows (also known as a wide-to-long reshape), in a way that cannot be accomplished by simply transposing the data matrix. It is also called <strong>pivoting</strong> for a long-to-wide reshape, <strong>melting</strong> for a wide-to-long reshape. It’s a notoriously tricky skill to master, and it helps a lot to understand every part of the function we need, so that we’re not blindly trying every combination of parameters hoping one of these combinations works.</p>
<section id="example-gross-domestic-product-by-state-1997-2015">
<h3><a class="toc-backref" href="#id9" role="doc-backlink"><span class="section-number">9.3.1. </span>Example: Gross domestic product by state, 1997-2015</a><a class="headerlink" href="#example-gross-domestic-product-by-state-1997-2015" title="Permalink to this heading">#</a></h3>
<p>To demonstrate the method for pivoting a dataframe, we use example data from the U.S. Bureau of Economic Affairs (<a class="reference external" href="http://www.bea.gov">www.bea.gov</a>) on economic output for the American states. We load the data, skipping the last four rows as these rows contain attribution information and notes, and are not part of the data. We also use the <code class="docutils literal notranslate"><span class="pre">.str.strip()</span></code> method to remove all the leading and trailing whitespace in the <code class="docutils literal notranslate"><span class="pre">Description</span></code> column:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gsp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://github.com/jkropko/DS-6001/raw/master/localdata/gsp_naics_all.csv&quot;</span><span class="p">,</span> <span class="n">skipfooter</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">gsp</span><span class="p">[</span><span class="s1">&#39;Description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gsp</span><span class="p">[</span><span class="s1">&#39;Description&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="n">gsp</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/var/folders/4w/k9sqqcbx4dxgpjtwgv_1m29h0000gq/T/ipykernel_7236/793934051.py:1: ParserWarning: Falling back to the &#39;python&#39; engine because the &#39;c&#39; engine does not support skipfooter; you can avoid this warning by specifying engine=&#39;python&#39;.
  gsp = pd.read_csv(&quot;https://github.com/jkropko/DS-6001/raw/master/localdata/gsp_naics_all.csv&quot;, skipfooter=4)
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GeoFIPS</th>
      <th>GeoName</th>
      <th>Region</th>
      <th>ComponentId</th>
      <th>ComponentName</th>
      <th>IndustryId</th>
      <th>IndustryClassification</th>
      <th>Description</th>
      <th>1997</th>
      <th>1998</th>
      <th>...</th>
      <th>2006</th>
      <th>2007</th>
      <th>2008</th>
      <th>2009</th>
      <th>2010</th>
      <th>2011</th>
      <th>2012</th>
      <th>2013</th>
      <th>2014</th>
      <th>2015</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>00000</td>
      <td>United States</td>
      <td>NaN</td>
      <td>200</td>
      <td>Gross domestic product (GDP) by state</td>
      <td>1</td>
      <td>...</td>
      <td>All industry total</td>
      <td>8542530</td>
      <td>9024434</td>
      <td>...</td>
      <td>13773226</td>
      <td>14391149</td>
      <td>14626598</td>
      <td>14320114</td>
      <td>14859772</td>
      <td>15406002</td>
      <td>16041243</td>
      <td>16576808</td>
      <td>17277548</td>
      <td>17919651</td>
    </tr>
    <tr>
      <th>1</th>
      <td>00000</td>
      <td>United States</td>
      <td>NaN</td>
      <td>200</td>
      <td>Gross domestic product (GDP) by state</td>
      <td>2</td>
      <td>...</td>
      <td>Private industries</td>
      <td>7459395</td>
      <td>7894015</td>
      <td>...</td>
      <td>12045446</td>
      <td>12572387</td>
      <td>12716179</td>
      <td>12352979</td>
      <td>12826507</td>
      <td>13348439</td>
      <td>13957545</td>
      <td>14468465</td>
      <td>15115846</td>
      <td>15698669</td>
    </tr>
    <tr>
      <th>2</th>
      <td>00000</td>
      <td>United States</td>
      <td>NaN</td>
      <td>200</td>
      <td>Gross domestic product (GDP) by state</td>
      <td>3</td>
      <td>11</td>
      <td>Agriculture, forestry, fishing, and hunting</td>
      <td>108796</td>
      <td>99940</td>
      <td>...</td>
      <td>128345</td>
      <td>141999</td>
      <td>154525</td>
      <td>137655</td>
      <td>160217</td>
      <td>197241</td>
      <td>185800</td>
      <td>221821</td>
      <td>203188</td>
      <td>175236</td>
    </tr>
    <tr>
      <th>3</th>
      <td>00000</td>
      <td>United States</td>
      <td>NaN</td>
      <td>200</td>
      <td>Gross domestic product (GDP) by state</td>
      <td>4</td>
      <td>111-112</td>
      <td>Farms</td>
      <td>88136</td>
      <td>79030</td>
      <td>...</td>
      <td>99352</td>
      <td>113533</td>
      <td>126345</td>
      <td>109800</td>
      <td>129725</td>
      <td>166249</td>
      <td>151489</td>
      <td>186960</td>
      <td>166249</td>
      <td>(NA)</td>
    </tr>
    <tr>
      <th>4</th>
      <td>00000</td>
      <td>United States</td>
      <td>NaN</td>
      <td>200</td>
      <td>Gross domestic product (GDP) by state</td>
      <td>5</td>
      <td>113-115</td>
      <td>Forestry, fishing, and related activities</td>
      <td>20660</td>
      <td>20910</td>
      <td>...</td>
      <td>28993</td>
      <td>28466</td>
      <td>28180</td>
      <td>27855</td>
      <td>30492</td>
      <td>30992</td>
      <td>34311</td>
      <td>34861</td>
      <td>36939</td>
      <td>(NA)</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>43287</th>
      <td>94000</td>
      <td>Plains</td>
      <td>4</td>
      <td>1000</td>
      <td>Per capita real GDP by state</td>
      <td>1</td>
      <td>...</td>
      <td>All industry total</td>
      <td>39071</td>
      <td>39970</td>
      <td>...</td>
      <td>46013</td>
      <td>46501</td>
      <td>46794</td>
      <td>45399</td>
      <td>46210</td>
      <td>46921</td>
      <td>47629</td>
      <td>48126</td>
      <td>48778</td>
      <td>49153</td>
    </tr>
    <tr>
      <th>43288</th>
      <td>95000</td>
      <td>Southeast</td>
      <td>5</td>
      <td>1000</td>
      <td>Per capita real GDP by state</td>
      <td>1</td>
      <td>...</td>
      <td>All industry total</td>
      <td>36722</td>
      <td>37896</td>
      <td>...</td>
      <td>43586</td>
      <td>43028</td>
      <td>42092</td>
      <td>40346</td>
      <td>40675</td>
      <td>40471</td>
      <td>40415</td>
      <td>40487</td>
      <td>40802</td>
      <td>41352</td>
    </tr>
    <tr>
      <th>43289</th>
      <td>96000</td>
      <td>Southwest</td>
      <td>6</td>
      <td>1000</td>
      <td>Per capita real GDP by state</td>
      <td>1</td>
      <td>...</td>
      <td>All industry total</td>
      <td>38887</td>
      <td>40283</td>
      <td>...</td>
      <td>45743</td>
      <td>46684</td>
      <td>45914</td>
      <td>44324</td>
      <td>44491</td>
      <td>45344</td>
      <td>46881</td>
      <td>48064</td>
      <td>49327</td>
      <td>50519</td>
    </tr>
    <tr>
      <th>43290</th>
      <td>97000</td>
      <td>Rocky Mountain</td>
      <td>7</td>
      <td>1000</td>
      <td>Per capita real GDP by state</td>
      <td>1</td>
      <td>...</td>
      <td>All industry total</td>
      <td>38243</td>
      <td>40390</td>
      <td>...</td>
      <td>46756</td>
      <td>47587</td>
      <td>47019</td>
      <td>45170</td>
      <td>44937</td>
      <td>45060</td>
      <td>45014</td>
      <td>45564</td>
      <td>46508</td>
      <td>47093</td>
    </tr>
    <tr>
      <th>43291</th>
      <td>98000</td>
      <td>Far West</td>
      <td>8</td>
      <td>1000</td>
      <td>Per capita real GDP by state</td>
      <td>1</td>
      <td>...</td>
      <td>All industry total</td>
      <td>41901</td>
      <td>43467</td>
      <td>...</td>
      <td>53932</td>
      <td>54469</td>
      <td>53881</td>
      <td>51328</td>
      <td>51609</td>
      <td>51857</td>
      <td>52429</td>
      <td>52942</td>
      <td>54077</td>
      <td>55429</td>
    </tr>
  </tbody>
</table>
<p>43292 rows × 27 columns</p>
</div></div></div>
</div>
<p>For this example, we only want to save three features besides the primary keys:</p>
<ul class="simple">
<li><p>state GDP,</p></li>
<li><p>state GDP per capita,</p></li>
<li><p>state GDP from private industries</p></li>
</ul>
<p>We only want the 50 states, no regions, territories, or districts (sorry DC!). Notice that the features we want are contained in rows, and the years are contained in columns. We need to switch that: the features must be in columns, and years must be stored in the rows. We will need to perform both a wide-to-long and a long-to-wide reshape. In addition, we will give the columns concise but descriptive names, and we will create a new column that contains the percent of GDP from private industry in each state and each year.</p>
<p>First we need to reduce the data to only the features we need: state GDP, state GDP per capita, and state GDP from private industries. Right now, however, the features are not stored in the columns, but in the rows. Specifically, the data we need are contains in the rows in which <code class="docutils literal notranslate"><span class="pre">Description</span></code> is “All industry total” or “Private industries” and <code class="docutils literal notranslate"><span class="pre">ComponentName</span></code> is “Gross domestic product (GDP) by state” or “Per capita real GDP by state”. We use <code class="docutils literal notranslate"><span class="pre">.query()</span></code> to isolate these rows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gsp_clean</span> <span class="o">=</span> <span class="n">gsp</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
    <span class="s2">&quot;Description in [&#39;All industry total&#39;, &#39;Private industries&#39;]&quot;</span>
<span class="p">)</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
    <span class="s2">&quot;ComponentName in [&#39;Gross domestic product (GDP) by state&#39;,&#39;Per capita real GDP by state&#39;]&quot;</span><span class="p">)</span>
<span class="n">gsp_clean</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GeoFIPS</th>
      <th>GeoName</th>
      <th>Region</th>
      <th>ComponentId</th>
      <th>ComponentName</th>
      <th>IndustryId</th>
      <th>IndustryClassification</th>
      <th>Description</th>
      <th>1997</th>
      <th>1998</th>
      <th>...</th>
      <th>2006</th>
      <th>2007</th>
      <th>2008</th>
      <th>2009</th>
      <th>2010</th>
      <th>2011</th>
      <th>2012</th>
      <th>2013</th>
      <th>2014</th>
      <th>2015</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>00000</td>
      <td>United States</td>
      <td>NaN</td>
      <td>200</td>
      <td>Gross domestic product (GDP) by state</td>
      <td>1</td>
      <td>...</td>
      <td>All industry total</td>
      <td>8542530</td>
      <td>9024434</td>
      <td>...</td>
      <td>13773226</td>
      <td>14391149</td>
      <td>14626598</td>
      <td>14320114</td>
      <td>14859772</td>
      <td>15406002</td>
      <td>16041243</td>
      <td>16576808</td>
      <td>17277548</td>
      <td>17919651</td>
    </tr>
    <tr>
      <th>1</th>
      <td>00000</td>
      <td>United States</td>
      <td>NaN</td>
      <td>200</td>
      <td>Gross domestic product (GDP) by state</td>
      <td>2</td>
      <td>...</td>
      <td>Private industries</td>
      <td>7459395</td>
      <td>7894015</td>
      <td>...</td>
      <td>12045446</td>
      <td>12572387</td>
      <td>12716179</td>
      <td>12352979</td>
      <td>12826507</td>
      <td>13348439</td>
      <td>13957545</td>
      <td>14468465</td>
      <td>15115846</td>
      <td>15698669</td>
    </tr>
    <tr>
      <th>90</th>
      <td>01000</td>
      <td>Alabama</td>
      <td>5</td>
      <td>200</td>
      <td>Gross domestic product (GDP) by state</td>
      <td>1</td>
      <td>...</td>
      <td>All industry total</td>
      <td>104218</td>
      <td>109414</td>
      <td>...</td>
      <td>164468</td>
      <td>169923</td>
      <td>172646</td>
      <td>168315</td>
      <td>174710</td>
      <td>180665</td>
      <td>185878</td>
      <td>190095</td>
      <td>194421</td>
      <td>199656</td>
    </tr>
    <tr>
      <th>91</th>
      <td>01000</td>
      <td>Alabama</td>
      <td>5</td>
      <td>200</td>
      <td>Gross domestic product (GDP) by state</td>
      <td>2</td>
      <td>...</td>
      <td>Private industries</td>
      <td>87014</td>
      <td>91506</td>
      <td>...</td>
      <td>137954</td>
      <td>141306</td>
      <td>142965</td>
      <td>137143</td>
      <td>142773</td>
      <td>148181</td>
      <td>153494</td>
      <td>157961</td>
      <td>161364</td>
      <td>166243</td>
    </tr>
    <tr>
      <th>180</th>
      <td>02000</td>
      <td>Alaska</td>
      <td>8</td>
      <td>200</td>
      <td>Gross domestic product (GDP) by state</td>
      <td>1</td>
      <td>...</td>
      <td>All industry total</td>
      <td>25446</td>
      <td>24030</td>
      <td>...</td>
      <td>44679</td>
      <td>49197</td>
      <td>55461</td>
      <td>50463</td>
      <td>54134</td>
      <td>58759</td>
      <td>60890</td>
      <td>59762</td>
      <td>58253</td>
      <td>52747</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>43287</th>
      <td>94000</td>
      <td>Plains</td>
      <td>4</td>
      <td>1000</td>
      <td>Per capita real GDP by state</td>
      <td>1</td>
      <td>...</td>
      <td>All industry total</td>
      <td>39071</td>
      <td>39970</td>
      <td>...</td>
      <td>46013</td>
      <td>46501</td>
      <td>46794</td>
      <td>45399</td>
      <td>46210</td>
      <td>46921</td>
      <td>47629</td>
      <td>48126</td>
      <td>48778</td>
      <td>49153</td>
    </tr>
    <tr>
      <th>43288</th>
      <td>95000</td>
      <td>Southeast</td>
      <td>5</td>
      <td>1000</td>
      <td>Per capita real GDP by state</td>
      <td>1</td>
      <td>...</td>
      <td>All industry total</td>
      <td>36722</td>
      <td>37896</td>
      <td>...</td>
      <td>43586</td>
      <td>43028</td>
      <td>42092</td>
      <td>40346</td>
      <td>40675</td>
      <td>40471</td>
      <td>40415</td>
      <td>40487</td>
      <td>40802</td>
      <td>41352</td>
    </tr>
    <tr>
      <th>43289</th>
      <td>96000</td>
      <td>Southwest</td>
      <td>6</td>
      <td>1000</td>
      <td>Per capita real GDP by state</td>
      <td>1</td>
      <td>...</td>
      <td>All industry total</td>
      <td>38887</td>
      <td>40283</td>
      <td>...</td>
      <td>45743</td>
      <td>46684</td>
      <td>45914</td>
      <td>44324</td>
      <td>44491</td>
      <td>45344</td>
      <td>46881</td>
      <td>48064</td>
      <td>49327</td>
      <td>50519</td>
    </tr>
    <tr>
      <th>43290</th>
      <td>97000</td>
      <td>Rocky Mountain</td>
      <td>7</td>
      <td>1000</td>
      <td>Per capita real GDP by state</td>
      <td>1</td>
      <td>...</td>
      <td>All industry total</td>
      <td>38243</td>
      <td>40390</td>
      <td>...</td>
      <td>46756</td>
      <td>47587</td>
      <td>47019</td>
      <td>45170</td>
      <td>44937</td>
      <td>45060</td>
      <td>45014</td>
      <td>45564</td>
      <td>46508</td>
      <td>47093</td>
    </tr>
    <tr>
      <th>43291</th>
      <td>98000</td>
      <td>Far West</td>
      <td>8</td>
      <td>1000</td>
      <td>Per capita real GDP by state</td>
      <td>1</td>
      <td>...</td>
      <td>All industry total</td>
      <td>41901</td>
      <td>43467</td>
      <td>...</td>
      <td>53932</td>
      <td>54469</td>
      <td>53881</td>
      <td>51328</td>
      <td>51609</td>
      <td>51857</td>
      <td>52429</td>
      <td>52942</td>
      <td>54077</td>
      <td>55429</td>
    </tr>
  </tbody>
</table>
<p>180 rows × 27 columns</p>
</div></div></div>
</div>
<p>Next, we only want the 50 states, no regions, territories, or districts, so we issue another <code class="docutils literal notranslate"><span class="pre">.query()</span></code> to remove the territories. To see these non-states, we call up a list of the unique values of <code class="docutils literal notranslate"><span class="pre">GeoName</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gsp_clean</span><span class="p">[</span><span class="s1">&#39;GeoName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;United States&#39;, &#39;Alabama&#39;, &#39;Alaska&#39;, &#39;Arizona&#39;, &#39;Arkansas&#39;,
       &#39;California&#39;, &#39;Colorado&#39;, &#39;Connecticut&#39;, &#39;Delaware&#39;,
       &#39;District of Columbia&#39;, &#39;Florida&#39;, &#39;Georgia&#39;, &#39;Hawaii&#39;, &#39;Idaho&#39;,
       &#39;Illinois&#39;, &#39;Indiana&#39;, &#39;Iowa&#39;, &#39;Kansas&#39;, &#39;Kentucky&#39;, &#39;Louisiana&#39;,
       &#39;Maine&#39;, &#39;Maryland&#39;, &#39;Massachusetts&#39;, &#39;Michigan&#39;, &#39;Minnesota&#39;,
       &#39;Mississippi&#39;, &#39;Missouri&#39;, &#39;Montana&#39;, &#39;Nebraska&#39;, &#39;Nevada&#39;,
       &#39;New Hampshire&#39;, &#39;New Jersey&#39;, &#39;New Mexico&#39;, &#39;New York&#39;,
       &#39;North Carolina&#39;, &#39;North Dakota&#39;, &#39;Ohio&#39;, &#39;Oklahoma&#39;, &#39;Oregon&#39;,
       &#39;Pennsylvania&#39;, &#39;Rhode Island&#39;, &#39;South Carolina&#39;, &#39;South Dakota&#39;,
       &#39;Tennessee&#39;, &#39;Texas&#39;, &#39;Utah&#39;, &#39;Vermont&#39;, &#39;Virginia&#39;, &#39;Washington&#39;,
       &#39;West Virginia&#39;, &#39;Wisconsin&#39;, &#39;Wyoming&#39;, &#39;New England&#39;, &#39;Mideast&#39;,
       &#39;Great Lakes&#39;, &#39;Plains&#39;, &#39;Southeast&#39;, &#39;Southwest&#39;,
       &#39;Rocky Mountain&#39;, &#39;Far West&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<p>We need to remove the rows in which <code class="docutils literal notranslate"><span class="pre">GeoName</span></code> is “United States”, “District of Columbia”, “New England”, “Mideast”, “Great Lakes”, “Plains”, “Southeast”, “Southwest”, “Rocky Mountain”, or “Far West”:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gsp_clean</span> <span class="o">=</span> <span class="n">gsp_clean</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;GeoName not in [&#39;United States&#39;, &#39;District of Columbia&#39;, &#39;New England&#39;, &#39;Mideast&#39;, &#39;Great Lakes&#39;, &#39;Plains&#39;, &#39;Southeast&#39;, &#39;Southwest&#39;, &#39;Rocky Mountain&#39;, &#39;Far West&#39;]&quot;</span><span class="p">)</span>
<span class="n">gsp_clean</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GeoFIPS</th>
      <th>GeoName</th>
      <th>Region</th>
      <th>ComponentId</th>
      <th>ComponentName</th>
      <th>IndustryId</th>
      <th>IndustryClassification</th>
      <th>Description</th>
      <th>1997</th>
      <th>1998</th>
      <th>...</th>
      <th>2006</th>
      <th>2007</th>
      <th>2008</th>
      <th>2009</th>
      <th>2010</th>
      <th>2011</th>
      <th>2012</th>
      <th>2013</th>
      <th>2014</th>
      <th>2015</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>90</th>
      <td>01000</td>
      <td>Alabama</td>
      <td>5</td>
      <td>200</td>
      <td>Gross domestic product (GDP) by state</td>
      <td>1</td>
      <td>...</td>
      <td>All industry total</td>
      <td>104218</td>
      <td>109414</td>
      <td>...</td>
      <td>164468</td>
      <td>169923</td>
      <td>172646</td>
      <td>168315</td>
      <td>174710</td>
      <td>180665</td>
      <td>185878</td>
      <td>190095</td>
      <td>194421</td>
      <td>199656</td>
    </tr>
    <tr>
      <th>91</th>
      <td>01000</td>
      <td>Alabama</td>
      <td>5</td>
      <td>200</td>
      <td>Gross domestic product (GDP) by state</td>
      <td>2</td>
      <td>...</td>
      <td>Private industries</td>
      <td>87014</td>
      <td>91506</td>
      <td>...</td>
      <td>137954</td>
      <td>141306</td>
      <td>142965</td>
      <td>137143</td>
      <td>142773</td>
      <td>148181</td>
      <td>153494</td>
      <td>157961</td>
      <td>161364</td>
      <td>166243</td>
    </tr>
    <tr>
      <th>180</th>
      <td>02000</td>
      <td>Alaska</td>
      <td>8</td>
      <td>200</td>
      <td>Gross domestic product (GDP) by state</td>
      <td>1</td>
      <td>...</td>
      <td>All industry total</td>
      <td>25446</td>
      <td>24030</td>
      <td>...</td>
      <td>44679</td>
      <td>49197</td>
      <td>55461</td>
      <td>50463</td>
      <td>54134</td>
      <td>58759</td>
      <td>60890</td>
      <td>59762</td>
      <td>58253</td>
      <td>52747</td>
    </tr>
    <tr>
      <th>181</th>
      <td>02000</td>
      <td>Alaska</td>
      <td>8</td>
      <td>200</td>
      <td>Gross domestic product (GDP) by state</td>
      <td>2</td>
      <td>...</td>
      <td>Private industries</td>
      <td>20284</td>
      <td>18776</td>
      <td>...</td>
      <td>36737</td>
      <td>40919</td>
      <td>46889</td>
      <td>41387</td>
      <td>44742</td>
      <td>48851</td>
      <td>50592</td>
      <td>49764</td>
      <td>47879</td>
      <td>42246</td>
    </tr>
    <tr>
      <th>270</th>
      <td>04000</td>
      <td>Arizona</td>
      <td>6</td>
      <td>200</td>
      <td>Gross domestic product (GDP) by state</td>
      <td>1</td>
      <td>...</td>
      <td>All industry total</td>
      <td>132708</td>
      <td>143768</td>
      <td>...</td>
      <td>248459</td>
      <td>262045</td>
      <td>256718</td>
      <td>242509</td>
      <td>245668</td>
      <td>254192</td>
      <td>264693</td>
      <td>270642</td>
      <td>280166</td>
      <td>290903</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>43279</th>
      <td>51000</td>
      <td>Virginia</td>
      <td>5</td>
      <td>1000</td>
      <td>Per capita real GDP by state</td>
      <td>1</td>
      <td>...</td>
      <td>All industry total</td>
      <td>43069</td>
      <td>44745</td>
      <td>...</td>
      <td>52866</td>
      <td>52657</td>
      <td>51985</td>
      <td>51389</td>
      <td>51945</td>
      <td>51749</td>
      <td>51538</td>
      <td>51105</td>
      <td>50861</td>
      <td>51540</td>
    </tr>
    <tr>
      <th>43280</th>
      <td>53000</td>
      <td>Washington</td>
      <td>8</td>
      <td>1000</td>
      <td>Per capita real GDP by state</td>
      <td>1</td>
      <td>...</td>
      <td>All industry total</td>
      <td>45753</td>
      <td>47712</td>
      <td>...</td>
      <td>52900</td>
      <td>55348</td>
      <td>54939</td>
      <td>52264</td>
      <td>52681</td>
      <td>52495</td>
      <td>53423</td>
      <td>53987</td>
      <td>54773</td>
      <td>55577</td>
    </tr>
    <tr>
      <th>43281</th>
      <td>54000</td>
      <td>West Virginia</td>
      <td>5</td>
      <td>1000</td>
      <td>Per capita real GDP by state</td>
      <td>1</td>
      <td>...</td>
      <td>All industry total</td>
      <td>30445</td>
      <td>30978</td>
      <td>...</td>
      <td>34009</td>
      <td>33892</td>
      <td>34679</td>
      <td>34564</td>
      <td>35368</td>
      <td>36085</td>
      <td>35515</td>
      <td>35778</td>
      <td>36234</td>
      <td>36817</td>
    </tr>
    <tr>
      <th>43282</th>
      <td>55000</td>
      <td>Wisconsin</td>
      <td>3</td>
      <td>1000</td>
      <td>Per capita real GDP by state</td>
      <td>1</td>
      <td>...</td>
      <td>All industry total</td>
      <td>38663</td>
      <td>39695</td>
      <td>...</td>
      <td>45515</td>
      <td>45464</td>
      <td>44622</td>
      <td>43215</td>
      <td>44126</td>
      <td>44905</td>
      <td>45380</td>
      <td>45582</td>
      <td>46469</td>
      <td>46893</td>
    </tr>
    <tr>
      <th>43283</th>
      <td>56000</td>
      <td>Wyoming</td>
      <td>7</td>
      <td>1000</td>
      <td>Per capita real GDP by state</td>
      <td>1</td>
      <td>...</td>
      <td>All industry total</td>
      <td>46585</td>
      <td>47652</td>
      <td>...</td>
      <td>63428</td>
      <td>65471</td>
      <td>69182</td>
      <td>66320</td>
      <td>64602</td>
      <td>63981</td>
      <td>60744</td>
      <td>60743</td>
      <td>61639</td>
      <td>61389</td>
    </tr>
  </tbody>
</table>
<p>150 rows × 27 columns</p>
</div></div></div>
</div>
</section>
<section id="melting-turning-columns-to-rows">
<h3><a class="toc-backref" href="#id10" role="doc-backlink"><span class="section-number">9.3.2. </span>Melting: Turning Columns to Rows</a><a class="headerlink" href="#melting-turning-columns-to-rows" title="Permalink to this heading">#</a></h3>
<p>Notice that many of the columns refer to particular years. We want to move these columns to the rows, so that each state has one row for each year covered in the data. The best function to use when we need to turn columns into rows is <code class="docutils literal notranslate"><span class="pre">pd.melt()</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">id_vars</span><span class="p">,</span> <span class="n">value_vars</span><span class="p">)</span>
</pre></div>
</div>
<p>This function takes three parameters:</p>
<ol class="arabic simple">
<li><p>The name of the dataframe you wish to edit</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">id_vars</span></code>: A list of the names of the columns that we want to continue to exist as columns after the dataframe is melted. In our example, this list will contain both IDs that currently uniquely identify the rows (<code class="docutils literal notranslate"><span class="pre">GeoName</span></code>, <code class="docutils literal notranslate"><span class="pre">ComponentName</span></code>, <code class="docutils literal notranslate"><span class="pre">Description</span></code>), synonyms for the IDs (<code class="docutils literal notranslate"><span class="pre">GeoFIPS</span></code>) that we want to keep, and features that vary across ID but not across the columns (<code class="docutils literal notranslate"><span class="pre">Region</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">value_vars</span></code>: A list of the names of the columns we want to store in the rows. If the columns have numeric names and can be sequentially ordered, as is the case in our example with years, a shortcut for creating a list of these column names is <code class="docutils literal notranslate"><span class="pre">[str(i)</span> <span class="pre">for</span> <span class="pre">i</span> <span class="pre">in</span> <span class="pre">range(1997,2015)]</span></code>, which loops over intergers from 1997 to 2015, placing each year as a string in the list.</p></li>
</ol>
<p>Any column that is not listed under either <code class="docutils literal notranslate"><span class="pre">id_vars</span></code> or <code class="docutils literal notranslate"><span class="pre">value_vars</span></code> will be deleted in the melted data.</p>
<p>For example, we melt the <code class="docutils literal notranslate"><span class="pre">gsp_clean</span></code> dataframe with the following code:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gsp_clean</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">gsp_clean</span><span class="p">,</span> <span class="n">id_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;GeoName&#39;</span><span class="p">,</span> <span class="s1">&#39;GeoFIPS&#39;</span><span class="p">,</span> <span class="s1">&#39;Region&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;ComponentName&#39;</span><span class="p">,</span> <span class="s1">&#39;Description&#39;</span><span class="p">],</span> 
        <span class="n">value_vars</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1997</span><span class="p">,</span><span class="mi">2015</span><span class="p">)])</span>
<span class="n">gsp_clean</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GeoName</th>
      <th>GeoFIPS</th>
      <th>Region</th>
      <th>ComponentName</th>
      <th>Description</th>
      <th>variable</th>
      <th>value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Alabama</td>
      <td>01000</td>
      <td>5</td>
      <td>Gross domestic product (GDP) by state</td>
      <td>All industry total</td>
      <td>1997</td>
      <td>104218</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Alabama</td>
      <td>01000</td>
      <td>5</td>
      <td>Gross domestic product (GDP) by state</td>
      <td>Private industries</td>
      <td>1997</td>
      <td>87014</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Alaska</td>
      <td>02000</td>
      <td>8</td>
      <td>Gross domestic product (GDP) by state</td>
      <td>All industry total</td>
      <td>1997</td>
      <td>25446</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Alaska</td>
      <td>02000</td>
      <td>8</td>
      <td>Gross domestic product (GDP) by state</td>
      <td>Private industries</td>
      <td>1997</td>
      <td>20284</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Arizona</td>
      <td>04000</td>
      <td>6</td>
      <td>Gross domestic product (GDP) by state</td>
      <td>All industry total</td>
      <td>1997</td>
      <td>132708</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2695</th>
      <td>Virginia</td>
      <td>51000</td>
      <td>5</td>
      <td>Per capita real GDP by state</td>
      <td>All industry total</td>
      <td>2014</td>
      <td>50861</td>
    </tr>
    <tr>
      <th>2696</th>
      <td>Washington</td>
      <td>53000</td>
      <td>8</td>
      <td>Per capita real GDP by state</td>
      <td>All industry total</td>
      <td>2014</td>
      <td>54773</td>
    </tr>
    <tr>
      <th>2697</th>
      <td>West Virginia</td>
      <td>54000</td>
      <td>5</td>
      <td>Per capita real GDP by state</td>
      <td>All industry total</td>
      <td>2014</td>
      <td>36234</td>
    </tr>
    <tr>
      <th>2698</th>
      <td>Wisconsin</td>
      <td>55000</td>
      <td>3</td>
      <td>Per capita real GDP by state</td>
      <td>All industry total</td>
      <td>2014</td>
      <td>46469</td>
    </tr>
    <tr>
      <th>2699</th>
      <td>Wyoming</td>
      <td>56000</td>
      <td>7</td>
      <td>Per capita real GDP by state</td>
      <td>All industry total</td>
      <td>2014</td>
      <td>61639</td>
    </tr>
  </tbody>
</table>
<p>2700 rows × 7 columns</p>
</div></div></div>
</div>
<p>Note that the old column names (1997 through 2015 in this case) will always by stored in a column named “variable” after melting, and the datapoints that populated those columns will be contained in a column named “value”.</p>
<p>Before moving on, let’s rename some of the columns to avoid confusion in the next step:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gsp_clean</span> <span class="o">=</span> <span class="n">gsp_clean</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;GeoName&#39;</span><span class="p">:</span><span class="s1">&#39;State&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;GeoFIPS&#39;</span><span class="p">:</span><span class="s1">&#39;FIPS&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;variable&#39;</span><span class="p">:</span><span class="s1">&#39;Year&#39;</span><span class="p">},</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">gsp_clean</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>State</th>
      <th>FIPS</th>
      <th>Region</th>
      <th>ComponentName</th>
      <th>Description</th>
      <th>Year</th>
      <th>value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Alabama</td>
      <td>01000</td>
      <td>5</td>
      <td>Gross domestic product (GDP) by state</td>
      <td>All industry total</td>
      <td>1997</td>
      <td>104218</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Alabama</td>
      <td>01000</td>
      <td>5</td>
      <td>Gross domestic product (GDP) by state</td>
      <td>Private industries</td>
      <td>1997</td>
      <td>87014</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Alaska</td>
      <td>02000</td>
      <td>8</td>
      <td>Gross domestic product (GDP) by state</td>
      <td>All industry total</td>
      <td>1997</td>
      <td>25446</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Alaska</td>
      <td>02000</td>
      <td>8</td>
      <td>Gross domestic product (GDP) by state</td>
      <td>Private industries</td>
      <td>1997</td>
      <td>20284</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Arizona</td>
      <td>04000</td>
      <td>6</td>
      <td>Gross domestic product (GDP) by state</td>
      <td>All industry total</td>
      <td>1997</td>
      <td>132708</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2695</th>
      <td>Virginia</td>
      <td>51000</td>
      <td>5</td>
      <td>Per capita real GDP by state</td>
      <td>All industry total</td>
      <td>2014</td>
      <td>50861</td>
    </tr>
    <tr>
      <th>2696</th>
      <td>Washington</td>
      <td>53000</td>
      <td>8</td>
      <td>Per capita real GDP by state</td>
      <td>All industry total</td>
      <td>2014</td>
      <td>54773</td>
    </tr>
    <tr>
      <th>2697</th>
      <td>West Virginia</td>
      <td>54000</td>
      <td>5</td>
      <td>Per capita real GDP by state</td>
      <td>All industry total</td>
      <td>2014</td>
      <td>36234</td>
    </tr>
    <tr>
      <th>2698</th>
      <td>Wisconsin</td>
      <td>55000</td>
      <td>3</td>
      <td>Per capita real GDP by state</td>
      <td>All industry total</td>
      <td>2014</td>
      <td>46469</td>
    </tr>
    <tr>
      <th>2699</th>
      <td>Wyoming</td>
      <td>56000</td>
      <td>7</td>
      <td>Per capita real GDP by state</td>
      <td>All industry total</td>
      <td>2014</td>
      <td>61639</td>
    </tr>
  </tbody>
</table>
<p>2700 rows × 7 columns</p>
</div></div></div>
</div>
</section>
<section id="pivoting-turning-rows-to-columns">
<h3><a class="toc-backref" href="#id11" role="doc-backlink"><span class="section-number">9.3.3. </span>Pivoting: Turning Rows to Columns</a><a class="headerlink" href="#pivoting-turning-rows-to-columns" title="Permalink to this heading">#</a></h3>
<p>The rows contain features that we want to move to the columns. Specifically, we need separate columns for the different combinations of <code class="docutils literal notranslate"><span class="pre">ComponentName</span></code> and <code class="docutils literal notranslate"><span class="pre">Description</span></code> since the feature names are contained in two columns, so we can combine these two columns by concatenating them together and creating a new column called “feature”. Then we can drop <code class="docutils literal notranslate"><span class="pre">ComponentName</span></code> and <code class="docutils literal notranslate"><span class="pre">Description</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gsp_clean</span> <span class="o">=</span> <span class="n">gsp_clean</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">feature</span> <span class="o">=</span> <span class="n">gsp_clean</span><span class="p">[</span><span class="s1">&#39;ComponentName&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">gsp_clean</span><span class="p">[</span><span class="s1">&#39;Description&#39;</span><span class="p">])</span>
<span class="n">gsp_clean</span> <span class="o">=</span> <span class="n">gsp_clean</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;ComponentName&#39;</span><span class="p">,</span> <span class="s1">&#39;Description&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">gsp_clean</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>State</th>
      <th>FIPS</th>
      <th>Region</th>
      <th>Year</th>
      <th>value</th>
      <th>feature</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Alabama</td>
      <td>01000</td>
      <td>5</td>
      <td>1997</td>
      <td>104218</td>
      <td>Gross domestic product (GDP) by stateAll indus...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Alabama</td>
      <td>01000</td>
      <td>5</td>
      <td>1997</td>
      <td>87014</td>
      <td>Gross domestic product (GDP) by statePrivate i...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Alaska</td>
      <td>02000</td>
      <td>8</td>
      <td>1997</td>
      <td>25446</td>
      <td>Gross domestic product (GDP) by stateAll indus...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Alaska</td>
      <td>02000</td>
      <td>8</td>
      <td>1997</td>
      <td>20284</td>
      <td>Gross domestic product (GDP) by statePrivate i...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Arizona</td>
      <td>04000</td>
      <td>6</td>
      <td>1997</td>
      <td>132708</td>
      <td>Gross domestic product (GDP) by stateAll indus...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2695</th>
      <td>Virginia</td>
      <td>51000</td>
      <td>5</td>
      <td>2014</td>
      <td>50861</td>
      <td>Per capita real GDP by stateAll industry total</td>
    </tr>
    <tr>
      <th>2696</th>
      <td>Washington</td>
      <td>53000</td>
      <td>8</td>
      <td>2014</td>
      <td>54773</td>
      <td>Per capita real GDP by stateAll industry total</td>
    </tr>
    <tr>
      <th>2697</th>
      <td>West Virginia</td>
      <td>54000</td>
      <td>5</td>
      <td>2014</td>
      <td>36234</td>
      <td>Per capita real GDP by stateAll industry total</td>
    </tr>
    <tr>
      <th>2698</th>
      <td>Wisconsin</td>
      <td>55000</td>
      <td>3</td>
      <td>2014</td>
      <td>46469</td>
      <td>Per capita real GDP by stateAll industry total</td>
    </tr>
    <tr>
      <th>2699</th>
      <td>Wyoming</td>
      <td>56000</td>
      <td>7</td>
      <td>2014</td>
      <td>61639</td>
      <td>Per capita real GDP by stateAll industry total</td>
    </tr>
  </tbody>
</table>
<p>2700 rows × 6 columns</p>
</div></div></div>
</div>
<p>To move these features from the rows to columns, apply the <code class="docutils literal notranslate"><span class="pre">.pivot_table()</span></code> method to a dataframe:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</pre></div>
</div>
<p>To understand this method, pay close attention to its parameters:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">index</span></code> - a list containing the names of the current columns that we want to remain columns in the reshaped data. These include the primary keys (<code class="docutils literal notranslate"><span class="pre">State</span></code> and <code class="docutils literal notranslate"><span class="pre">Year</span></code> in this example), synonyms for a key (<code class="docutils literal notranslate"><span class="pre">FIPS</span></code>), and features that vary only by ID (<code class="docutils literal notranslate"><span class="pre">Region</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">columns</span></code> - the name of the column that contains the <strong>names</strong> of the new columns we are trying to create.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">values</span></code> - the name of the column that contains the <strong>datapoints</strong> we are trying to move to the new columns.</p></li>
</ol>
<p>There is one important issue to keep in mind when using the <code class="docutils literal notranslate"><span class="pre">.pivot_table()</span></code> method. <code class="docutils literal notranslate"><span class="pre">.pivot_table()</span></code> contains default behavior to handle cases in which the keys in <code class="docutils literal notranslate"><span class="pre">index</span></code> do not uniquely identify the rows of a dataframe. By default, <code class="docutils literal notranslate"><span class="pre">.pivot_table()</span></code> takes the mean within group. If the column specified within <code class="docutils literal notranslate"><span class="pre">values</span></code> is non-numeric, however, the mean is not defined. So first make sure that any columns that are numeric are recognized as a numeric data type. If a column contains text, categories, or other non-numeric data, specify <code class="docutils literal notranslate"><span class="pre">aggfunc='first'</span></code> inside <code class="docutils literal notranslate"><span class="pre">.pivot_table()</span></code>. Writing <code class="docutils literal notranslate"><span class="pre">aggfunc='first'</span></code> tells <code class="docutils literal notranslate"><span class="pre">.pivot_table()</span></code> to use the first cell within a group instead of calculating the mean within a group, and the first cell is defined for non-numeric columns. If the columns in <code class="docutils literal notranslate"><span class="pre">index</span></code> do uniquely identify rows, there is only one cell per group anyway, so it is fine to take the first cell.</p>
<p>Presently within <code class="docutils literal notranslate"><span class="pre">gsp_clean</span></code> the datapoints are contained within the <code class="docutils literal notranslate"><span class="pre">value</span></code> column. Unfortunately, <code class="docutils literal notranslate"><span class="pre">value</span></code> is not currently understood to be numeric:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gsp_clean</span><span class="o">.</span><span class="n">dtypes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>State      object
FIPS       object
Region     object
Year       object
value      object
feature    object
dtype: object
</pre></div>
</div>
</div>
</div>
<p>Following our code from module 8, we convert value to a numeric class:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gsp_clean</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">gsp_clean</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
<span class="n">gsp_clean</span><span class="o">.</span><span class="n">dtypes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>State       object
FIPS        object
Region      object
Year        object
value      float64
feature     object
dtype: object
</pre></div>
</div>
</div>
</div>
<p>Now we can reshape the data with <code class="docutils literal notranslate"><span class="pre">.pivot_table()</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gsp_clean</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gsp_clean</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="c1"># first convert this column to int </span>
<span class="n">gsp_clean</span> <span class="o">=</span> <span class="n">gsp_clean</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;State&#39;</span><span class="p">,</span><span class="s1">&#39;FIPS&#39;</span><span class="p">,</span> <span class="s1">&#39;Region&#39;</span><span class="p">,</span><span class="s1">&#39;Year&#39;</span><span class="p">],</span> 
                                  <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;feature&#39;</span><span class="p">,</span> 
                                  <span class="n">values</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
<span class="n">gsp_clean</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th></th>
      <th>feature</th>
      <th>Gross domestic product (GDP) by stateAll industry total</th>
      <th>Gross domestic product (GDP) by statePrivate industries</th>
      <th>Per capita real GDP by stateAll industry total</th>
    </tr>
    <tr>
      <th>State</th>
      <th>FIPS</th>
      <th>Region</th>
      <th>Year</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">Alabama</th>
      <th rowspan="5" valign="top">01000</th>
      <th rowspan="5" valign="top">5</th>
      <th>1997</th>
      <td>104218</td>
      <td>87014</td>
      <td>31398</td>
    </tr>
    <tr>
      <th>1998</th>
      <td>109414</td>
      <td>91506</td>
      <td>32164</td>
    </tr>
    <tr>
      <th>1999</th>
      <td>115015</td>
      <td>96284</td>
      <td>33106</td>
    </tr>
    <tr>
      <th>2000</th>
      <td>119020</td>
      <td>99665</td>
      <td>33284</td>
    </tr>
    <tr>
      <th>2001</th>
      <td>122822</td>
      <td>102978</td>
      <td>33312</td>
    </tr>
    <tr>
      <th>...</th>
      <th>...</th>
      <th>...</th>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th rowspan="5" valign="top">Wyoming</th>
      <th rowspan="5" valign="top">56000</th>
      <th rowspan="5" valign="top">7</th>
      <th>2010</th>
      <td>39103</td>
      <td>33832</td>
      <td>64602</td>
    </tr>
    <tr>
      <th>2011</th>
      <td>41499</td>
      <td>36164</td>
      <td>63981</td>
    </tr>
    <tr>
      <th>2012</th>
      <td>40201</td>
      <td>34604</td>
      <td>60744</td>
    </tr>
    <tr>
      <th>2013</th>
      <td>40979</td>
      <td>35096</td>
      <td>60743</td>
    </tr>
    <tr>
      <th>2014</th>
      <td>42021</td>
      <td>35947</td>
      <td>61639</td>
    </tr>
  </tbody>
</table>
<p>900 rows × 3 columns</p>
</div></div></div>
</div>
<p>Alternatively, if we choose to leave the <code class="docutils literal notranslate"><span class="pre">value</span></code> column as an <code class="docutils literal notranslate"><span class="pre">object</span></code> data type, we can use this code instead to perform the wide-to-long reshape:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gsp_clean</span> <span class="o">=</span> <span class="n">gsp_clean</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;State&#39;</span><span class="p">,</span><span class="s1">&#39;FIPS&#39;</span><span class="p">,</span> <span class="s1">&#39;Region&#39;</span><span class="p">,</span><span class="s1">&#39;Year&#39;</span><span class="p">],</span> 
                                  <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;feature&#39;</span><span class="p">,</span> 
                                  <span class="n">values</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> 
                                  <span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that the dataframe is not formated in a flat way, because the IDs and related features are stored in the row-indices instead of in columns. To convert the dataframe back to a standard format, use the <code class="docutils literal notranslate"><span class="pre">.to_records()</span></code> method within the <code class="docutils literal notranslate"><span class="pre">pd.DataFrame()</span></code> function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gsp_clean</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">gsp_clean</span><span class="o">.</span><span class="n">to_records</span><span class="p">())</span>
<span class="n">gsp_clean</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>State</th>
      <th>FIPS</th>
      <th>Region</th>
      <th>Year</th>
      <th>Gross domestic product (GDP) by stateAll industry total</th>
      <th>Gross domestic product (GDP) by statePrivate industries</th>
      <th>Per capita real GDP by stateAll industry total</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Alabama</td>
      <td>01000</td>
      <td>5</td>
      <td>1997</td>
      <td>104218</td>
      <td>87014</td>
      <td>31398</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Alabama</td>
      <td>01000</td>
      <td>5</td>
      <td>1998</td>
      <td>109414</td>
      <td>91506</td>
      <td>32164</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Alabama</td>
      <td>01000</td>
      <td>5</td>
      <td>1999</td>
      <td>115015</td>
      <td>96284</td>
      <td>33106</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Alabama</td>
      <td>01000</td>
      <td>5</td>
      <td>2000</td>
      <td>119020</td>
      <td>99665</td>
      <td>33284</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Alabama</td>
      <td>01000</td>
      <td>5</td>
      <td>2001</td>
      <td>122822</td>
      <td>102978</td>
      <td>33312</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>895</th>
      <td>Wyoming</td>
      <td>56000</td>
      <td>7</td>
      <td>2010</td>
      <td>39103</td>
      <td>33832</td>
      <td>64602</td>
    </tr>
    <tr>
      <th>896</th>
      <td>Wyoming</td>
      <td>56000</td>
      <td>7</td>
      <td>2011</td>
      <td>41499</td>
      <td>36164</td>
      <td>63981</td>
    </tr>
    <tr>
      <th>897</th>
      <td>Wyoming</td>
      <td>56000</td>
      <td>7</td>
      <td>2012</td>
      <td>40201</td>
      <td>34604</td>
      <td>60744</td>
    </tr>
    <tr>
      <th>898</th>
      <td>Wyoming</td>
      <td>56000</td>
      <td>7</td>
      <td>2013</td>
      <td>40979</td>
      <td>35096</td>
      <td>60743</td>
    </tr>
    <tr>
      <th>899</th>
      <td>Wyoming</td>
      <td>56000</td>
      <td>7</td>
      <td>2014</td>
      <td>42021</td>
      <td>35947</td>
      <td>61639</td>
    </tr>
  </tbody>
</table>
<p>900 rows × 7 columns</p>
</div></div></div>
</div>
<p>All that’s left to clean the data is to rename the columns and to create a new column containing the percent of the state’s GDP that comes from private industry:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gsp_clean</span> <span class="o">=</span> <span class="n">gsp_clean</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;Gross domestic product (GDP) by stateAll industry total&#39;</span><span class="p">:</span><span class="s1">&#39;GDP&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;Gross domestic product (GDP) by statePrivate industries&#39;</span><span class="p">:</span><span class="s1">&#39;GDPprivate&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;Per capita real GDP by stateAll industry total&#39;</span><span class="p">:</span><span class="s1">&#39;GDPpc&#39;</span><span class="p">},</span> 
                             <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">gsp_clean</span> <span class="o">=</span> <span class="n">gsp_clean</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">percent_private</span> <span class="o">=</span> <span class="mi">100</span><span class="o">*</span> <span class="n">gsp_clean</span><span class="o">.</span><span class="n">GDPprivate</span> <span class="o">/</span> <span class="n">gsp_clean</span><span class="o">.</span><span class="n">GDP</span><span class="p">)</span>
<span class="n">gsp_clean</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>State</th>
      <th>FIPS</th>
      <th>Region</th>
      <th>Year</th>
      <th>GDP</th>
      <th>GDPprivate</th>
      <th>GDPpc</th>
      <th>percent_private</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Alabama</td>
      <td>01000</td>
      <td>5</td>
      <td>1997</td>
      <td>104218</td>
      <td>87014</td>
      <td>31398</td>
      <td>83.492295</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Alabama</td>
      <td>01000</td>
      <td>5</td>
      <td>1998</td>
      <td>109414</td>
      <td>91506</td>
      <td>32164</td>
      <td>83.632808</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Alabama</td>
      <td>01000</td>
      <td>5</td>
      <td>1999</td>
      <td>115015</td>
      <td>96284</td>
      <td>33106</td>
      <td>83.714298</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Alabama</td>
      <td>01000</td>
      <td>5</td>
      <td>2000</td>
      <td>119020</td>
      <td>99665</td>
      <td>33284</td>
      <td>83.738027</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Alabama</td>
      <td>01000</td>
      <td>5</td>
      <td>2001</td>
      <td>122822</td>
      <td>102978</td>
      <td>33312</td>
      <td>83.843285</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>895</th>
      <td>Wyoming</td>
      <td>56000</td>
      <td>7</td>
      <td>2010</td>
      <td>39103</td>
      <td>33832</td>
      <td>64602</td>
      <td>86.520216</td>
    </tr>
    <tr>
      <th>896</th>
      <td>Wyoming</td>
      <td>56000</td>
      <td>7</td>
      <td>2011</td>
      <td>41499</td>
      <td>36164</td>
      <td>63981</td>
      <td>87.144269</td>
    </tr>
    <tr>
      <th>897</th>
      <td>Wyoming</td>
      <td>56000</td>
      <td>7</td>
      <td>2012</td>
      <td>40201</td>
      <td>34604</td>
      <td>60744</td>
      <td>86.077461</td>
    </tr>
    <tr>
      <th>898</th>
      <td>Wyoming</td>
      <td>56000</td>
      <td>7</td>
      <td>2013</td>
      <td>40979</td>
      <td>35096</td>
      <td>60743</td>
      <td>85.643866</td>
    </tr>
    <tr>
      <th>899</th>
      <td>Wyoming</td>
      <td>56000</td>
      <td>7</td>
      <td>2014</td>
      <td>42021</td>
      <td>35947</td>
      <td>61639</td>
      <td>85.545323</td>
    </tr>
  </tbody>
</table>
<p>900 rows × 8 columns</p>
</div></div></div>
</div>
</section>
</section>
<section id="working-with-strings-example-the-2019-anes-pilot-study">
<h2><a class="toc-backref" href="#id12" role="doc-backlink"><span class="section-number">9.4. </span>Working with Strings (Example: the 2019 ANES Pilot Study)</a><a class="headerlink" href="#working-with-strings-example-the-2019-anes-pilot-study" title="Permalink to this heading">#</a></h2>
<p>In module 8, we worked with the 2019 American National Election Study pilot survey and saved the cleaned data in a separate CSV file:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">anes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://github.com/jkropko/DS-6001/raw/master/localdata/anes_clean.csv&quot;</span><span class="p">)</span>
<span class="n">anes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>caseid</th>
      <th>liveurban</th>
      <th>vote16</th>
      <th>protest</th>
      <th>vote</th>
      <th>most_important_issue</th>
      <th>confecon</th>
      <th>ideology</th>
      <th>partyID</th>
      <th>universal_income</th>
      <th>...</th>
      <th>partisanship</th>
      <th>ftbiden_level</th>
      <th>age</th>
      <th>age2</th>
      <th>ftbiden_float</th>
      <th>ftbiden_cat</th>
      <th>ftbiden_str</th>
      <th>prefersbiden</th>
      <th>worried_econ</th>
      <th>favor_both</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Suburb</td>
      <td>Someone else</td>
      <td>False</td>
      <td>Joe Biden</td>
      <td>Health Care</td>
      <td>A little worried</td>
      <td>Conservative</td>
      <td>Democrat</td>
      <td>Favor a moderate amount</td>
      <td>...</td>
      <td>5.0</td>
      <td>neutral</td>
      <td>51</td>
      <td>2601</td>
      <td>52.0</td>
      <td>52.0</td>
      <td>52.0</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>Suburb</td>
      <td>Donald Trump</td>
      <td>False</td>
      <td>Donald Trump</td>
      <td>Working together</td>
      <td>A little worried</td>
      <td>Conservative</td>
      <td>Republican</td>
      <td>Oppose a moderate amount</td>
      <td>...</td>
      <td>0.0</td>
      <td>neutral</td>
      <td>78</td>
      <td>6084</td>
      <td>41.0</td>
      <td>41.0</td>
      <td>41.0</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>Rural</td>
      <td>Hillary Clinton</td>
      <td>False</td>
      <td>Joe Biden</td>
      <td>health care</td>
      <td>Extremely worried</td>
      <td>Moderate</td>
      <td>Democrat</td>
      <td>Neither favor nor oppose</td>
      <td>...</td>
      <td>88.0</td>
      <td>like</td>
      <td>66</td>
      <td>4356</td>
      <td>88.0</td>
      <td>88.0</td>
      <td>88.0</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>City</td>
      <td>Hillary Clinton</td>
      <td>False</td>
      <td>Donald Trump</td>
      <td>The economy.</td>
      <td>A little worried</td>
      <td>Moderate</td>
      <td>Democrat</td>
      <td>Neither favor nor oppose</td>
      <td>...</td>
      <td>-100.0</td>
      <td>dislike</td>
      <td>41</td>
      <td>1681</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>City</td>
      <td>Donald Trump</td>
      <td>False</td>
      <td>Donald Trump</td>
      <td>China</td>
      <td>Not at all worried</td>
      <td>Conservative</td>
      <td>Republican</td>
      <td>Oppose a great deal</td>
      <td>...</td>
      <td>-69.0</td>
      <td>dislike</td>
      <td>80</td>
      <td>6400</td>
      <td>25.0</td>
      <td>25.0</td>
      <td>25.0</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>3160</th>
      <td>3161</td>
      <td>Town</td>
      <td>Donald Trump</td>
      <td>False</td>
      <td>Donald Trump</td>
      <td>The infiltration of Marxists into the institut...</td>
      <td>A little worried</td>
      <td>Conservative</td>
      <td>Republican</td>
      <td>Oppose a great deal</td>
      <td>...</td>
      <td>-74.0</td>
      <td>dislike</td>
      <td>72</td>
      <td>5184</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>3161</th>
      <td>3162</td>
      <td>City</td>
      <td>Someone else</td>
      <td>False</td>
      <td>Someone else</td>
      <td>Lack of basic resources being provided and off...</td>
      <td>Extremely worried</td>
      <td>NaN</td>
      <td>Democrat</td>
      <td>Favor a great deal</td>
      <td>...</td>
      <td>-10.0</td>
      <td>dislike</td>
      <td>24</td>
      <td>576</td>
      <td>25.0</td>
      <td>25.0</td>
      <td>25.0</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
    </tr>
    <tr>
      <th>3162</th>
      <td>3163</td>
      <td>City</td>
      <td>Did not vote</td>
      <td>False</td>
      <td>Probably will not vote</td>
      <td>donald trump</td>
      <td>Very worried</td>
      <td>Liberal</td>
      <td>Independent</td>
      <td>Oppose a great deal</td>
      <td>...</td>
      <td>44.0</td>
      <td>neutral</td>
      <td>40</td>
      <td>1600</td>
      <td>50.0</td>
      <td>50.0</td>
      <td>50.0</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>3163</th>
      <td>3164</td>
      <td>Suburb</td>
      <td>Did not vote</td>
      <td>False</td>
      <td>Joe Biden</td>
      <td>Donald Trump</td>
      <td>Moderately worried</td>
      <td>Liberal</td>
      <td>Democrat</td>
      <td>Favor a moderate amount</td>
      <td>...</td>
      <td>94.0</td>
      <td>like</td>
      <td>60</td>
      <td>3600</td>
      <td>95.0</td>
      <td>95.0</td>
      <td>95.0</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
    </tr>
    <tr>
      <th>3164</th>
      <td>3165</td>
      <td>Town</td>
      <td>Hillary Clinton</td>
      <td>False</td>
      <td>Joe Biden</td>
      <td>trump</td>
      <td>Extremely worried</td>
      <td>Moderate</td>
      <td>Democrat</td>
      <td>Oppose a great deal</td>
      <td>...</td>
      <td>70.0</td>
      <td>neutral</td>
      <td>60</td>
      <td>3600</td>
      <td>70.0</td>
      <td>70.0</td>
      <td>70.0</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
<p>3165 rows × 62 columns</p>
</div></div></div>
</div>
<p>The data contain a column <code class="docutils literal notranslate"><span class="pre">most_important_issue</span></code> which records individuals’ responses to the question of what they feel is the most important issue facing the United States as of December 2019. These responses are in the respondents’ own words. For example, one response is</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">anes</span><span class="o">.</span><span class="n">most_important_issue</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;The influence of big money on our political system both domestic and foreign&#39;
</pre></div>
</div>
</div>
</div>
<p>These responses are strings, and we can employ the suite of string operations to manipulate the data in this column. String methods are contained in the <code class="docutils literal notranslate"><span class="pre">.str</span></code> module of <code class="docutils literal notranslate"><span class="pre">pandas</span></code>, and we will have to call the <code class="docutils literal notranslate"><span class="pre">.str</span></code> attribute in order to use string methods.</p>
<p>One important technique is to alter the case within the text so that we can identify words without worrying about case sensitivity. To turn all responses to lowercase, use <code class="docutils literal notranslate"><span class="pre">.str.lower()</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">anes</span><span class="o">.</span><span class="n">most_important_issue</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0                                             health care
1                                        working together
2                                             health care
3                                            the economy.
4                                                   china
                              ...                        
3160    the infiltration of marxists into the institut...
3161    lack of basic resources being provided and off...
3162                                         donald trump
3163                                         donald trump
3164                                                trump
Name: most_important_issue, Length: 3165, dtype: object
</pre></div>
</div>
</div>
</div>
<p>And to turn all the text to uppercase, use <code class="docutils literal notranslate"><span class="pre">.str.upper()</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">anes</span><span class="o">.</span><span class="n">most_important_issue</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0                                             HEALTH CARE
1                                        WORKING TOGETHER
2                                             HEALTH CARE
3                                            THE ECONOMY.
4                                                   CHINA
                              ...                        
3160    THE INFILTRATION OF MARXISTS INTO THE INSTITUT...
3161    LACK OF BASIC RESOURCES BEING PROVIDED AND OFF...
3162                                         DONALD TRUMP
3163                                         DONALD TRUMP
3164                                                TRUMP
Name: most_important_issue, Length: 3165, dtype: object
</pre></div>
</div>
</div>
</div>
<p>One issue that can inhibit our ability to search through text is the existence of leading and trailing whitespace in the responses. White space can exist, invisibily, for several reasons. It is possible that the data authors included white space in order to standardize the number of spaces that the column takes up in the data file. To remove both leading and trailing white spaces, use <code class="docutils literal notranslate"><span class="pre">.str.strip()</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">anes</span><span class="o">.</span><span class="n">most_important_issue</span> <span class="o">=</span> <span class="n">anes</span><span class="o">.</span><span class="n">most_important_issue</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">str.replace()</span></code> method finds and replaces specific whole strings with different strings. For example, we can replace every response that reads “health care” with “hospital stuff”:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">anes</span><span class="o">.</span><span class="n">most_important_issue</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;health care&#39;</span><span class="p">,</span> <span class="s1">&#39;hospital stuff&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0                                          hospital stuff
1                                        working together
2                                          hospital stuff
3                                            the economy.
4                                                   china
                              ...                        
3160    the infiltration of marxists into the institut...
3161    lack of basic resources being provided and off...
3162                                         donald trump
3163                                         donald trump
3164                                                trump
Name: most_important_issue, Length: 3165, dtype: object
</pre></div>
</div>
</div>
</div>
<p>If we want to replace pieces of these strings, we can specify the <code class="docutils literal notranslate"><span class="pre">regex=True</span></code> argument. The following line of code replaces all occurrences of “trump” when the strings are converted to lowercase to “twimp”. With <code class="docutils literal notranslate"><span class="pre">regex=True</span></code>, the method replaces the pattern “trump” anywhere it appears, as opposed to the default <code class="docutils literal notranslate"><span class="pre">regex=False</span></code> which only replaces entire entries that are exactly “trump”:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">anes</span><span class="o">.</span><span class="n">most_important_issue</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;trump&#39;</span><span class="p">,</span> <span class="s1">&#39;twimp&#39;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0                                             health care
1                                        working together
2                                             health care
3                                            the economy.
4                                                   china
                              ...                        
3160    the infiltration of marxists into the institut...
3161    lack of basic resources being provided and off...
3162                                         donald twimp
3163                                         donald twimp
3164                                                twimp
Name: most_important_issue, Length: 3165, dtype: object
</pre></div>
</div>
</div>
</div>
<p>To create a new column that identifies when particular words are used, use either the <code class="docutils literal notranslate"><span class="pre">.str.match()</span></code> or <code class="docutils literal notranslate"><span class="pre">.str.contains()</span></code> method. <code class="docutils literal notranslate"><span class="pre">.str.match()</span></code> is true if the entire entry matches the provided string,</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">anes</span><span class="o">.</span><span class="n">most_important_issue</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;trump&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0       False
1       False
2       False
3       False
4       False
        ...  
3160    False
3161    False
3162    False
3163    False
3164     True
Name: most_important_issue, Length: 3165, dtype: object
</pre></div>
</div>
</div>
</div>
<p>and <code class="docutils literal notranslate"><span class="pre">.str.contains()</span></code> is true if the provided string exists anywhere within the entry.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">anes</span><span class="o">.</span><span class="n">most_important_issue</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;trump&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0       False
1       False
2       False
3       False
4       False
        ...  
3160    False
3161    False
3162     True
3163     True
3164     True
Name: most_important_issue, Length: 3165, dtype: object
</pre></div>
</div>
</div>
</div>
<p>These columns of logical values can be placed into the data to filter or for other purposes. For example, we can see the number of Democrats, Republicans, and independents who use the word “trump” in their statement of the country’s most important problem:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">anes</span><span class="p">[</span><span class="s1">&#39;problem_trump&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">anes</span><span class="o">.</span><span class="n">most_important_issue</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;trump&#39;</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">anes</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;partyID&#39;</span><span class="p">,</span> <span class="s1">&#39;problem_trump&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>problem_trump</th>
      <th>False</th>
      <th>True</th>
    </tr>
    <tr>
      <th>partyID</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Democrat</th>
      <td>1029</td>
      <td>293</td>
    </tr>
    <tr>
      <th>Independent</th>
      <td>479</td>
      <td>47</td>
    </tr>
    <tr>
      <th>Republican</th>
      <td>1121</td>
      <td>73</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">.str.replace()</span></code>, <code class="docutils literal notranslate"><span class="pre">.str.match()</span></code>, and <code class="docutils literal notranslate"><span class="pre">.str.contains()</span></code> methods can also accept regular expressions for identifying additional patterns within the string. Regular expressions are beyond our scope in this document, but here is a <a class="reference external" href="https://docs.python.org/2/howto/regex.html">good discussion of regular expressions in Python</a>.</p>
<p>To calculate the length of each response in terms of the number of characters, use <code class="docutils literal notranslate"><span class="pre">.str.len()</span></code>. In this case, it is important to make sure the whitespace is removed first with <code class="docutils literal notranslate"><span class="pre">.str.strip()</span></code>, otherwise the spaces will count towards the length:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">anes</span><span class="o">.</span><span class="n">most_important_issue</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">len</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0        11.0
1        16.0
2        11.0
3        12.0
4         5.0
        ...  
3160    254.0
3161    325.0
3162     12.0
3163     12.0
3164      5.0
Name: most_important_issue, Length: 3165, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>We can use the length to display, for example, the single longest response in the data. To display the whole string, turn off the display limit by typing <code class="docutils literal notranslate"><span class="pre">pd.options.display.max_colwidth</span> <span class="pre">=</span> <span class="pre">None</span></code>. Here I set the limit to 500, because it sort of goes off the rails and I’d rather not display it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">anes</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">anes</span><span class="o">.</span><span class="n">most_important_issue</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">len</span><span class="p">()</span>
<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">max_colwidth</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">anes</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span> <span class="o">=</span> <span class="s1">&#39;length&#39;</span><span class="p">,</span> <span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">most_important_issue</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>819    Immigration has been and has become a very big problem. The gangs, drug wars, the crime has climbed in every single town, county, state in this country and I believe it all revolves around too many different races, too many prejudices. Most people I talk to dislike foreigners and most foreigners hate Americans. We ask, why come here then? Because they get financial aid, housing, medical, dental aid and compared to the wars, poverty and the way they lived in their own country, America is heav...
Name: most_important_issue, dtype: object
</pre></div>
</div>
</div>
</div>
<p>After all that, we set the string display limit back to the default of 50 characters:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">max_colwidth</span> <span class="o">=</span> <span class="mi">50</span>
</pre></div>
</div>
</div>
</div>
<p>In some cases it might be necessary to split entries into different features according to a delimiter or pattern. It doesn’t make sense to split the <code class="docutils literal notranslate"><span class="pre">most_important_problem</span></code> column in this example, but as an illiustration, we can split the responses on periods:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">anes</span><span class="o">.</span><span class="n">most_important_issue</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0                                           [Health Care]
1                                      [Working together]
2                                           [health care]
3                                         [The economy, ]
4                                                 [China]
                              ...                        
3160    [The infiltration of Marxists into the institu...
3161    [Lack of basic resources being provided and of...
3162                                       [donald trump]
3163                                       [Donald Trump]
3164                                              [trump]
Name: most_important_issue, Length: 3165, dtype: object
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">expand=True</span></code> argument displays these split strings in different columns in a dataframe:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">anes</span><span class="o">.</span><span class="n">most_important_issue</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>...</th>
      <th>19</th>
      <th>20</th>
      <th>21</th>
      <th>22</th>
      <th>23</th>
      <th>24</th>
      <th>25</th>
      <th>26</th>
      <th>27</th>
      <th>28</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Health Care</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>...</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Working together</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>...</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>2</th>
      <td>health care</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>...</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>3</th>
      <td>The economy</td>
      <td></td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>...</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>4</th>
      <td>China</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>...</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>3160</th>
      <td>The infiltration of Marxists into the institut...</td>
      <td>Money seems to be no object to them</td>
      <td>Their over promising will lead to eventual chaos</td>
      <td>Usually that leads to the over promised event...</td>
      <td></td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>...</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>3161</th>
      <td>Lack of basic resources being provided and off...</td>
      <td>This is a first world nation, a nation claimi...</td>
      <td>yet we don't have housing or healthcare secur...</td>
      <td>That needs to change and it needs to be chang...</td>
      <td>A basic standard of living needs to be guaran...</td>
      <td></td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>...</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>3162</th>
      <td>donald trump</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>...</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>3163</th>
      <td>Donald Trump</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>...</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>3164</th>
      <td>trump</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>...</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
<p>3165 rows × 29 columns</p>
</div></div></div>
</div>
<p>Writing <code class="docutils literal notranslate"><span class="pre">n=1</span></code> only splits on the first occurrence of the delimiter, <code class="docutils literal notranslate"><span class="pre">n=2</span></code> splits on the first and second occurrence, and so on:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">anes</span><span class="o">.</span><span class="n">most_important_issue</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Health Care</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Working together</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>2</th>
      <td>health care</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>3</th>
      <td>The economy</td>
      <td></td>
      <td>None</td>
    </tr>
    <tr>
      <th>4</th>
      <td>China</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>3160</th>
      <td>The infiltration of Marxists into the institut...</td>
      <td>Money seems to be no object to them</td>
      <td>Their over promising will lead to eventual ch...</td>
    </tr>
    <tr>
      <th>3161</th>
      <td>Lack of basic resources being provided and off...</td>
      <td>This is a first world nation, a nation claimi...</td>
      <td>yet we don't have housing or healthcare secur...</td>
    </tr>
    <tr>
      <th>3162</th>
      <td>donald trump</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>3163</th>
      <td>Donald Trump</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>3164</th>
      <td>trump</td>
      <td>None</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
<p>3165 rows × 3 columns</p>
</div></div></div>
</div>
<p>An individual string can be indexed according to character number. These indices can be applied to every entry in a string column as well. To pull just the first five characters out of each response in <code class="docutils literal notranslate"><span class="pre">most_important_issue</span></code>, we can type:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">anes</span><span class="o">.</span><span class="n">most_important_issue</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0       Healt
1       Worki
2       healt
3       The e
4       China
        ...  
3160    The i
3161    Lack 
3162    donal
3163    Donal
3164    trump
Name: most_important_issue, Length: 3165, dtype: object
</pre></div>
</div>
</div>
</div>
<p>To pull characters 6 through 10, we type</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">anes</span><span class="o">.</span><span class="n">most_important_issue</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">11</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0        Care
1       g tog
2        care
3       onomy
4            
        ...  
3160    filtr
3161    f bas
3162     trum
3163     Trum
3164         
Name: most_important_issue, Length: 3165, dtype: object
</pre></div>
</div>
</div>
</div>
<p>To pull the last four characters, use a negative number to begin the range, and leave the end of the range blank:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">anes</span><span class="o">.</span><span class="n">most_important_issue</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0       Care
1       ther
2       care
3       omy.
4       hina
        ... 
3160    ers.
3161    eed.
3162    rump
3163    rump
3164    rump
Name: most_important_issue, Length: 3165, dtype: object
</pre></div>
</div>
</div>
</div>
</section>
<section id="working-with-dates-and-times-example-twitter">
<h2><a class="toc-backref" href="#id13" role="doc-backlink"><span class="section-number">9.5. </span>Working with Dates and Times (Example: Twitter)</a><a class="headerlink" href="#working-with-dates-and-times-example-twitter" title="Permalink to this heading">#</a></h2>
<p>In module 4 we discussed Twitter as an example of how to use an API in Python. We save the four credentials we need to access the API (the consumer key, the consumer secret, the access token, and the access token secret) in a .env file, and we load those keys into Python without displaying them in our notebooks by using the <code class="docutils literal notranslate"><span class="pre">dotenv</span></code> package:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dotenv</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;/Users/jk8sd/Box Sync/Practice and Applications 1 online/Module 9 - Data Managenent in pandas Part 2&#39;</span><span class="p">)</span>
<span class="n">dotenv</span><span class="o">.</span><span class="n">load_dotenv</span><span class="p">()</span>
<span class="n">ConsumerKey</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;ConsumerKey&#39;</span><span class="p">)</span>
<span class="n">ConsumerSecret</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;ConsumerSecret&#39;</span><span class="p">)</span>
<span class="n">AccessToken</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;AccessToken&#39;</span><span class="p">)</span>
<span class="n">AccessTokenSecret</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;AccessTokenSecret&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Then we use the <code class="docutils literal notranslate"><span class="pre">tweepy</span></code> package to work with the Twitter API and we create a Twitter cursor with our credentials:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tweepy</span>
<span class="n">auth</span> <span class="o">=</span> <span class="n">tweepy</span><span class="o">.</span><span class="n">OAuthHandler</span><span class="p">(</span><span class="n">ConsumerKey</span><span class="p">,</span> <span class="n">ConsumerSecret</span><span class="p">)</span>
<span class="n">auth</span><span class="o">.</span><span class="n">set_access_token</span><span class="p">(</span><span class="n">AccessToken</span><span class="p">,</span> <span class="n">AccessTokenSecret</span><span class="p">)</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">tweepy</span><span class="o">.</span><span class="n">API</span><span class="p">(</span><span class="n">auth</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">58</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="kn">import</span> <span class="nn">tweepy</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">auth</span> <span class="o">=</span> <span class="n">tweepy</span><span class="o">.</span><span class="n">OAuthHandler</span><span class="p">(</span><span class="n">ConsumerKey</span><span class="p">,</span> <span class="n">ConsumerSecret</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">auth</span><span class="o">.</span><span class="n">set_access_token</span><span class="p">(</span><span class="n">AccessToken</span><span class="p">,</span> <span class="n">AccessTokenSecret</span><span class="p">)</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;tweepy&#39;
</pre></div>
</div>
</div>
</div>
<p>The following code extracts 1000 tweets that contain the hashtag “#uva”:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">msgs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">msg</span> <span class="o">=</span><span class="p">[]</span>

<span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">tweepy</span><span class="o">.</span><span class="n">Cursor</span><span class="p">(</span><span class="n">api</span><span class="o">.</span><span class="n">search</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="s1">&#39;#uva&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="p">[</span><span class="n">tweet</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">tweet</span><span class="o">.</span><span class="n">created_at</span><span class="p">,</span> <span class="n">tweet</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">screen_name</span><span class="p">]</span> 
    <span class="n">msg</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>                    
    <span class="n">msgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

<span class="n">tweets</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">msgs</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="s1">&#39;created_at&#39;</span><span class="p">,</span> <span class="s1">&#39;user&#39;</span><span class="p">])</span>
<span class="n">tweets</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>text</th>
      <th>created_at</th>
      <th>user</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>@KymoraJohnson_ let me call @IamTinaThompson s...</td>
      <td>2020-06-30 02:20:43</td>
      <td>SweetLickKing</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Congrats Eric. It’s was really great to have w...</td>
      <td>2020-06-30 02:18:17</td>
      <td>Daniel_B_Ennis</td>
    </tr>
    <tr>
      <th>2</th>
      <td>RT @KathrynsScGifts: "OGX Fade-defying + Orchi...</td>
      <td>2020-06-30 01:55:02</td>
      <td>blimeyonline1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Former #UVA stars Quin Blanding, Micah Kiser n...</td>
      <td>2020-06-30 01:40:00</td>
      <td>Wahoos247</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Former #UVA stars Quin Blanding, Micah Kiser n...</td>
      <td>2020-06-30 01:39:42</td>
      <td>JamieOakes247</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>995</th>
      <td>RT @AgNPalabras: #UVA: 54,87. Sube 0,20% diari...</td>
      <td>2020-06-23 15:12:08</td>
      <td>norahlfy</td>
    </tr>
    <tr>
      <th>996</th>
      <td>#UVA: 54,87. Sube 0,20% diario, 1,22% en junio...</td>
      <td>2020-06-23 15:08:40</td>
      <td>AgNPalabras</td>
    </tr>
    <tr>
      <th>997</th>
      <td>Zur Einstimmung #UVA vom letzten #gig bei uns ...</td>
      <td>2020-06-23 14:52:23</td>
      <td>WeAppU</td>
    </tr>
    <tr>
      <th>998</th>
      <td>RT @JLuis_Sommelier: #Mosto: jugo obtenido de ...</td>
      <td>2020-06-23 14:49:22</td>
      <td>VirialexViri</td>
    </tr>
    <tr>
      <th>999</th>
      <td>Good question... My instinct says Ty Jerome, b...</td>
      <td>2020-06-23 14:32:44</td>
      <td>The_Superhoo</td>
    </tr>
  </tbody>
</table>
<p>1000 rows × 3 columns</p>
</div></div></div>
</div>
<section id="extracting-year-month-day-and-time-from-a-timestamp-column">
<h3><a class="toc-backref" href="#id14" role="doc-backlink"><span class="section-number">9.5.1. </span>Extracting Year, Month, Day, and Time from a Timestamp Column</a><a class="headerlink" href="#extracting-year-month-day-and-time-from-a-timestamp-column" title="Permalink to this heading">#</a></h3>
<p>Note that the data contain timestamps that include the date and time, to the second, of each tweet. The <code class="docutils literal notranslate"><span class="pre">created_at</span></code> column has a <code class="docutils literal notranslate"><span class="pre">datetime64</span></code> data type:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tweets</span><span class="o">.</span><span class="n">dtypes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>text                  object
created_at    datetime64[ns]
user                  object
dtype: object
</pre></div>
</div>
</div>
</div>
<p>The difference between a <code class="docutils literal notranslate"><span class="pre">datetime64</span></code> data type and an <code class="docutils literal notranslate"><span class="pre">object</span></code> or numeric type is that we have the ability to extract individual elements of time from a <code class="docutils literal notranslate"><span class="pre">datetime64</span></code> value. To pull out the year, month, day, hour, minute, and second of the timestamp, we use the following attributes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">tweets</span><span class="o">.</span><span class="n">created_at</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">tweets</span><span class="o">.</span><span class="n">created_at</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> 
 <span class="n">tweets</span><span class="o">.</span><span class="n">created_at</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">tweets</span><span class="o">.</span><span class="n">created_at</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> 
 <span class="n">tweets</span><span class="o">.</span><span class="n">created_at</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">tweets</span><span class="o">.</span><span class="n">created_at</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">second</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[6, 30, 2020, 2, 20, 43]
</pre></div>
</div>
</div>
</div>
<p>The easiest way to create new columns with these elements for all the values in the dataframe is to use comprehension loops:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tweets</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">month</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tweets</span><span class="o">.</span><span class="n">created_at</span><span class="p">]</span>
<span class="n">tweets</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">day</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tweets</span><span class="o">.</span><span class="n">created_at</span><span class="p">]</span>
<span class="n">tweets</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">year</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tweets</span><span class="o">.</span><span class="n">created_at</span><span class="p">]</span>
<span class="n">tweets</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">hour</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tweets</span><span class="o">.</span><span class="n">created_at</span><span class="p">]</span>
<span class="n">tweets</span><span class="p">[</span><span class="s1">&#39;minute&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">minute</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tweets</span><span class="o">.</span><span class="n">created_at</span><span class="p">]</span>
<span class="n">tweets</span><span class="p">[</span><span class="s1">&#39;second&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">second</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tweets</span><span class="o">.</span><span class="n">created_at</span><span class="p">]</span>
<span class="n">tweets</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>text</th>
      <th>created_at</th>
      <th>user</th>
      <th>month</th>
      <th>day</th>
      <th>year</th>
      <th>hour</th>
      <th>minute</th>
      <th>second</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>@KymoraJohnson_ let me call @IamTinaThompson s...</td>
      <td>2020-06-30 02:20:43</td>
      <td>SweetLickKing</td>
      <td>6</td>
      <td>30</td>
      <td>2020</td>
      <td>2</td>
      <td>20</td>
      <td>43</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Congrats Eric. It’s was really great to have w...</td>
      <td>2020-06-30 02:18:17</td>
      <td>Daniel_B_Ennis</td>
      <td>6</td>
      <td>30</td>
      <td>2020</td>
      <td>2</td>
      <td>18</td>
      <td>17</td>
    </tr>
    <tr>
      <th>2</th>
      <td>RT @KathrynsScGifts: "OGX Fade-defying + Orchi...</td>
      <td>2020-06-30 01:55:02</td>
      <td>blimeyonline1</td>
      <td>6</td>
      <td>30</td>
      <td>2020</td>
      <td>1</td>
      <td>55</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Former #UVA stars Quin Blanding, Micah Kiser n...</td>
      <td>2020-06-30 01:40:00</td>
      <td>Wahoos247</td>
      <td>6</td>
      <td>30</td>
      <td>2020</td>
      <td>1</td>
      <td>40</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Former #UVA stars Quin Blanding, Micah Kiser n...</td>
      <td>2020-06-30 01:39:42</td>
      <td>JamieOakes247</td>
      <td>6</td>
      <td>30</td>
      <td>2020</td>
      <td>1</td>
      <td>39</td>
      <td>42</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>995</th>
      <td>RT @AgNPalabras: #UVA: 54,87. Sube 0,20% diari...</td>
      <td>2020-06-23 15:12:08</td>
      <td>norahlfy</td>
      <td>6</td>
      <td>23</td>
      <td>2020</td>
      <td>15</td>
      <td>12</td>
      <td>8</td>
    </tr>
    <tr>
      <th>996</th>
      <td>#UVA: 54,87. Sube 0,20% diario, 1,22% en junio...</td>
      <td>2020-06-23 15:08:40</td>
      <td>AgNPalabras</td>
      <td>6</td>
      <td>23</td>
      <td>2020</td>
      <td>15</td>
      <td>8</td>
      <td>40</td>
    </tr>
    <tr>
      <th>997</th>
      <td>Zur Einstimmung #UVA vom letzten #gig bei uns ...</td>
      <td>2020-06-23 14:52:23</td>
      <td>WeAppU</td>
      <td>6</td>
      <td>23</td>
      <td>2020</td>
      <td>14</td>
      <td>52</td>
      <td>23</td>
    </tr>
    <tr>
      <th>998</th>
      <td>RT @JLuis_Sommelier: #Mosto: jugo obtenido de ...</td>
      <td>2020-06-23 14:49:22</td>
      <td>VirialexViri</td>
      <td>6</td>
      <td>23</td>
      <td>2020</td>
      <td>14</td>
      <td>49</td>
      <td>22</td>
    </tr>
    <tr>
      <th>999</th>
      <td>Good question... My instinct says Ty Jerome, b...</td>
      <td>2020-06-23 14:32:44</td>
      <td>The_Superhoo</td>
      <td>6</td>
      <td>23</td>
      <td>2020</td>
      <td>14</td>
      <td>32</td>
      <td>44</td>
    </tr>
  </tbody>
</table>
<p>1000 rows × 9 columns</p>
</div></div></div>
</div>
</section>
<section id="generating-timestamps-from-separate-month-day-and-year-columns">
<h3><a class="toc-backref" href="#id15" role="doc-backlink"><span class="section-number">9.5.2. </span>Generating Timestamps from Separate Month, Day, and Year Columns</a><a class="headerlink" href="#generating-timestamps-from-separate-month-day-and-year-columns" title="Permalink to this heading">#</a></h3>
<p>Sometimes raw data will come to us with these time elements already placed in separate columns, so that we have a <code class="docutils literal notranslate"><span class="pre">month</span></code>, <code class="docutils literal notranslate"><span class="pre">day</span></code>, and <code class="docutils literal notranslate"><span class="pre">year</span></code> column but no <code class="docutils literal notranslate"><span class="pre">date</span></code> column. There are important advantages to placing all this information in one column in values that Python understands as timestamps: timestamps are easier to filter, manipulate, index, and plot. To create one timestamp from separate columns that contain the month, day, and year (and optionally the hour, minute, and second), use the <code class="docutils literal notranslate"><span class="pre">pd.to_datatime</span></code> function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">df</span></code> is a subset of the dataframe that contains the separate columns for the time elements. In order for this function to work, these columns must be named <code class="docutils literal notranslate"><span class="pre">year</span></code>, <code class="docutils literal notranslate"><span class="pre">month</span></code>, and <code class="docutils literal notranslate"><span class="pre">day</span></code>, and optionally <code class="docutils literal notranslate"><span class="pre">hour</span></code>, <code class="docutils literal notranslate"><span class="pre">minute</span></code>, and <code class="docutils literal notranslate"><span class="pre">second</span></code>. If these columns are named something else, first use the <code class="docutils literal notranslate"><span class="pre">.rename()</span></code> method to change the names to the ones listed above.</p>
<p>To create a timestamp from the individual time element columns, we can type:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tweets</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">tweets</span><span class="p">[[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="s1">&#39;hour&#39;</span><span class="p">,</span> <span class="s1">&#39;minute&#39;</span><span class="p">,</span> <span class="s1">&#39;second&#39;</span><span class="p">]])</span>
<span class="n">tweets</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>text</th>
      <th>created_at</th>
      <th>user</th>
      <th>month</th>
      <th>day</th>
      <th>year</th>
      <th>hour</th>
      <th>minute</th>
      <th>second</th>
      <th>timestamp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>@KymoraJohnson_ let me call @IamTinaThompson s...</td>
      <td>2020-06-30 02:20:43</td>
      <td>SweetLickKing</td>
      <td>6</td>
      <td>30</td>
      <td>2020</td>
      <td>2</td>
      <td>20</td>
      <td>43</td>
      <td>2020-06-30 02:20:43</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Congrats Eric. It’s was really great to have w...</td>
      <td>2020-06-30 02:18:17</td>
      <td>Daniel_B_Ennis</td>
      <td>6</td>
      <td>30</td>
      <td>2020</td>
      <td>2</td>
      <td>18</td>
      <td>17</td>
      <td>2020-06-30 02:18:17</td>
    </tr>
    <tr>
      <th>2</th>
      <td>RT @KathrynsScGifts: "OGX Fade-defying + Orchi...</td>
      <td>2020-06-30 01:55:02</td>
      <td>blimeyonline1</td>
      <td>6</td>
      <td>30</td>
      <td>2020</td>
      <td>1</td>
      <td>55</td>
      <td>2</td>
      <td>2020-06-30 01:55:02</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Former #UVA stars Quin Blanding, Micah Kiser n...</td>
      <td>2020-06-30 01:40:00</td>
      <td>Wahoos247</td>
      <td>6</td>
      <td>30</td>
      <td>2020</td>
      <td>1</td>
      <td>40</td>
      <td>0</td>
      <td>2020-06-30 01:40:00</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Former #UVA stars Quin Blanding, Micah Kiser n...</td>
      <td>2020-06-30 01:39:42</td>
      <td>JamieOakes247</td>
      <td>6</td>
      <td>30</td>
      <td>2020</td>
      <td>1</td>
      <td>39</td>
      <td>42</td>
      <td>2020-06-30 01:39:42</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>995</th>
      <td>RT @AgNPalabras: #UVA: 54,87. Sube 0,20% diari...</td>
      <td>2020-06-23 15:12:08</td>
      <td>norahlfy</td>
      <td>6</td>
      <td>23</td>
      <td>2020</td>
      <td>15</td>
      <td>12</td>
      <td>8</td>
      <td>2020-06-23 15:12:08</td>
    </tr>
    <tr>
      <th>996</th>
      <td>#UVA: 54,87. Sube 0,20% diario, 1,22% en junio...</td>
      <td>2020-06-23 15:08:40</td>
      <td>AgNPalabras</td>
      <td>6</td>
      <td>23</td>
      <td>2020</td>
      <td>15</td>
      <td>8</td>
      <td>40</td>
      <td>2020-06-23 15:08:40</td>
    </tr>
    <tr>
      <th>997</th>
      <td>Zur Einstimmung #UVA vom letzten #gig bei uns ...</td>
      <td>2020-06-23 14:52:23</td>
      <td>WeAppU</td>
      <td>6</td>
      <td>23</td>
      <td>2020</td>
      <td>14</td>
      <td>52</td>
      <td>23</td>
      <td>2020-06-23 14:52:23</td>
    </tr>
    <tr>
      <th>998</th>
      <td>RT @JLuis_Sommelier: #Mosto: jugo obtenido de ...</td>
      <td>2020-06-23 14:49:22</td>
      <td>VirialexViri</td>
      <td>6</td>
      <td>23</td>
      <td>2020</td>
      <td>14</td>
      <td>49</td>
      <td>22</td>
      <td>2020-06-23 14:49:22</td>
    </tr>
    <tr>
      <th>999</th>
      <td>Good question... My instinct says Ty Jerome, b...</td>
      <td>2020-06-23 14:32:44</td>
      <td>The_Superhoo</td>
      <td>6</td>
      <td>23</td>
      <td>2020</td>
      <td>14</td>
      <td>32</td>
      <td>44</td>
      <td>2020-06-23 14:32:44</td>
    </tr>
  </tbody>
</table>
<p>1000 rows × 10 columns</p>
</div></div></div>
</div>
<p>Like <code class="docutils literal notranslate"><span class="pre">created_at</span></code>, the new <code class="docutils literal notranslate"><span class="pre">timestamp</span></code> column is also of the <code class="docutils literal notranslate"><span class="pre">datetime64</span></code> data type:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tweets</span><span class="o">.</span><span class="n">dtypes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>text                  object
created_at    datetime64[ns]
user                  object
month                  int64
day                    int64
year                   int64
hour                   int64
minute                 int64
second                 int64
timestamp     datetime64[ns]
dtype: object
</pre></div>
</div>
</div>
</div>
</section>
<section id="converting-string-columns-to-timestamps">
<h3><a class="toc-backref" href="#id16" role="doc-backlink"><span class="section-number">9.5.3. </span>Converting String Columns to Timestamps</a><a class="headerlink" href="#converting-string-columns-to-timestamps" title="Permalink to this heading">#</a></h3>
<p>Sometimes information about the date and time of an event in the data will be coded as a string. In that case, to use the time series functionality on the dates in a dataframe, a string column that contains the dates and times will need to be converted to the <code class="docutils literal notranslate"><span class="pre">datetime64</span></code> data type. The best way to do that is to use the <code class="docutils literal notranslate"><span class="pre">pd.to_datetime()</span></code> function once again. This time, we pass the column that contains the dates in string format to the <code class="docutils literal notranslate"><span class="pre">pd.to_datetime()</span></code> function. This function can identify the year, month, day, hour, minute, and second from many different formats.</p>
<p>For example, we can write the date Sunday, June 19, 2016 at 8:00 PM (the date and time of game 7 of the 2016 NBA finals, the greatest moment in sports history) in many different ways such as:</p>
<ul class="simple">
<li><p>“Sunday, June 19, 2016, 8:00 PM”</p></li>
<li><p>“6-19-2016 8PM”</p></li>
<li><p>“6/19/16 8 p.m.”</p></li>
<li><p>“19/6/16 8pm”</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">pd.to_datetime()</span></code> function reads all of these formats:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s2">&quot;Sunday, June 19, 2016, 8:00 PM&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Timestamp(&#39;2016-06-19 20:00:00&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s2">&quot;6-19-2016 8PM&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Timestamp(&#39;2016-06-19 20:00:00&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s2">&quot;6/19/16 8 p.m.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Timestamp(&#39;2016-06-19 20:00:00&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s2">&quot;19/6/16 8pm&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Timestamp(&#39;2016-06-19 20:00:00&#39;)
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">pd.to_datetime()</span></code> function can feel like a magic trick because it automatically detects where the different elements of the date and time are located in the string. However, it can go wrong, and it is important to check that the date was correctly understood by <code class="docutils literal notranslate"><span class="pre">pd.to_datetime()</span></code>. Suppose for example that the date was June 19, 1945, coded as “6/19/45”. <code class="docutils literal notranslate"><span class="pre">pd.to_datetime()</span></code> reads the date as 2045:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s2">&quot;6/19/45&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Timestamp(&#39;2045-06-19 00:00:00&#39;)
</pre></div>
</div>
</div>
</div>
<p>The easiest way to fix this problem would be to break the timestamp up into separate columns for year, month, and day, subtract 100 from the years that were placed in the wrong century, and recombine these columns into a new timestamp with <code class="docutils literal notranslate"><span class="pre">pd.to_datetime()</span></code>. But the real danger here is assuming the <code class="docutils literal notranslate"><span class="pre">pd.to_datetime()</span></code> function worked without confirmation.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">pd.to_datetime()</span></code> function also works on an entire column of dates coded as strings. For example, let’s convert the <code class="docutils literal notranslate"><span class="pre">created_at</span></code> column to string:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tweets</span><span class="p">[</span><span class="s1">&#39;created_at&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tweets</span><span class="o">.</span><span class="n">created_at</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
<span class="n">tweets</span><span class="o">.</span><span class="n">dtypes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>text                  object
created_at            object
user                  object
month                  int64
day                    int64
year                   int64
hour                   int64
minute                 int64
second                 int64
timestamp     datetime64[ns]
dtype: object
</pre></div>
</div>
</div>
</div>
<p>To convert the <code class="docutils literal notranslate"><span class="pre">created_at</span></code> column back to a timestamp, we can apply <code class="docutils literal notranslate"><span class="pre">pd.to_dataframe()</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tweets</span><span class="p">[</span><span class="s1">&#39;created_at&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">tweets</span><span class="o">.</span><span class="n">created_at</span><span class="p">)</span>
<span class="n">tweets</span><span class="o">.</span><span class="n">dtypes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>text                  object
created_at    datetime64[ns]
user                  object
month                  int64
day                    int64
year                   int64
hour                   int64
minute                 int64
second                 int64
timestamp     datetime64[ns]
dtype: object
</pre></div>
</div>
</div>
</div>
</section>
<section id="filtering-rows-based-on-date-ranges">
<h3><a class="toc-backref" href="#id17" role="doc-backlink"><span class="section-number">9.5.4. </span>Filtering Rows Based on Date Ranges</a><a class="headerlink" href="#filtering-rows-based-on-date-ranges" title="Permalink to this heading">#</a></h3>
<p>If every row in the data has a unique timestamp, then one convenient way to use the times to filter the data is to set the <strong>index</strong> (the row labels) to be equal to the timestamps:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tweets</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">tweets</span><span class="p">[</span><span class="s1">&#39;created_at&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">pandas</span></code> dataframe uses <code class="docutils literal notranslate"><span class="pre">pd.to_datetime()</span></code> to read dates and times in many formats, and we can pass any of these formats to the index of <code class="docutils literal notranslate"><span class="pre">tweets</span></code>. For example, to see all the tweets made on June 30, we can type:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tweets</span><span class="p">[</span><span class="s1">&#39;June 30, 2020&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>text</th>
      <th>created_at</th>
      <th>user</th>
      <th>month</th>
      <th>day</th>
      <th>year</th>
      <th>hour</th>
      <th>minute</th>
      <th>second</th>
      <th>timestamp</th>
    </tr>
    <tr>
      <th>created_at</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020-06-30 02:20:43</th>
      <td>@KymoraJohnson_ let me call @IamTinaThompson s...</td>
      <td>2020-06-30 02:20:43</td>
      <td>SweetLickKing</td>
      <td>6</td>
      <td>30</td>
      <td>2020</td>
      <td>2</td>
      <td>20</td>
      <td>43</td>
      <td>2020-06-30 02:20:43</td>
    </tr>
    <tr>
      <th>2020-06-30 02:18:17</th>
      <td>Congrats Eric. It’s was really great to have w...</td>
      <td>2020-06-30 02:18:17</td>
      <td>Daniel_B_Ennis</td>
      <td>6</td>
      <td>30</td>
      <td>2020</td>
      <td>2</td>
      <td>18</td>
      <td>17</td>
      <td>2020-06-30 02:18:17</td>
    </tr>
    <tr>
      <th>2020-06-30 01:55:02</th>
      <td>RT @KathrynsScGifts: "OGX Fade-defying + Orchi...</td>
      <td>2020-06-30 01:55:02</td>
      <td>blimeyonline1</td>
      <td>6</td>
      <td>30</td>
      <td>2020</td>
      <td>1</td>
      <td>55</td>
      <td>2</td>
      <td>2020-06-30 01:55:02</td>
    </tr>
    <tr>
      <th>2020-06-30 01:40:00</th>
      <td>Former #UVA stars Quin Blanding, Micah Kiser n...</td>
      <td>2020-06-30 01:40:00</td>
      <td>Wahoos247</td>
      <td>6</td>
      <td>30</td>
      <td>2020</td>
      <td>1</td>
      <td>40</td>
      <td>0</td>
      <td>2020-06-30 01:40:00</td>
    </tr>
    <tr>
      <th>2020-06-30 01:39:42</th>
      <td>Former #UVA stars Quin Blanding, Micah Kiser n...</td>
      <td>2020-06-30 01:39:42</td>
      <td>JamieOakes247</td>
      <td>6</td>
      <td>30</td>
      <td>2020</td>
      <td>1</td>
      <td>39</td>
      <td>42</td>
      <td>2020-06-30 01:39:42</td>
    </tr>
    <tr>
      <th>2020-06-30 01:30:45</th>
      <td>RT @ThinakaranLK: சில இடங்களில் மழை பெய்யும் ச...</td>
      <td>2020-06-30 01:30:45</td>
      <td>sumanebot</td>
      <td>6</td>
      <td>30</td>
      <td>2020</td>
      <td>1</td>
      <td>30</td>
      <td>45</td>
      <td>2020-06-30 01:30:45</td>
    </tr>
    <tr>
      <th>2020-06-30 01:08:08</th>
      <td>We are🎉excited to🗣announce opening for in-pers...</td>
      <td>2020-06-30 01:08:08</td>
      <td>GrandMarc_UVA</td>
      <td>6</td>
      <td>30</td>
      <td>2020</td>
      <td>1</td>
      <td>8</td>
      <td>8</td>
      <td>2020-06-30 01:08:08</td>
    </tr>
    <tr>
      <th>2020-06-30 00:20:15</th>
      <td>RT @cavalierinsider: On Saturday, The Basketba...</td>
      <td>2020-06-30 00:20:15</td>
      <td>annefutch</td>
      <td>6</td>
      <td>30</td>
      <td>2020</td>
      <td>0</td>
      <td>20</td>
      <td>15</td>
      <td>2020-06-30 00:20:15</td>
    </tr>
    <tr>
      <th>2020-06-30 00:19:00</th>
      <td>Anthony Harris part of NFL's top safety tandem...</td>
      <td>2020-06-30 00:19:00</td>
      <td>hoosdaily</td>
      <td>6</td>
      <td>30</td>
      <td>2020</td>
      <td>0</td>
      <td>19</td>
      <td>0</td>
      <td>2020-06-30 00:19:00</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>If these row labels are in chronological order, then we can extract slices of the data that fall within a time range. We write two dates separated by a colon, and the output extracts all rows from the row that matches the first date through the row that matches the last date. Because the rows are generally listed with the most recent ones first, we write the ending timestamp first and the ending timestamp second. If these exact dates and times do not exist in the data, the syntax still finds the locations where these rows would exist and extracts the rows in between these two locations. Here is code to extract all tweets that were posted between 2pm and 3pm on June 29:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tweets</span><span class="p">[</span><span class="s1">&#39;6/29/2020 15:00&#39;</span><span class="p">:</span><span class="s1">&#39;6/29/2020 14:00&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>text</th>
      <th>created_at</th>
      <th>user</th>
      <th>month</th>
      <th>day</th>
      <th>year</th>
      <th>hour</th>
      <th>minute</th>
      <th>second</th>
      <th>timestamp</th>
    </tr>
    <tr>
      <th>created_at</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020-06-29 14:54:31</th>
      <td>UVa alumni team opts out of 2020 TBT, plans to...</td>
      <td>2020-06-29 14:54:31</td>
      <td>hoosdaily</td>
      <td>6</td>
      <td>29</td>
      <td>2020</td>
      <td>14</td>
      <td>54</td>
      <td>31</td>
      <td>2020-06-29 14:54:31</td>
    </tr>
    <tr>
      <th>2020-06-29 14:54:26</th>
      <td>Ben Wallace Is a Proud Dad of Three Kids — Mee...</td>
      <td>2020-06-29 14:54:26</td>
      <td>hoosdaily</td>
      <td>6</td>
      <td>29</td>
      <td>2020</td>
      <td>14</td>
      <td>54</td>
      <td>26</td>
      <td>2020-06-29 14:54:26</td>
    </tr>
    <tr>
      <th>2020-06-29 14:51:16</th>
      <td>Inicia Sonora exportación de uva a Corea del S...</td>
      <td>2020-06-29 14:51:16</td>
      <td>AgroTratos</td>
      <td>6</td>
      <td>29</td>
      <td>2020</td>
      <td>14</td>
      <td>51</td>
      <td>16</td>
      <td>2020-06-29 14:51:16</td>
    </tr>
    <tr>
      <th>2020-06-29 14:50:46</th>
      <td>RT @Wahoos247: Wake Forest commitment Christia...</td>
      <td>2020-06-29 14:50:46</td>
      <td>FatWhite101</td>
      <td>6</td>
      <td>29</td>
      <td>2020</td>
      <td>14</td>
      <td>50</td>
      <td>46</td>
      <td>2020-06-29 14:50:46</td>
    </tr>
    <tr>
      <th>2020-06-29 14:42:28</th>
      <td>RT @Cavs_Corner: Film Room: In the next instal...</td>
      <td>2020-06-29 14:42:28</td>
      <td>oleuva</td>
      <td>6</td>
      <td>29</td>
      <td>2020</td>
      <td>14</td>
      <td>42</td>
      <td>28</td>
      <td>2020-06-29 14:42:28</td>
    </tr>
    <tr>
      <th>2020-06-29 14:40:56</th>
      <td>RT @cavalierinsider: On Saturday, The Basketba...</td>
      <td>2020-06-29 14:40:56</td>
      <td>John_Shifflett</td>
      <td>6</td>
      <td>29</td>
      <td>2020</td>
      <td>14</td>
      <td>40</td>
      <td>56</td>
      <td>2020-06-29 14:40:56</td>
    </tr>
    <tr>
      <th>2020-06-29 14:37:11</th>
      <td>Tatil planları yapmaya başladıysan sana harika...</td>
      <td>2020-06-29 14:37:11</td>
      <td>YasinALTINEL</td>
      <td>6</td>
      <td>29</td>
      <td>2020</td>
      <td>14</td>
      <td>37</td>
      <td>11</td>
      <td>2020-06-29 14:37:11</td>
    </tr>
    <tr>
      <th>2020-06-29 14:35:52</th>
      <td>On Saturday, The Basketball Tournament will be...</td>
      <td>2020-06-29 14:35:52</td>
      <td>cavalierinsider</td>
      <td>6</td>
      <td>29</td>
      <td>2020</td>
      <td>14</td>
      <td>35</td>
      <td>52</td>
      <td>2020-06-29 14:35:52</td>
    </tr>
    <tr>
      <th>2020-06-29 14:29:17</th>
      <td>Jesse Rutherford of the Nelson County Board of...</td>
      <td>2020-06-29 14:29:17</td>
      <td>JerryMillerNow</td>
      <td>6</td>
      <td>29</td>
      <td>2020</td>
      <td>14</td>
      <td>29</td>
      <td>17</td>
      <td>2020-06-29 14:29:17</td>
    </tr>
    <tr>
      <th>2020-06-29 14:20:58</th>
      <td>RT @thesabre: NewsLink is updated! #UVA sports...</td>
      <td>2020-06-29 14:20:58</td>
      <td>Slider_Hoos</td>
      <td>6</td>
      <td>29</td>
      <td>2020</td>
      <td>14</td>
      <td>20</td>
      <td>58</td>
      <td>2020-06-29 14:20:58</td>
    </tr>
    <tr>
      <th>2020-06-29 14:20:44</th>
      <td>RT @Wahoos247: Wake Forest commitment Christia...</td>
      <td>2020-06-29 14:20:44</td>
      <td>agee_brandon</td>
      <td>6</td>
      <td>29</td>
      <td>2020</td>
      <td>14</td>
      <td>20</td>
      <td>44</td>
      <td>2020-06-29 14:20:44</td>
    </tr>
    <tr>
      <th>2020-06-29 14:18:33</th>
      <td>Ramseyer fondly recalls Cavs' perfect regular ...</td>
      <td>2020-06-29 14:18:33</td>
      <td>hoosdaily</td>
      <td>6</td>
      <td>29</td>
      <td>2020</td>
      <td>14</td>
      <td>18</td>
      <td>33</td>
      <td>2020-06-29 14:18:33</td>
    </tr>
    <tr>
      <th>2020-06-29 14:15:32</th>
      <td>Ben Wallace Is a Proud Dad of Three Kids — Mee...</td>
      <td>2020-06-29 14:15:32</td>
      <td>hoosdaily</td>
      <td>6</td>
      <td>29</td>
      <td>2020</td>
      <td>14</td>
      <td>15</td>
      <td>32</td>
      <td>2020-06-29 14:15:32</td>
    </tr>
    <tr>
      <th>2020-06-29 14:11:08</th>
      <td>NewsLink is updated! #UVA sports links all in ...</td>
      <td>2020-06-29 14:11:08</td>
      <td>thesabre</td>
      <td>6</td>
      <td>29</td>
      <td>2020</td>
      <td>14</td>
      <td>11</td>
      <td>8</td>
      <td>2020-06-29 14:11:08</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>To extract all tweets before point in time, write the timestamp before the colon and write nothing after the colon. To extract all tweets after a point in time, write nothing before the colon and write the timestamp after the colon. To extract all tweets posted after June 29 at 3pm:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tweets</span><span class="p">[:</span><span class="s1">&#39;6/29/2020 15:00&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>text</th>
      <th>created_at</th>
      <th>user</th>
      <th>month</th>
      <th>day</th>
      <th>year</th>
      <th>hour</th>
      <th>minute</th>
      <th>second</th>
      <th>timestamp</th>
    </tr>
    <tr>
      <th>created_at</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020-06-30 02:20:43</th>
      <td>@KymoraJohnson_ let me call @IamTinaThompson s...</td>
      <td>2020-06-30 02:20:43</td>
      <td>SweetLickKing</td>
      <td>6</td>
      <td>30</td>
      <td>2020</td>
      <td>2</td>
      <td>20</td>
      <td>43</td>
      <td>2020-06-30 02:20:43</td>
    </tr>
    <tr>
      <th>2020-06-30 02:18:17</th>
      <td>Congrats Eric. It’s was really great to have w...</td>
      <td>2020-06-30 02:18:17</td>
      <td>Daniel_B_Ennis</td>
      <td>6</td>
      <td>30</td>
      <td>2020</td>
      <td>2</td>
      <td>18</td>
      <td>17</td>
      <td>2020-06-30 02:18:17</td>
    </tr>
    <tr>
      <th>2020-06-30 01:55:02</th>
      <td>RT @KathrynsScGifts: "OGX Fade-defying + Orchi...</td>
      <td>2020-06-30 01:55:02</td>
      <td>blimeyonline1</td>
      <td>6</td>
      <td>30</td>
      <td>2020</td>
      <td>1</td>
      <td>55</td>
      <td>2</td>
      <td>2020-06-30 01:55:02</td>
    </tr>
    <tr>
      <th>2020-06-30 01:40:00</th>
      <td>Former #UVA stars Quin Blanding, Micah Kiser n...</td>
      <td>2020-06-30 01:40:00</td>
      <td>Wahoos247</td>
      <td>6</td>
      <td>30</td>
      <td>2020</td>
      <td>1</td>
      <td>40</td>
      <td>0</td>
      <td>2020-06-30 01:40:00</td>
    </tr>
    <tr>
      <th>2020-06-30 01:39:42</th>
      <td>Former #UVA stars Quin Blanding, Micah Kiser n...</td>
      <td>2020-06-30 01:39:42</td>
      <td>JamieOakes247</td>
      <td>6</td>
      <td>30</td>
      <td>2020</td>
      <td>1</td>
      <td>39</td>
      <td>42</td>
      <td>2020-06-30 01:39:42</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2020-06-29 15:38:19</th>
      <td>#UvA Last week a number of practicals started ...</td>
      <td>2020-06-29 15:38:19</td>
      <td>JJ_Angelus</td>
      <td>6</td>
      <td>29</td>
      <td>2020</td>
      <td>15</td>
      <td>38</td>
      <td>19</td>
      <td>2020-06-29 15:38:19</td>
    </tr>
    <tr>
      <th>2020-06-29 15:27:34</th>
      <td>Playing through: UVa golfers hone their games ...</td>
      <td>2020-06-29 15:27:34</td>
      <td>hoosdaily</td>
      <td>6</td>
      <td>29</td>
      <td>2020</td>
      <td>15</td>
      <td>27</td>
      <td>34</td>
      <td>2020-06-29 15:27:34</td>
    </tr>
    <tr>
      <th>2020-06-29 15:27:29</th>
      <td>Playing through: UVa golfers hone their games ...</td>
      <td>2020-06-29 15:27:29</td>
      <td>hoosdaily</td>
      <td>6</td>
      <td>29</td>
      <td>2020</td>
      <td>15</td>
      <td>27</td>
      <td>29</td>
      <td>2020-06-29 15:27:29</td>
    </tr>
    <tr>
      <th>2020-06-29 15:27:21</th>
      <td>Ramseyer fondly recalls Cavs' perfect regular ...</td>
      <td>2020-06-29 15:27:21</td>
      <td>hoosdaily</td>
      <td>6</td>
      <td>29</td>
      <td>2020</td>
      <td>15</td>
      <td>27</td>
      <td>21</td>
      <td>2020-06-29 15:27:21</td>
    </tr>
    <tr>
      <th>2020-06-29 15:06:57</th>
      <td>While many college athletes have been unable t...</td>
      <td>2020-06-29 15:06:57</td>
      <td>cavalierinsider</td>
      <td>6</td>
      <td>29</td>
      <td>2020</td>
      <td>15</td>
      <td>6</td>
      <td>57</td>
      <td>2020-06-29 15:06:57</td>
    </tr>
  </tbody>
</table>
<p>71 rows × 10 columns</p>
</div></div></div>
</div>
</section>
<section id="leads-and-lags">
<h3><a class="toc-backref" href="#id18" role="doc-backlink"><span class="section-number">9.5.5. </span>Leads and Lags</a><a class="headerlink" href="#leads-and-lags" title="Permalink to this heading">#</a></h3>
<p>In time series data in which the rows represent particular points in time in descending chronological order, a <strong>lag</strong> is a column that contains the values of another column shifted up one cell. That is, if the rows represent days, and a column represents today’s high temperature, the lag represents yesterday’s high temperature. A <strong>lead</strong> is a existing column with its values shifted one row down: tomorrow’s high temperature.</p>
<p>To create a lead or a lag, apply the <code class="docutils literal notranslate"><span class="pre">.shift()</span></code> method to a dataframe. The argument of <code class="docutils literal notranslate"><span class="pre">.shift()</span></code> is an integer: positive integers shift values down, creating leads, and negative values shift values up, creating lags. Whenever we shift values up or down, we create new missing values at the top or bottom of the dataframe for the lead or lagged column.</p>
<p>For example, in the <code class="docutils literal notranslate"><span class="pre">tweets</span></code> dataframe we can create two new columns, <code class="docutils literal notranslate"><span class="pre">previous_tweet</span></code> and <code class="docutils literal notranslate"><span class="pre">next_tweet</span></code> to compare with <code class="docutils literal notranslate"><span class="pre">text</span></code> by using <code class="docutils literal notranslate"><span class="pre">.shift(-1)</span></code> and <code class="docutils literal notranslate"><span class="pre">.shift(1)</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tweets</span><span class="p">[</span><span class="s1">&#39;previous_tweet&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tweets</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
<span class="n">tweets</span><span class="p">[</span><span class="s1">&#39;next_tweet&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tweets</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
<span class="n">tweets</span><span class="p">[[</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="s1">&#39;previous_tweet&#39;</span><span class="p">,</span> <span class="s1">&#39;next_tweet&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>text</th>
      <th>previous_tweet</th>
      <th>next_tweet</th>
    </tr>
    <tr>
      <th>created_at</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020-06-30 02:20:43</th>
      <td>@KymoraJohnson_ let me call @IamTinaThompson s...</td>
      <td>Congrats Eric. It’s was really great to have w...</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2020-06-30 02:18:17</th>
      <td>Congrats Eric. It’s was really great to have w...</td>
      <td>RT @KathrynsScGifts: "OGX Fade-defying + Orchi...</td>
      <td>@KymoraJohnson_ let me call @IamTinaThompson s...</td>
    </tr>
    <tr>
      <th>2020-06-30 01:55:02</th>
      <td>RT @KathrynsScGifts: "OGX Fade-defying + Orchi...</td>
      <td>Former #UVA stars Quin Blanding, Micah Kiser n...</td>
      <td>Congrats Eric. It’s was really great to have w...</td>
    </tr>
    <tr>
      <th>2020-06-30 01:40:00</th>
      <td>Former #UVA stars Quin Blanding, Micah Kiser n...</td>
      <td>Former #UVA stars Quin Blanding, Micah Kiser n...</td>
      <td>RT @KathrynsScGifts: "OGX Fade-defying + Orchi...</td>
    </tr>
    <tr>
      <th>2020-06-30 01:39:42</th>
      <td>Former #UVA stars Quin Blanding, Micah Kiser n...</td>
      <td>RT @ThinakaranLK: சில இடங்களில் மழை பெய்யும் ச...</td>
      <td>Former #UVA stars Quin Blanding, Micah Kiser n...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2020-06-23 15:12:08</th>
      <td>RT @AgNPalabras: #UVA: 54,87. Sube 0,20% diari...</td>
      <td>#UVA: 54,87. Sube 0,20% diario, 1,22% en junio...</td>
      <td>WATCH: Top plays of UVA's 2019-20 basketball s...</td>
    </tr>
    <tr>
      <th>2020-06-23 15:08:40</th>
      <td>#UVA: 54,87. Sube 0,20% diario, 1,22% en junio...</td>
      <td>Zur Einstimmung #UVA vom letzten #gig bei uns ...</td>
      <td>RT @AgNPalabras: #UVA: 54,87. Sube 0,20% diari...</td>
    </tr>
    <tr>
      <th>2020-06-23 14:52:23</th>
      <td>Zur Einstimmung #UVA vom letzten #gig bei uns ...</td>
      <td>RT @JLuis_Sommelier: #Mosto: jugo obtenido de ...</td>
      <td>#UVA: 54,87. Sube 0,20% diario, 1,22% en junio...</td>
    </tr>
    <tr>
      <th>2020-06-23 14:49:22</th>
      <td>RT @JLuis_Sommelier: #Mosto: jugo obtenido de ...</td>
      <td>Good question... My instinct says Ty Jerome, b...</td>
      <td>Zur Einstimmung #UVA vom letzten #gig bei uns ...</td>
    </tr>
    <tr>
      <th>2020-06-23 14:32:44</th>
      <td>Good question... My instinct says Ty Jerome, b...</td>
      <td>NaN</td>
      <td>RT @JLuis_Sommelier: #Mosto: jugo obtenido de ...</td>
    </tr>
  </tbody>
</table>
<p>1000 rows × 3 columns</p>
</div></div></div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="ch8.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">8. </span>Data Wrangling with <code class="docutils literal notranslate"><span class="pre">pandas</span></code></p>
      </div>
    </a>
    <a class="right-next"
       href="ch10.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">10. </span>Exploratory Data Analysis</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-pandas-or-sql">9.1. Introduction: <code class="docutils literal notranslate"><span class="pre">pandas</span></code> or SQL?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#joining-dataframes">9.2. Joining Dataframes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-merging-data-on-u-s-state-election-results-income-economies-and-area">9.2.1. Example: Merging Data on U.S. State Election Results, Income, Economies, and Area</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-the-pd-merge-function">9.2.2. Using the <code class="docutils literal notranslate"><span class="pre">pd.merge()</span></code> Function</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#checking-for-problems-that-can-occur-without-errors">9.2.3. Checking for Problems That Can Occur Without Errors</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#merging-all-of-the-dataframes-together-while-checking-for-problems">9.2.4. Merging all of the Dataframes Together While Checking for Problems</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reshaping-data">9.3. Reshaping Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-gross-domestic-product-by-state-1997-2015">9.3.1. Example: Gross domestic product by state, 1997-2015</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#melting-turning-columns-to-rows">9.3.2. Melting: Turning Columns to Rows</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pivoting-turning-rows-to-columns">9.3.3. Pivoting: Turning Rows to Columns</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#working-with-strings-example-the-2019-anes-pilot-study">9.4. Working with Strings (Example: the 2019 ANES Pilot Study)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#working-with-dates-and-times-example-twitter">9.5. Working with Dates and Times (Example: Twitter)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#extracting-year-month-day-and-time-from-a-timestamp-column">9.5.1. Extracting Year, Month, Day, and Time from a Timestamp Column</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#generating-timestamps-from-separate-month-day-and-year-columns">9.5.2. Generating Timestamps from Separate Month, Day, and Year Columns</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#converting-string-columns-to-timestamps">9.5.3. Converting String Columns to Timestamps</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#filtering-rows-based-on-date-ranges">9.5.4. Filtering Rows Based on Date Ranges</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#leads-and-lags">9.5.5. Leads and Lags</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Jonathan Kropko (jkropko@virginia.edu)
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>